<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Wrangling – DATA24</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-d37c06fde26cce7278c43b211372364c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-81674bea0ce09368006a45d6d4084aa0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
div.callout-challenge.callout {
  border-left-color: firebrick;
}
div.callout-challenge.callout-style-default > .callout-header {
  background-color: rgb(from firebrick r g b / 13%);
}
div.callout-challenge .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-challenge.callout-style-default .callout-icon::before, div.callout-challenge.callout-titled .callout-icon::before {
  content: '🛠️';
  background-image: none;
}
div.callout-question.callout {
  border-left-color: pink;
}
div.callout-question.callout-style-default > .callout-header {
  background-color: rgb(from pink r g b / 13%);
}
div.callout-question .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-question.callout-style-default .callout-icon::before, div.callout-question.callout-titled .callout-icon::before {
  content: '🧠';
  background-image: none;
}
</style>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./LU_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DATA24</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./visualization.html"> 
<span class="menu-text">Visualization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./wrangling.html" aria-current="page"> 
<span class="menu-text">Wrangling</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./pivotjoin.html"> 
<span class="menu-text">Pivots and joins</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li><a href="#part-i.-basics" id="toc-part-i.-basics" class="nav-link" data-scroll-target="#part-i.-basics">Part I. Basics</a>
  <ul class="collapse">
  <li><a href="#data-overview" id="toc-data-overview" class="nav-link" data-scroll-target="#data-overview">Data Overview</a></li>
  </ul></li>
  <li><a href="#selectexcludedrop-and-filter" id="toc-selectexcludedrop-and-filter" class="nav-link" data-scroll-target="#selectexcludedrop-and-filter">select/exclude/drop and filter</a>
  <ul class="collapse">
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter">Filter</a></li>
  </ul></li>
  <li><a href="#mutatingwith_columns" id="toc-mutatingwith_columns" class="nav-link" data-scroll-target="#mutatingwith_columns">mutating(with_columns)</a></li>
  <li><a href="#summarizing-group_by-agg" id="toc-summarizing-group_by-agg" class="nav-link" data-scroll-target="#summarizing-group_by-agg">summarizing (group_by, agg)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Wrangling</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<div id="setup" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> great_tables <span class="im">import</span> GT</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>theme_set(theme_linedraw())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-i.-basics" class="level1">
<h1>Part I. Basics</h1>
<div id="1984d70d" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indoor air pollution</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>hhap_deaths <span class="op">=</span> pl.read_csv(<span class="st">"hhap/hhap_deaths.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>clean_fuels <span class="op">=</span> pl.read_csv(<span class="st">"hhap/clean_fuels_cooking.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>fuel_types <span class="op">=</span> pl.read_csv(<span class="st">"hhap/cooking_by_fuel_type.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-overview" class="level2">
<h2 class="anchored" data-anchor-id="data-overview">Data Overview</h2>
<p>Polars data frames can be conveniently previewed with</p>
<div id="3df4ac89" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>hhap_deaths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10_800, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">cause_of_death</th>
<th data-quarto-table-cell-role="th">deaths</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"All causes"</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Acute lower respiratory infect…</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Trachea, bronchus, lung cancer…</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Ischaemic heart disease"</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Stroke"</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>"BOL"</td>
<td>"Bolivia (Plurinational State o…</td>
<td>2019</td>
<td>"Trachea, bronchus, lung cancer…</td>
<td>98.72</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"GNB"</td>
<td>"Guinea-Bissau"</td>
<td>2019</td>
<td>"Chronic obstructive pulmonary …</td>
<td>98.88</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"CIV"</td>
<td>"Cote d'Ivoire"</td>
<td>2019</td>
<td>"Chronic obstructive pulmonary …</td>
<td>990.6</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"TUR"</td>
<td>"Türkiye"</td>
<td>2019</td>
<td>"Chronic obstructive pulmonary …</td>
<td>997.6</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"UZB"</td>
<td>"Uzbekistan"</td>
<td>2019</td>
<td>"All causes"</td>
<td>9982.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>By default this shows 5 first and 5 last rows of the data. Rows are often called observations or records and columns are called variables or features. If you want to see a few more observations off the top of the dataset, you can call</p>
<div id="915beebd" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(hhap_deaths</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">cause_of_death</th>
<th data-quarto-table-cell-role="th">deaths</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"All causes"</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Acute lower respiratory infect…</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Trachea, bronchus, lung cancer…</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Ischaemic heart disease"</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Stroke"</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Chronic obstructive pulmonary …</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"AUS"</td>
<td>"Australia"</td>
<td>2010</td>
<td>"All causes"</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"AUS"</td>
<td>"Australia"</td>
<td>2010</td>
<td>"Acute lower respiratory infect…</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"AUS"</td>
<td>"Australia"</td>
<td>2010</td>
<td>"Trachea, bronchus, lung cancer…</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"AUS"</td>
<td>"Australia"</td>
<td>2010</td>
<td>"Ischaemic heart disease"</td>
<td>0.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>When the number of columns is large, this may not be the most convenient way of getting an overview of the data. Alternative representation can be produced using glimpse, which shows the same data in horizontal (textual) form, i.e.&nbsp;every variable now occupies one row.</p>
<div id="c794c845" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    .glimpse())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6402
Columns: 6
$ region                       &lt;str&gt; 'Africa', 'Western Pacific', 'Western Pacific', 'Western Pacific', 'Western Pacific', 'Africa', 'Western Pacific', 'Africa', 'Western Pacific', 'Western Pacific'
$ country_code                 &lt;str&gt; 'SSD', 'NIU', 'TKL', 'COK', 'PLW', 'STP', 'FSM', 'BDI', 'NRU', 'TUV'
$ country                      &lt;str&gt; 'South Sudan', 'Niue', 'Tokelau', 'Cook Islands', 'Palau', 'Sao Tome and Principe', 'Micronesia (Federated States of)', 'Burundi', 'Nauru', 'Tuvalu'
$ year                         &lt;i64&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022
$ pop_clean_fuels_cooking_mln  &lt;f64&gt; 0.0, 0.002, 0.0004, 0.013, 0.007, 0.009, 0.014, 0.013, 0.011, 0.009
$ prop_clean_fuels_cooking_pct &lt;f64&gt; 0.0, 98.5, 28.3, 72.7, 29.45, 4.1, 13.2, 0.1, 100.0, 75.2
</code></pre>
</div>
</div>
<p>We can also look at the table of statistical summaries for our data</p>
<div id="9fe01586" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    .describe())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 7)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">statistic</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"count"</td>
<td>"6402"</td>
<td>"6402"</td>
<td>"6402"</td>
<td>6402.0</td>
<td>6402.0</td>
<td>6402.0</td>
</tr>
<tr class="even">
<td>"null_count"</td>
<td>"0"</td>
<td>"0"</td>
<td>"0"</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"mean"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2006.0</td>
<td>19.29797</td>
<td>61.080069</td>
</tr>
<tr class="even">
<td>"std"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>9.522648</td>
<td>73.100935</td>
<td>39.952764</td>
</tr>
<tr class="odd">
<td>"min"</td>
<td>"Africa"</td>
<td>"AFG"</td>
<td>"Afghanistan"</td>
<td>1990.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"25%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>1998.0</td>
<td>0.23</td>
<td>16.6</td>
</tr>
<tr class="odd">
<td>"50%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2006.0</td>
<td>2.24</td>
<td>78.0</td>
</tr>
<tr class="even">
<td>"75%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2014.0</td>
<td>10.24</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"max"</td>
<td>"Western Pacific"</td>
<td>"ZWE"</td>
<td>"Zimbabwe"</td>
<td>2022.0</td>
<td>1257.0</td>
<td>100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="selectexcludedrop-and-filter" class="level1">
<h1>select/exclude/drop and filter</h1>
<p>One of the most common things done in data analysis is selecting particular variables.</p>
<div id="2015c654" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.col(<span class="st">"country"</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country</th>
</tr>
<tr class="even">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"South Sudan"</td>
</tr>
<tr class="even">
<td>"Niue"</td>
</tr>
<tr class="odd">
<td>"Tokelau"</td>
</tr>
<tr class="even">
<td>"Cook Islands"</td>
</tr>
<tr class="odd">
<td>"Palau"</td>
</tr>
<tr class="even">
<td>…</td>
</tr>
<tr class="odd">
<td>"Austria"</td>
</tr>
<tr class="even">
<td>"Germany"</td>
</tr>
<tr class="odd">
<td>"Sweden"</td>
</tr>
<tr class="even">
<td>"Portugal"</td>
</tr>
<tr class="odd">
<td>"India"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>As you can see the column name is wrapped into the expression for column <code>pl.col()</code>. The wrapper can sometimes be skipped, as the case is here. The <code>select()</code> will “wrap” the strings you provide into the <code>pl.col()</code> wrapper interpreting them as column names</p>
<div id="f5cdfddc" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">"country_code"</span>, <span class="st">"country"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    .select(pl.col(<span class="st">"country_code"</span>), pl.col(<span class="st">"country"</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"SSD"</td>
<td>"South Sudan"</td>
</tr>
<tr class="even">
<td>"NIU"</td>
<td>"Niue"</td>
</tr>
<tr class="odd">
<td>"TKL"</td>
<td>"Tokelau"</td>
</tr>
<tr class="even">
<td>"COK"</td>
<td>"Cook Islands"</td>
</tr>
<tr class="odd">
<td>"PLW"</td>
<td>"Palau"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"AUT"</td>
<td>"Austria"</td>
</tr>
<tr class="even">
<td>"DEU"</td>
<td>"Germany"</td>
</tr>
<tr class="odd">
<td>"SWE"</td>
<td>"Sweden"</td>
</tr>
<tr class="even">
<td>"PRT"</td>
<td>"Portugal"</td>
</tr>
<tr class="odd">
<td>"IND"</td>
<td>"India"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Column names wrapped into <code>pl.col()</code> represent the simplest kind of <em>expressions</em>. In polars we create expressions and evaluate them in the context of the data. Expressions taken in isolation don’t do anything, they need to be considered in the context of the data to return some data. This line of code does not do anything. It just returns an expression:</p>
<div id="e9550f82" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pl.col(<span class="st">"country_code"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
col("country_code")
</div>
</div>
<p>But when we evaluate in the context of the <code>clean_fuels</code> dataframe it will will return a column of country codes</p>
<div id="d22400c4" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.col(<span class="st">"country_code"</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country_code</th>
</tr>
<tr class="even">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"SSD"</td>
</tr>
<tr class="even">
<td>"NIU"</td>
</tr>
<tr class="odd">
<td>"TKL"</td>
</tr>
<tr class="even">
<td>"COK"</td>
</tr>
<tr class="odd">
<td>"PLW"</td>
</tr>
<tr class="even">
<td>…</td>
</tr>
<tr class="odd">
<td>"AUT"</td>
</tr>
<tr class="even">
<td>"DEU"</td>
</tr>
<tr class="odd">
<td>"SWE"</td>
</tr>
<tr class="even">
<td>"PRT"</td>
</tr>
<tr class="odd">
<td>"IND"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In this case, <code>select()</code> statement provides an evaluation environment. There are several commands in <code>polars</code> which provide an environment for evaluating data expressions and <code>select()</code> is the simplest one of them. It is really versatile, but at this time we will only consider the simplest usecase: extracting columns from the dataframe using expressions.</p>
<p>Using column name wrapped in <code>pl.col()</code> as an expression-starter is a very common approach in polars. We will use it quite often to build powerful expressions tranforming columns in polars. Expressions can used to refer to multiple columns at once. For example, here we are making an expression which will refer to all columns other than country and region.</p>
<div id="52e959c5" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.<span class="bu">all</span>().exclude(<span class="st">"country"</span>, <span class="st">"region"</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"SSD"</td>
<td>2022</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"NIU"</td>
<td>2022</td>
<td>0.002</td>
<td>98.5</td>
</tr>
<tr class="odd">
<td>"TKL"</td>
<td>2022</td>
<td>0.0004</td>
<td>28.3</td>
</tr>
<tr class="even">
<td>"COK"</td>
<td>2022</td>
<td>0.013</td>
<td>72.7</td>
</tr>
<tr class="odd">
<td>"PLW"</td>
<td>2022</td>
<td>0.007</td>
<td>29.45</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"AUT"</td>
<td>1990</td>
<td>7.72</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"DEU"</td>
<td>1990</td>
<td>79.12</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"SWE"</td>
<td>1990</td>
<td>8.57</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"PRT"</td>
<td>1990</td>
<td>9.95</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"IND"</td>
<td>1990</td>
<td>96.58</td>
<td>11.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><code>pl.all()</code> refers to all columns in the evaluation environment and it gets further refined by method chaining excluding <code>country</code> and <code>region</code>.</p>
<p>Selecting columns is a very common operation. It is so important and used so often, that there’s a special class of methods designed specifically for this purpose, situated in <code>polars.selectors</code>, commonly aliased as <code>cs</code>. Have a look at the <code>polars</code> <a href="https://docs.pola.rs/api/python/stable/reference/selectors.html">documentation for selectors</a></p>
<p>Among the most useful selectors are, of course, selectors by name and column number (for which we might not really need selectors, because those can be picked up with <code>pl.col()</code> and <code>pl.nth()</code>).</p>
<div id="1e9443cc" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    .select(cs.by_name(<span class="st">"region"</span>, <span class="st">"country"</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># note python is 0-based</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    .select(cs.by_index(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">5</span>))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>"South Sudan"</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"Niue"</td>
<td>98.5</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"Tokelau"</td>
<td>28.3</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"Cook Islands"</td>
<td>72.7</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"Palau"</td>
<td>29.45</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"Austria"</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"Germany"</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"Sweden"</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"Portugal"</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"South-East Asia"</td>
<td>"India"</td>
<td>11.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>But perhaps more unique and useful selectors are <code>cs.first()</code> and <code>cs.last()</code>, as well as a collection of selectors for each of the data types, such as <code>cs.numeric()</code>. The selector can be negated with <code>~</code> sign, so that <code>~cs.numeric()</code> means non-numeric columns.</p>
<div id="52af87a3" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    .select(cs.first())</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># not first</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    .select(<span class="op">~</span>cs.first())</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># not numeric</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    .select(<span class="op">~</span>cs.numeric())</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"NIU"</td>
<td>"Niue"</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"TKL"</td>
<td>"Tokelau"</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"COK"</td>
<td>"Cook Islands"</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"PLW"</td>
<td>"Palau"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"AUT"</td>
<td>"Austria"</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"DEU"</td>
<td>"Germany"</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"SWE"</td>
<td>"Sweden"</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"PRT"</td>
<td>"Portugal"</td>
</tr>
<tr class="odd">
<td>"South-East Asia"</td>
<td>"IND"</td>
<td>"India"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="filter" class="level2">
<h2 class="anchored" data-anchor-id="filter">Filter</h2>
<p>Expressions show up really handy when we need to perform some operations. Logical operation are perhaps among the simplest operations one can think of. For example, we can compare every value in the column <code>region</code> with the string “Europe” and, if there’s a match, return <code>True</code>, otherwise return <code>False</code>. If we now use this vector of logical values as the filter, all the records for which the value <code>True</code> is returned by this operation, will be included in the filtered dataset.</p>
<p>Here’s the subset of our original clean fuels data for Europe.</p>
<div id="dca9edbe" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># large countries</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"region"</span>)<span class="op">==</span><span class="st">"Europe"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1_749, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"SMR"</td>
<td>"San Marino"</td>
<td>2022</td>
<td>0.034</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"MCO"</td>
<td>"Monaco"</td>
<td>2022</td>
<td>0.04</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"FRO"</td>
<td>"Faroe Islands"</td>
<td>2022</td>
<td>0.05</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"AND"</td>
<td>"Andorra"</td>
<td>2022</td>
<td>0.077</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"ISL"</td>
<td>"Iceland"</td>
<td>2022</td>
<td>0.35</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BLR"</td>
<td>"Belarus"</td>
<td>1990</td>
<td>7.48</td>
<td>73.2</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"AUT"</td>
<td>"Austria"</td>
<td>1990</td>
<td>7.72</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"DEU"</td>
<td>"Germany"</td>
<td>1990</td>
<td>79.12</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"SWE"</td>
<td>"Sweden"</td>
<td>1990</td>
<td>8.57</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"PRT"</td>
<td>"Portugal"</td>
<td>1990</td>
<td>9.95</td>
<td>100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>You can subset the data further by adding more expressions. Let’s for example see if in the modern times there are still countries in Europe where the majority of people lack access to clean fuel for cooking.</p>
<div id="5fe74f54" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"region"</span>)<span class="op">==</span><span class="st">"Europe"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"year"</span>)<span class="op">==</span><span class="dv">2022</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"prop_clean_fuels_cooking_pct"</span>)<span class="op">&lt;</span><span class="dv">50</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2022</td>
<td>1.43</td>
<td>41.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Oh, wow! Over half of population of Bosnia still does not have access to clearn fuels for cooking. Lets zoom in on Bosnia and try to visualize the data.</p>
<div id="5ff130b2" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>clean_fuels</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"country_code"</span>)<span class="op">==</span><span class="st">"BIH"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (33, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2022</td>
<td>1.43</td>
<td>41.1</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2021</td>
<td>1.43</td>
<td>40.9</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2020</td>
<td>1.43</td>
<td>40.85</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2019</td>
<td>1.47</td>
<td>42.05</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2018</td>
<td>1.43</td>
<td>40.8</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1994</td>
<td>2.29</td>
<td>58.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1993</td>
<td>2.41</td>
<td>58.9</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1992</td>
<td>2.47</td>
<td>58.25</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1991</td>
<td>2.6</td>
<td>59.5</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1990</td>
<td>2.64</td>
<td>59.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We are interested in how the population with access to clean fuels for cooking has developed over the years, so we place year on x axis and population on y axis.</p>
<div id="8a4d182f" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ggplot(<span class="op">&lt;</span>DATA<span class="op">&gt;</span>) <span class="op">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    geom_line(mapping<span class="op">=</span>aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"pop_clean_fuels_cooking_mln"</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you remember in plotnine the data should go into the first argument of gpplot function. One approach could be to copy the code for subsetting the code for subsetting the clean fuels dataframe into the <code>&lt;DATA&gt;</code> slot inside gpplot function</p>
<div id="5d9e605f" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ggplot(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    clean_fuels</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">filter</span>(pl.col(<span class="st">"country_code"</span>)<span class="op">==</span><span class="st">"BIH"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    geom_line(mapping<span class="op">=</span>aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"prop_clean_fuels_cooking_pct"</span>))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-19-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This code works, but it is somewhat less clear whats going on. A cleaner alternative is by using <code>.pipe()</code> which passess the polars dataframe into the function provided as an argument. In this case our data about bosnian households will be passed as a first argument into the ggplot function, which is what we wanted all along. All code after .pipe(ggplot) is plotnine code, hence the use of +</p>
<div id="750b7b1a" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"country_code"</span>)<span class="op">==</span><span class="st">"BIH"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot) <span class="op">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    geom_line(mapping<span class="op">=</span>aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"pop_clean_fuels_cooking_mln"</span>))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-20-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8a98fc78" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># str.contains, str.starts_with, str.ends_with, str.extract, .str.replace, .str.replace_all</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="mutatingwith_columns" class="level1">
<h1>mutating(with_columns)</h1>
<p>Lets practice what we learned about filtering by visualizing causes of death in some European countries. First of all, note that our household air pollution deaths dataset contains both summaries and breakdowns of deaths for every country and year. The observation where <code>cause_of_death</code> is indicated as “All causes” is a sum of all the other lines for that country and year.</p>
<div id="1b5b9dc7" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(hhap_deaths</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"country_code"</span>)<span class="op">==</span><span class="st">"BIH"</span>, pl.col(<span class="st">"year"</span>)<span class="op">==</span><span class="dv">2010</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">cause_of_death</th>
<th data-quarto-table-cell-role="th">deaths</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"Acute lower respiratory infect…</td>
<td>147.2</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"Stroke"</td>
<td>1685.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"Ischaemic heart disease"</td>
<td>2067.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"Chronic obstructive pulmonary …</td>
<td>365.2</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"All causes"</td>
<td>4816.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"Trachea, bronchus, lung cancer…</td>
<td>551.7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We might need to remove this line if we want to avoid double counting the deaths in each country. Lets look at European countries for which we have data on the number of deaths.</p>
<div id="1d3fa08a" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(hhap_deaths</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"region"</span>)<span class="op">==</span><span class="st">"Europe"</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"deaths"</span>)<span class="op">&gt;</span><span class="dv">0</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"cause_of_death"</span>)<span class="op">!=</span><span class="st">"All causes"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot)<span class="op">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"deaths"</span>, color<span class="op">=</span><span class="st">"cause_of_death"</span>, group<span class="op">=</span><span class="st">"cause_of_death"</span>)<span class="op">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    geom_smooth(method<span class="op">=</span><span class="st">"lm"</span>)<span class="op">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    facet_wrap(<span class="st">"country"</span>, scales<span class="op">=</span><span class="st">"free_y"</span>, ncol<span class="op">=</span><span class="dv">9</span>)<span class="op">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    theme(figure_size<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>), legend_position<span class="op">=</span><span class="st">"bottom"</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-23-output-1.png" width="1920" height="960" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It would be really nice to put these numbers in perspective of population in each country. How can we get the population numbers? We could calculate it from the data on clean fuels data. Let’s see how we could do that</p>
<div id="7ea82a2f" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2022</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"NIU"</td>
<td>"Niue"</td>
<td>2022</td>
<td>0.002</td>
<td>98.5</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"TKL"</td>
<td>"Tokelau"</td>
<td>2022</td>
<td>0.0004</td>
<td>28.3</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"COK"</td>
<td>"Cook Islands"</td>
<td>2022</td>
<td>0.013</td>
<td>72.7</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"PLW"</td>
<td>"Palau"</td>
<td>2022</td>
<td>0.007</td>
<td>29.45</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"AUT"</td>
<td>"Austria"</td>
<td>1990</td>
<td>7.72</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"DEU"</td>
<td>"Germany"</td>
<td>1990</td>
<td>79.12</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"SWE"</td>
<td>"Sweden"</td>
<td>1990</td>
<td>8.57</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"PRT"</td>
<td>"Portugal"</td>
<td>1990</td>
<td>9.95</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"South-East Asia"</td>
<td>"IND"</td>
<td>"India"</td>
<td>1990</td>
<td>96.58</td>
<td>11.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>New columns can be created using <code>with_columns()</code> expression evaluation environment. Here expressions can be included which will produce new columns to be added to the dataset. First of all we are interested in turning the percentage of people with access to clean fuels into the true proportion by dividing it by 100. Note that if we name the expression by including the string value in front of = sign, this value will be used as a new column name.</p>
<div id="79f057ea" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    .with_columns(prop<span class="op">=</span>pl.col(<span class="st">"prop_clean_fuels_cooking_pct"</span>)<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 7)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
<th data-quarto-table-cell-role="th">prop</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2022</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"NIU"</td>
<td>"Niue"</td>
<td>2022</td>
<td>0.002</td>
<td>98.5</td>
<td>0.985</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"TKL"</td>
<td>"Tokelau"</td>
<td>2022</td>
<td>0.0004</td>
<td>28.3</td>
<td>0.283</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"COK"</td>
<td>"Cook Islands"</td>
<td>2022</td>
<td>0.013</td>
<td>72.7</td>
<td>0.727</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"PLW"</td>
<td>"Palau"</td>
<td>2022</td>
<td>0.007</td>
<td>29.45</td>
<td>0.2945</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"AUT"</td>
<td>"Austria"</td>
<td>1990</td>
<td>7.72</td>
<td>100.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"DEU"</td>
<td>"Germany"</td>
<td>1990</td>
<td>79.12</td>
<td>100.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"SWE"</td>
<td>"Sweden"</td>
<td>1990</td>
<td>8.57</td>
<td>100.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"PRT"</td>
<td>"Portugal"</td>
<td>1990</td>
<td>9.95</td>
<td>100.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>"South-East Asia"</td>
<td>"IND"</td>
<td>"India"</td>
<td>1990</td>
<td>96.58</td>
<td>11.1</td>
<td>0.111</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now we can use the newly created column in a new with_columns statement. Here I divided the population with access to clean fuels by the proportion to arrive at the annual estimate of population. I wrapped the whole expression into parenthesis (to make sure that the division operator is properly handled) and passed the result to alias() which specifies the name for the expression, which will be used as a column name. This looks good. Lets assign it to a variable.</p>
<div id="8eb8fd64" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    .with_columns(prop<span class="op">=</span>pl.col(<span class="st">"prop_clean_fuels_cooking_pct"</span>)<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    .with_columns((pl.col(<span class="st">"pop_clean_fuels_cooking_mln"</span>)<span class="op">/</span>pl.col(<span class="st">"prop"</span>)).alias(<span class="st">"population"</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>clean_fuels_pop_df <span class="op">=</span> (clean_fuels</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    .with_columns((pl.col(<span class="st">"pop_clean_fuels_cooking_mln"</span>)<span class="op">/</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                    (pl.col(<span class="st">"prop_clean_fuels_cooking_pct"</span>)<span class="op">/</span><span class="dv">100</span>)).alias(<span class="st">"population"</span>))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># note that we created NaNs </span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>clean_fuels_pop_df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 8)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">statistic</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
<th data-quarto-table-cell-role="th">population</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"count"</td>
<td>"6402"</td>
<td>"6402"</td>
<td>"6402"</td>
<td>6402.0</td>
<td>6402.0</td>
<td>6402.0</td>
<td>6402.0</td>
</tr>
<tr class="even">
<td>"null_count"</td>
<td>"0"</td>
<td>"0"</td>
<td>"0"</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"mean"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2006.0</td>
<td>19.29797</td>
<td>61.080069</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"std"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>9.522648</td>
<td>73.100935</td>
<td>39.952764</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"min"</td>
<td>"Africa"</td>
<td>"AFG"</td>
<td>"Afghanistan"</td>
<td>1990.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.001112</td>
</tr>
<tr class="even">
<td>"25%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>1998.0</td>
<td>0.23</td>
<td>16.6</td>
<td>1.305556</td>
</tr>
<tr class="odd">
<td>"50%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2006.0</td>
<td>2.24</td>
<td>78.0</td>
<td>6.833333</td>
</tr>
<tr class="even">
<td>"75%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2014.0</td>
<td>10.24</td>
<td>100.0</td>
<td>22.727273</td>
</tr>
<tr class="odd">
<td>"max"</td>
<td>"Western Pacific"</td>
<td>"ZWE"</td>
<td>"Zimbabwe"</td>
<td>2022.0</td>
<td>1257.0</td>
<td>100.0</td>
<td>1431.66287</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>There are a few <code>NaN</code> values in our data. Let’s see what those are.</p>
<div id="f35cd595" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels_pop_df</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"population"</span>).is_nan()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (35, 7)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
<th data-quarto-table-cell-role="th">population</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2022</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2021</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2020</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2019</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2018</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"BEN"</td>
<td>"Benin"</td>
<td>1991</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"SLE"</td>
<td>"Sierra Leone"</td>
<td>1991</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"TGO"</td>
<td>"Togo"</td>
<td>1990</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"BEN"</td>
<td>"Benin"</td>
<td>1990</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"SLE"</td>
<td>"Sierra Leone"</td>
<td>1990</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In the instances where the proportion was zero, we have obtained NaN instead of the proper population estimate. NaNs being one kind missing values propagate in calculations. This is why in the quantitative summaries we see that mean and standard deviation are also NaN for population column.</p>
<p>Perhaps better source of population data could be the <code>fuel_types</code> dataset.</p>
<div id="fee8c70e" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fuel_types_pop_df <span class="op">=</span> (fuel_types</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    .with_columns(population<span class="op">=</span>pl.col(<span class="st">"pop_cooking_mln"</span>)<span class="op">/</span>pl.col(<span class="st">"prop_cooking_pct"</span>)<span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This looks promising. We still get many <code>NaN</code> values, but now we also get multiple estimates of population from every fuel type for every country and every year. The difference in these estimates comes from the rounding imprecision in proportion of population with access to the particular fuel type. It would be really nice to be able level out those immaterial differences, through, for example, averaging.</p>
</section>
<section id="summarizing-group_by-agg" class="level1">
<h1>summarizing (group_by, agg)</h1>
<p>One of the most important operations data analysts do is producing various summaries of the data. Often we are interested in some sort of summary of the data by group. In our newly produced dataset, we could interested in total population for all countries in each of the regions. In polar we do it in two steps: first specify the groups using group_by() and then aggregate the data using .agg().</p>
<div id="d3c9d5e1" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(fuel_types_pop_df</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>,<span class="st">"year"</span>, <span class="st">"country"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"population"</span>).mean())</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5_313, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">population</th>
</tr>
<tr class="even">
<th>str</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>2009</td>
<td>"Uzbekistan"</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>2012</td>
<td>"Mexico"</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>2019</td>
<td>"Latvia"</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Eastern Mediterranean"</td>
<td>2013</td>
<td>"Iran (Islamic Republic of)"</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>2001</td>
<td>"Madagascar"</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>2019</td>
<td>"Cameroon"</td>
<td>25.38319</td>
</tr>
<tr class="even">
<td>"South-East Asia"</td>
<td>2005</td>
<td>"Maldives"</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"South-East Asia"</td>
<td>2003</td>
<td>"Timor-Leste"</td>
<td>0.988034</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>2021</td>
<td>"Spain"</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Eastern Mediterranean"</td>
<td>1992</td>
<td>"Somalia"</td>
<td>NaN</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This is nice, but population in some years seem to show as NaN. This is because of division by zero in the previous section. We can drop these values before summarizing with <code>.drop_nans()</code>. Alternatively, we could drop the zero-valued records (<code>drop_nulls()</code>) in the “proportion of population with access to clean fuels”, which is used in the denominator of our <code>population</code> column</p>
<p>Lets group by year and region and repeat (removing the missing values). and plot the result</p>
<div id="338f6914" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>(fuel_types_pop_df</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>, <span class="st">"year"</span>, <span class="st">"country"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"population"</span>).drop_nans().mean()) </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>, <span class="st">"year"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"population"</span>).mean())</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_line(aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"population"</span>, color<span class="op">=</span><span class="st">"region"</span>))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-30-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As expected, we observe rapid grown in population of Africa and South-East Asia, while European population growth has stagnated.</p>
<p>Expression can be started from one of the summary functions, with the column name as an argument. Compare two ways of expressing the same thing:</p>
<div id="a385de86" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(fuel_types_pop_df</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>, <span class="st">"year"</span>, <span class="st">"country"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"population"</span>).drop_nans().mean().alias(<span class="st">"mean_pop_fuel_types"</span>)) )</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>(fuel_types_pop_df</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>, <span class="st">"year"</span>, <span class="st">"country"</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    .agg(pl.mean(<span class="st">"population"</span>).alias(<span class="st">"mean_pop_fuel_types"</span>)) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5_313, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">mean_pop_fuel_types</th>
</tr>
<tr class="even">
<th>str</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>2022</td>
<td>"Mozambique"</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>1994</td>
<td>"Philippines"</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Eastern Mediterranean"</td>
<td>2008</td>
<td>"Djibouti"</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>2020</td>
<td>"Grenada"</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>2016</td>
<td>"Bolivia (Plurinational State o…</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>1996</td>
<td>"Faroe Islands"</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>1998</td>
<td>"Cambodia"</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>1991</td>
<td>"Latvia"</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>2009</td>
<td>"Estonia"</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>2009</td>
<td>"Gambia"</td>
<td>NaN</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Sometimes you dont want to summarize, but rather perform operation per group. Lets start by plotting total population per region for each fuel type over time. We want to group the data by region, year and fuel type and sum over countries. We can use faceted lineplot to see what’s going on in each continent clearly. The range of values is quite large. We can use log scale to deal with this.</p>
<div id="33748ae2" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    fuel_types</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"fuel_type"</span>, <span class="st">"year"</span>, <span class="st">"region"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"pop_cooking_mln"</span>).<span class="bu">sum</span>())</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_line(aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"pop_cooking_mln"</span>, color<span class="op">=</span><span class="st">"fuel_type"</span>, group<span class="op">=</span><span class="st">"fuel_type"</span>))</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>facet_wrap(<span class="st">"region"</span>, ncol<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>scale_y_log10()</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-32-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This looks good. We have quite different stories per continent: transitioning away from coal and charcoal in Europe and Americas. Rising importance of electricity and gas across the flobe and quite important role of biomass in Africa and South-East Asia.</p>
<p>However because the population of these subgroups is so different it’s hard to see the energy mix in every continent clearly. Can we represent the share of population relying on each type of fuel per continent?</p>
<p>What we need to do is divide these numbers by totals across all fuel types. We start with the code we have so far and add one more variable: proportion of population. Here we take the summed up <code>pop_cooking_mln</code> (which after aggregation contains total per region, year and fuel type) and divide it by the sum of the values across fuel type. This is not aggregation, because we dont collapse the number of observations. We just want calulate sums over certain subgroups. In polars this is expressed with the method .over(), which takes the names of the grouping variables over which expression shall be computed. Think of this as adding variables per group. We write out our expression <code>pop_cooking_mln</code>) divided by the sum of the same column, but the sum should be calcualated not for all dataset, but rather per year and region, effectively summing across the fuel type, which is the remaining variable not included in the over() statement.</p>
<div id="5be23c4c" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    fuel_types</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"fuel_type"</span>, <span class="st">"year"</span>, <span class="st">"region"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"pop_cooking_mln"</span>).<span class="bu">sum</span>())</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    .with_columns(prop_pop<span class="op">=</span>(pl.col(<span class="st">"pop_cooking_mln"</span>)<span class="op">/</span>pl.col(<span class="st">"pop_cooking_mln"</span>).<span class="bu">sum</span>())</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                            .over(<span class="st">"year"</span>, <span class="st">"region"</span>))</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_area(aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"prop_pop"</span>, fill<span class="op">=</span><span class="st">"fuel_type"</span>))</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>facet_wrap(<span class="st">"region"</span>, ncol<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>scale_fill_cmap_d()</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>theme_linedraw()</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>labs(title<span class="op">=</span><span class="st">"Energy mix per world region"</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>        subtitle<span class="op">=</span><span class="st">"From biomass to natural gas"</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"Share of population"</span>, x<span class="op">=</span><span class="st">"Year"</span>, fill<span class="op">=</span><span class="st">"Fuel Type"</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-33-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1b8fedbe" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># When the categories are known up front use Enum. When you don't know the categories or they are not fixed then you use Categorical</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fill_null(strategy=)</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># fill_nan()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Lund University</p>
</div>   
    <div class="nav-footer-center">
<p>Data Literacy with Python</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Follow us on  
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/lunduniversity">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/lunduniversity/">
      <i class="bi bi-instagram" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/school/lunduniversity/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/user/LundUniversity">
      <i class="bi bi-youtube" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/lunduniversity">
      <i class="bi bi-facebook" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>