<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Wrangling – DATA24</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-75f85ff3afe47a507ba5bdac098e00a3.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-4a65af601ebb7923055384dba408bd6e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
div.callout-challenge.callout {
  border-left-color: firebrick;
}
div.callout-challenge.callout-style-default > .callout-header {
  background-color: rgb(from firebrick r g b / 13%);
}
div.callout-challenge .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-challenge.callout-style-default .callout-icon::before, div.callout-challenge.callout-titled .callout-icon::before {
  content: '🛠️';
  background-image: none;
}
div.callout-question.callout {
  border-left-color: pink;
}
div.callout-question.callout-style-default > .callout-header {
  background-color: rgb(from pink r g b / 13%);
}
div.callout-question .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-question.callout-style-default .callout-icon::before, div.callout-question.callout-titled .callout-icon::before {
  content: '🧠';
  background-image: none;
}
</style>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./brand/LU_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DATA24</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./visualization.html"> 
<span class="menu-text">Visualization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./wrangling.html" aria-current="page"> 
<span class="menu-text">Wrangling</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./pivotjoin.html"> 
<span class="menu-text">Pivots and joins</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./sharing.html"> 
<span class="menu-text">Sharing</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#video-1-data" id="toc-video-1-data" class="nav-link active" data-scroll-target="#video-1-data">VIDEO 1: Data</a></li>
  <li><a href="#video-2-data-import" id="toc-video-2-data-import" class="nav-link" data-scroll-target="#video-2-data-import">VIDEO 2: Data import</a></li>
  <li><a href="#video-3-select-drop" id="toc-video-3-select-drop" class="nav-link" data-scroll-target="#video-3-select-drop">VIDEO 3 Select/ Drop</a></li>
  <li><a href="#video-4-selectors" id="toc-video-4-selectors" class="nav-link" data-scroll-target="#video-4-selectors">VIDEO 4 Selectors</a></li>
  <li><a href="#video-5-filter" id="toc-video-5-filter" class="nav-link" data-scroll-target="#video-5-filter">VIDEO 5 Filter</a></li>
  <li><a href="#video-6-deaths-data" id="toc-video-6-deaths-data" class="nav-link" data-scroll-target="#video-6-deaths-data">VIDEO 6 Deaths data</a></li>
  <li><a href="#video-7-mutating-with-columns" id="toc-video-7-mutating-with-columns" class="nav-link" data-scroll-target="#video-7-mutating-with-columns">VIDEO 7 Mutating with columns</a></li>
  <li><a href="#video-8-summaries" id="toc-video-8-summaries" class="nav-link" data-scroll-target="#video-8-summaries">VIDEO 8 Summaries</a></li>
  <li><a href="#video-9-final-plot-greenscreen-3-min" id="toc-video-9-final-plot-greenscreen-3-min" class="nav-link" data-scroll-target="#video-9-final-plot-greenscreen-3-min">VIDEO 9 Final plot {greenscreen} ~ 3 min</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Wrangling</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<section id="video-1-data" class="level1">
<h1>VIDEO 1: Data</h1>
<p>Welcome to the module on data wrangling! In the last lesson, we explored a small, but exciting <code>gapminder</code> dataset, and created quite a few visualizations with it. But in real-world scenarios, datasets are often much larger, which brings new challenges. We may need to focus on specific subsets - maybe observations from a single time period or a set of variables related to a particular phenomenon.</p>
<p>In this module, we’ll learn how to subset data and create meaningful summaries that provide a high-level overview of trends or differences between groups. Summarized data is typically presented in a tabular form, so we’ll also introduce a package for creating clear, professional-looking tables.</p>
<p>Most importantly, we’ll dive into the blazingly fast Polars package for data manipulation. As I mentioned earlier, Polars is powered by Rust, a high-performance programming language. Its core functionality is exposed to Python but can also be accessed from other languages. This means that the data wrangling skills you gain here will be transferable beyond Python.</p>
<p>But first, let’s load the necessary packages for this module. In Python, it’s common to use the alias <code>pl</code> for Polars. We’ll also use a submodule called <code>polars.selectors</code>, aliasing it as <code>cs</code> - don’t worry, we’ll cover selectors in more detail soon. We’ll also import everything from Plotnine for data visualization and bring in the main function from the <code>great_tables</code> package for generating beautifully looking tables.</p>
<p>Here’s the setup code. Place it in its own cell in your notebook and run it:</p>
<p>&lt; PAUSE &gt;</p>
<div id="setup" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> great_tables <span class="im">import</span> GT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s explore our data. We’ll be looking at the WHO dataset about household pollution around the world.</p>
<p>Household air pollution is primarily caused by burning polluting fuels like wood, animal dung, charcoal, agricultural waste, and kerosene using open fires or inefficient stoves. Over 2 billion people around the world rely on these fuels for cooking, heating, and lighting. The poor combustion of these fuels leads to numerous health issues, such as pneumonia in children, and chronic illnessess like obstructive pulmonary disease, lung cancer, stroke, and cardiovascular problems in adults.</p>
<p>This is a complex issue, and like many complex issues, it can be examined from different angles. We have three datasets to work with:</p>
<ul>
<li>Causes of death linked to household pollution</li>
<li>Types of fuel used for cooking in various countries, and</li>
<li>Proportion of the population with access to clean cooking fuels</li>
</ul>
<p>Each dataset offers a unique perspective on this issue. Let’s dive in and start exploring!</p>
</section>
<section id="video-2-data-import" class="level1">
<h1>VIDEO 2: Data import</h1>
<p>In this section, we’ll start working with the datasets about household air pollution. These datasets are stored as comma-separated value, or CSV files. CSV is a simple text format often used for storing tabular data. Think of it as a stripped-down version of Excel - just the data, no formatting or formulas. In fact, you can even open CSV files directly in Excel, if you want to take a look at them.</p>
<p>We’ve prepared these datasets for you and stored them in the course repository on GitHub. While Polars allows us to read files directly from remote locations, you can also download the files and the load them into Python from your local project directory.</p>
<p>Here’s the code to read the three datasets we’ll use. Add these lines to a new cell in your notebook and run it.</p>
<p>&lt; PAUSE &gt;</p>
<div id="ef086d08" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>hhap_deaths <span class="op">=</span> pl.read_csv(<span class="st">"https://bit.ly/data24-hhap-deaths"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fuel_types <span class="op">=</span> pl.read_csv(<span class="st">"https://bit.ly/data24-cooking-by-fuel-type"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>clean_fuels <span class="op">=</span> pl.read_csv(<span class="st">"https://bit.ly/data24-clean-fuels-cooking"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s break this down. We’re using the <code>read_csv()</code> function from Polars to load the data. This function takes a single mandatory argument: the file path, written as a string in quotes. The equal sign indicates that we assign the content of the file to the variable, listed on the left. The function is located in the <code>polars</code> package. This is why it is prepended with <code>pl.</code> prefix.</p>
<p>The <code>read_csv()</code> function returns a data frame. So, from now on, we can simply refer to <code>h-hap</code> underscore <code>deaths</code> (<code>hhap_deaths</code>) whenever we need to access the first dataframe without needing to re-import it.</p>
<p>To understand the data, it’s helpful to preview it. You do it in a few different ways. For instance, you can simply type the name of a dataset - like <code>clean_fuels</code>. It will display a preview of the first five and last five rows of the corresponding data frame.</p>
<p>Rows in a data frame are often referred to as observations or records, while columns are known as variables or features. If you want to see more rows than the default preview, you can use the <code>.head()</code> method and specify the number of rows to display:</p>
<p>&lt; PAUSE &gt;</p>
<div id="d571c721" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2022</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"NIU"</td>
<td>"Niue"</td>
<td>2022</td>
<td>0.002</td>
<td>98.5</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"TKL"</td>
<td>"Tokelau"</td>
<td>2022</td>
<td>0.0004</td>
<td>28.3</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"COK"</td>
<td>"Cook Islands"</td>
<td>2022</td>
<td>0.013</td>
<td>72.7</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"PLW"</td>
<td>"Palau"</td>
<td>2022</td>
<td>0.007</td>
<td>29.45</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"STP"</td>
<td>"Sao Tome and Principe"</td>
<td>2022</td>
<td>0.009</td>
<td>4.1</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"FSM"</td>
<td>"Micronesia (Federated States o…</td>
<td>2022</td>
<td>0.014</td>
<td>13.2</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"BDI"</td>
<td>"Burundi"</td>
<td>2022</td>
<td>0.013</td>
<td>0.1</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"NRU"</td>
<td>"Nauru"</td>
<td>2022</td>
<td>0.011</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"TUV"</td>
<td>"Tuvalu"</td>
<td>2022</td>
<td>0.009</td>
<td>75.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>You may have noticed the parentheses around the code block. This little trick allows us to break the code into multiple lines without worrying about indentation. To keep things readable I will place each methods on a new line. Normally, Python enforces strict indentation rules. But because we wrap our code into outer patherentheses, we override that requirement. In this case, we prioritize readability over traditional coding style.</p>
<p>Previewing the first few rows gives us an initial sense of the dataset’s structure and content. If you’re curious about the last few rows, there’s also a <code>.tail()</code> method you can use in a similar way.</p>
<p>For a broader overview of your data, you can use the <code>.describe()</code> method:</p>
<p>&lt; PAUSE &gt;</p>
<div id="31df25e8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    .describe())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 7)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">statistic</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"count"</td>
<td>"6402"</td>
<td>"6402"</td>
<td>"6402"</td>
<td>6402.0</td>
<td>6402.0</td>
<td>6402.0</td>
</tr>
<tr class="even">
<td>"null_count"</td>
<td>"0"</td>
<td>"0"</td>
<td>"0"</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"mean"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2006.0</td>
<td>19.29797</td>
<td>61.080069</td>
</tr>
<tr class="even">
<td>"std"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>9.522648</td>
<td>73.100935</td>
<td>39.952764</td>
</tr>
<tr class="odd">
<td>"min"</td>
<td>"Africa"</td>
<td>"AFG"</td>
<td>"Afghanistan"</td>
<td>1990.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"25%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>1998.0</td>
<td>0.23</td>
<td>16.6</td>
</tr>
<tr class="odd">
<td>"50%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2006.0</td>
<td>2.24</td>
<td>78.0</td>
</tr>
<tr class="even">
<td>"75%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2014.0</td>
<td>10.24</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"max"</td>
<td>"Western Pacific"</td>
<td>"ZWE"</td>
<td>"Zimbabwe"</td>
<td>2022.0</td>
<td>1257.0</td>
<td>100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The <code>.describe()</code> method provides a statistical summary of numerical columns, including key metrics like the mean, standard deviation, minimum, maximum, and various quantiles. It’s especially useful for quickly gaining insights into large datasets.</p>
<p>One important note: if a column contains missing values, Polars displays them as <code>null</code>. Since Polars treats missing values as “contagious,” any operation involving them will also produce missing values in the output. This behavior applies to all statistical operations, and we’ll explore more examples later.</p>
<p>Both <code>.head()</code> and <code>.describe()</code> return a DataFrame, allowing you to chain these operations together. Method chaining is a powerful technique that makes your code cleaner, more readable, and easier to maintain.</p>
<p>Now, here are a couple of challenges for you to practice method chaining:</p>
<ol type="1">
<li>Take the first 25 records from <code>clean_fuels</code> DataFrame and generate a statistical summary.</li>
<li>Compute the statistical summary of the entire dataset, and then extract only the quantile summaries for each column, including the minimum, maximum, and the 25th, 50th and 75th percentiiles.</li>
</ol>
<div class="callout callout-style-default callout-challenge callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Take first 25 records of <code>clean_fuels</code> data frame and then calculate statistical summary</li>
<li>Compute statistical summary of the whole data and then present only quantile summaries of each column. The quantiles include minimum, maximum, as well as the 25th, 50th and 75th quantile.</li>
</ul>
</div>
</div>
<p>&lt; PAUSE &gt;</p>
<div id="6c28cd50" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">25</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    .describe())</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    .describe()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    .tail(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 7)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">statistic</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"min"</td>
<td>"Africa"</td>
<td>"AFG"</td>
<td>"Afghanistan"</td>
<td>1990.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"25%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>1998.0</td>
<td>0.23</td>
<td>16.6</td>
</tr>
<tr class="odd">
<td>"50%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2006.0</td>
<td>2.24</td>
<td>78.0</td>
</tr>
<tr class="even">
<td>"75%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2014.0</td>
<td>10.24</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"max"</td>
<td>"Western Pacific"</td>
<td>"ZWE"</td>
<td>"Zimbabwe"</td>
<td>2022.0</td>
<td>1257.0</td>
<td>100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Sometimes a dataset may have so many columns that methods like <code>.head()</code> or <code>.describe()</code> don’t quite give a full overview. In such cases, Polars offers a particularly useful method: <code>.glimpse()</code>.</p>
<p>The <code>.glimpse()</code> method displays the dataset’s structure horizontally, listing each variable as a row. This format makes it easier to scan through all columns, even on a limited screen. Here’s how it looks in action::</p>
<p>&lt; PAUSE &gt;</p>
<div id="2a0f4dd7" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    .glimpse())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6402
Columns: 6
$ region                       &lt;str&gt; 'Africa', 'Western Pacific', 'Western Pacific', 'Western Pacific', 'Western Pacific', 'Africa', 'Western Pacific', 'Africa', 'Western Pacific', 'Western Pacific'
$ country_code                 &lt;str&gt; 'SSD', 'NIU', 'TKL', 'COK', 'PLW', 'STP', 'FSM', 'BDI', 'NRU', 'TUV'
$ country                      &lt;str&gt; 'South Sudan', 'Niue', 'Tokelau', 'Cook Islands', 'Palau', 'Sao Tome and Principe', 'Micronesia (Federated States of)', 'Burundi', 'Nauru', 'Tuvalu'
$ year                         &lt;i64&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022
$ pop_clean_fuels_cooking_mln  &lt;f64&gt; 0.0, 0.002, 0.0004, 0.013, 0.007, 0.009, 0.014, 0.013, 0.011, 0.009
$ prop_clean_fuels_cooking_pct &lt;f64&gt; 0.0, 98.5, 28.3, 72.7, 29.45, 4.1, 13.2, 0.1, 100.0, 75.2
</code></pre>
</div>
</div>
<p>Now, here’s a question for you: What happens if you try to use <code>glimpse()</code> in a method chain? Can you chain the operation <code>head()</code> after calling <code>glimpse()</code>? What do you think the output will be?</p>
<div class="callout callout-style-default callout-question callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can you chain the operation <code>head()</code> after calling <code>glimpse()</code>? What do you think the output will be?</p>
</div>
</div>
<p>&lt; PAUSE &gt;</p>
<p>The answer is: no, you cannot. <code>glimpse()</code>, does not return you a data frame. Instead, the output of <code>glimpse()</code> is the text printout meant solely for viewing. No further operations can be applied to it. If you attempt to chain additional methods, you’ll get an error. Give it a try! Polars will throw an error saying that the <code>head()</code> method cannot be applied to a <code>NoneType</code>, which is the type of output <code>glimpse()</code> returns.</p>
<p>If you understand how to use <code>head()</code>, <code>tail()</code>, <code>describe()</code>, and <code>glimpse()</code>, you have powerful tools at your disposal to explore and familiarize yourself with any dataset before diving deeper into your analysis.</p>
</section>
<section id="video-3-select-drop" class="level1">
<h1>VIDEO 3 Select/ Drop</h1>
<p>One of the most common tasks in data analysis is selecting specific variables or columns from a dataset. Let’s start by pulling out the country information from the <code>clean_fuels</code> data. Pause the video for a moment and try running this code:</p>
<p>&lt; PAUSE &gt;</p>
<div id="5e581f03" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.col(<span class="st">"country"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country</th>
</tr>
<tr class="even">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"South Sudan"</td>
</tr>
<tr class="even">
<td>"Niue"</td>
</tr>
<tr class="odd">
<td>"Tokelau"</td>
</tr>
<tr class="even">
<td>"Cook Islands"</td>
</tr>
<tr class="odd">
<td>"Palau"</td>
</tr>
<tr class="even">
<td>…</td>
</tr>
<tr class="odd">
<td>"Austria"</td>
</tr>
<tr class="even">
<td>"Germany"</td>
</tr>
<tr class="odd">
<td>"Sweden"</td>
</tr>
<tr class="even">
<td>"Portugal"</td>
</tr>
<tr class="odd">
<td>"India"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here, we’re using the <code>select()</code> method to isolate a column. Notice how the column name is wrapped in the <code>pl.col()</code> function. This wrapper explicitly tells Polars that we’re referring to a column in the dataframe.</p>
<p>But here’s something cool - you can skip the <code>pl.col()</code> wrapper in certain cases! For example, this code:</p>
<p>&lt; SMALL PAUSE &gt;</p>
<div id="61e8ef72" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">"country_code"</span>, <span class="st">"country"</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"SSD"</td>
<td>"South Sudan"</td>
</tr>
<tr class="even">
<td>"NIU"</td>
<td>"Niue"</td>
</tr>
<tr class="odd">
<td>"TKL"</td>
<td>"Tokelau"</td>
</tr>
<tr class="even">
<td>"COK"</td>
<td>"Cook Islands"</td>
</tr>
<tr class="odd">
<td>"PLW"</td>
<td>"Palau"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"AUT"</td>
<td>"Austria"</td>
</tr>
<tr class="even">
<td>"DEU"</td>
<td>"Germany"</td>
</tr>
<tr class="odd">
<td>"SWE"</td>
<td>"Sweden"</td>
</tr>
<tr class="even">
<td>"PRT"</td>
<td>"Portugal"</td>
</tr>
<tr class="odd">
<td>"IND"</td>
<td>"India"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>…does the exact same thing as this:</p>
<div id="09fc79af" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.col(<span class="st">"country_code"</span>), pl.col(<span class="st">"country"</span>)))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"SSD"</td>
<td>"South Sudan"</td>
</tr>
<tr class="even">
<td>"NIU"</td>
<td>"Niue"</td>
</tr>
<tr class="odd">
<td>"TKL"</td>
<td>"Tokelau"</td>
</tr>
<tr class="even">
<td>"COK"</td>
<td>"Cook Islands"</td>
</tr>
<tr class="odd">
<td>"PLW"</td>
<td>"Palau"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"AUT"</td>
<td>"Austria"</td>
</tr>
<tr class="even">
<td>"DEU"</td>
<td>"Germany"</td>
</tr>
<tr class="odd">
<td>"SWE"</td>
<td>"Sweden"</td>
</tr>
<tr class="even">
<td>"PRT"</td>
<td>"Portugal"</td>
</tr>
<tr class="odd">
<td>"IND"</td>
<td>"India"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&lt; PAUSE &gt;</p>
<p>Pretty neat, right? The <code>select()</code> method can directly interpret strings as column names, making your code a little cleaner and quicker to write.</p>
<p>When you wrap a column name in <code>pl.col()</code>, you’re creating an expression. An expression is like a recepie - it doesn’t do anything on its own. For example, if you run this code:</p>
<p>&lt; SMALL PAUSE &gt;</p>
<div id="3642dc3d" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pl.col(<span class="st">"country_code"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
col("country_code")
</div>
</div>
<p>…nothing happens. It just returns something called an “unevaluated expression”. But when you evaluate that expression in the context of a dataset, it returns something useful. For instance:</p>
<p>&lt; PAUSE &gt;</p>
<div id="27d0b827" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.col(<span class="st">"country_code"</span>)))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country_code</th>
</tr>
<tr class="even">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"SSD"</td>
</tr>
<tr class="even">
<td>"NIU"</td>
</tr>
<tr class="odd">
<td>"TKL"</td>
</tr>
<tr class="even">
<td>"COK"</td>
</tr>
<tr class="odd">
<td>"PLW"</td>
</tr>
<tr class="even">
<td>…</td>
</tr>
<tr class="odd">
<td>"AUT"</td>
</tr>
<tr class="even">
<td>"DEU"</td>
</tr>
<tr class="odd">
<td>"SWE"</td>
</tr>
<tr class="even">
<td>"PRT"</td>
</tr>
<tr class="odd">
<td>"IND"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here, the <code>select()</code> method acts as an evaluation environment, turning the <code>pl.col()</code> expression into actual data. <code>select()</code> is one of the several methods in Polars that can evaluate expressions. While <code>select()</code> is highly versatile and can do other things as well, for now, we’ll focus on its simplest use case: extracting columns from a data frame.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>select()</code> is one of the several methods in Polars that can evaluate expressions.</p>
</div>
</div>
<p>The <code>pl.col()</code> wrapper is super flexible, and it’s going to be central as we build more advanced expressions in Polars. For instance, you can use <code>pl.col()</code> to refer to multiple columns simultaneously:</p>
<p>&lt; PAUSE &gt;</p>
<div id="c62ea427" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.col(<span class="st">"country_code"</span>, <span class="st">"country"</span>)))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"SSD"</td>
<td>"South Sudan"</td>
</tr>
<tr class="even">
<td>"NIU"</td>
<td>"Niue"</td>
</tr>
<tr class="odd">
<td>"TKL"</td>
<td>"Tokelau"</td>
</tr>
<tr class="even">
<td>"COK"</td>
<td>"Cook Islands"</td>
</tr>
<tr class="odd">
<td>"PLW"</td>
<td>"Palau"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"AUT"</td>
<td>"Austria"</td>
</tr>
<tr class="even">
<td>"DEU"</td>
<td>"Germany"</td>
</tr>
<tr class="odd">
<td>"SWE"</td>
<td>"Sweden"</td>
</tr>
<tr class="even">
<td>"PRT"</td>
<td>"Portugal"</td>
</tr>
<tr class="odd">
<td>"IND"</td>
<td>"India"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Sometimes, typing out long column names can feel like a chore, especially when you’re working with many columns. But don’t worry - Polars makes it easy to select columns by their position in the dataset. For example, this code selects the second and third columns by their numerical index:</p>
<p>&lt; PAUSE &gt;</p>
<div id="df0eb0a3" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.nth(<span class="dv">1</span>,<span class="dv">2</span>)))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"SSD"</td>
<td>"South Sudan"</td>
</tr>
<tr class="even">
<td>"NIU"</td>
<td>"Niue"</td>
</tr>
<tr class="odd">
<td>"TKL"</td>
<td>"Tokelau"</td>
</tr>
<tr class="even">
<td>"COK"</td>
<td>"Cook Islands"</td>
</tr>
<tr class="odd">
<td>"PLW"</td>
<td>"Palau"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"AUT"</td>
<td>"Austria"</td>
</tr>
<tr class="even">
<td>"DEU"</td>
<td>"Germany"</td>
</tr>
<tr class="odd">
<td>"SWE"</td>
<td>"Sweden"</td>
</tr>
<tr class="even">
<td>"PRT"</td>
<td>"Portugal"</td>
</tr>
<tr class="odd">
<td>"IND"</td>
<td>"India"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note that the column indices in Polars are 0-based. That means the first column is index 0, the second column is index 1, and so on.</p>
<p>What about negative numbers? They’re a handy shortcut for selecting columns from the back of the dataset. For instance, <code>-1</code> refers to the last column, and this code will select the first and last columns:</p>
<p>&lt; PAUSE &gt;</p>
<div id="d2a655ab" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.nth(<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>)))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>98.5</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>28.3</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>72.7</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>29.45</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"South-East Asia"</td>
<td>11.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>A note of caution: Selecting columns by the order of their appearance can be risky. If your dataset’s structure changes, you might accidentally select the wrong columns. So, use the <code>nth()</code> method sparingly.</p>
<p>Now, let’s talk about the opposite of <code>select()</code> - the <code>drop()</code> method. The <code>drop()</code> method removes specific columns from your dataset, leaving everything else intact. For example:</p>
<p>&lt; PAUSE &gt;</p>
<div id="1125f7cc" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    .drop(pl.col(<span class="st">"country"</span>), pl.col(<span class="st">"region"</span>)))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"SSD"</td>
<td>2022</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"NIU"</td>
<td>2022</td>
<td>0.002</td>
<td>98.5</td>
</tr>
<tr class="odd">
<td>"TKL"</td>
<td>2022</td>
<td>0.0004</td>
<td>28.3</td>
</tr>
<tr class="even">
<td>"COK"</td>
<td>2022</td>
<td>0.013</td>
<td>72.7</td>
</tr>
<tr class="odd">
<td>"PLW"</td>
<td>2022</td>
<td>0.007</td>
<td>29.45</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"AUT"</td>
<td>1990</td>
<td>7.72</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"DEU"</td>
<td>1990</td>
<td>79.12</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"SWE"</td>
<td>1990</td>
<td>8.57</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"PRT"</td>
<td>1990</td>
<td>9.95</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"IND"</td>
<td>1990</td>
<td>96.58</td>
<td>11.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Dropping is equivalent to selecting all columns <strong>except</strong> the ones you want to exclude. Here’s how could would write the dropping expression using in terms of selection:</p>
<p>&lt; PAUSE &gt;</p>
<div id="f0532735" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.<span class="bu">all</span>().exclude(<span class="st">"country"</span>, <span class="st">"region"</span>)))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"SSD"</td>
<td>2022</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"NIU"</td>
<td>2022</td>
<td>0.002</td>
<td>98.5</td>
</tr>
<tr class="odd">
<td>"TKL"</td>
<td>2022</td>
<td>0.0004</td>
<td>28.3</td>
</tr>
<tr class="even">
<td>"COK"</td>
<td>2022</td>
<td>0.013</td>
<td>72.7</td>
</tr>
<tr class="odd">
<td>"PLW"</td>
<td>2022</td>
<td>0.007</td>
<td>29.45</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"AUT"</td>
<td>1990</td>
<td>7.72</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"DEU"</td>
<td>1990</td>
<td>79.12</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"SWE"</td>
<td>1990</td>
<td>8.57</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"PRT"</td>
<td>1990</td>
<td>9.95</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"IND"</td>
<td>1990</td>
<td>96.58</td>
<td>11.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The <code>pl.all()</code> function refers to all columns, and the <code>.exclude()</code> method lets you refine the selection by removing specific ones.</p>
<p>A quick reminder: dropping columns doesn’t modify your original dataset. It only affects the result of that query. Unless you explicitly overwrite the original dataframe, everything stays the same. So feel free to experiment!</p>
<p>Now it’s your turn. Select the columns related to the number and the proportion of the people with access to clean fuels. Try both <em>selecting</em> by name or index, and <em>dropping</em> the columns you dont need.</p>
<div class="callout callout-style-default callout-challenge callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Select the columns related to the number and the proportion of people with access to clean fuel for cooking from the <code>clean_fuels</code> dataset.</p>
</div>
</div>
<p>Please, pause the video and try couple of different ways of selecting these columns.</p>
<p>&lt; PAUSE &gt;</p>
<div id="8cc42bc0" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    .select(pl.col(<span class="st">"pop_clean_fuels_cooking_mln"</span>), </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"prop_clean_fuels_cooking_pct"</span>))) </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    .select(pl.nth(<span class="op">-</span><span class="dv">2</span>,<span class="op">-</span><span class="dv">1</span>))) </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>(clean_fuels  </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    .drop(<span class="st">"region"</span>, <span class="st">"country_code"</span>, <span class="st">"country"</span>, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>0.002</td>
<td>98.5</td>
</tr>
<tr class="odd">
<td>0.0004</td>
<td>28.3</td>
</tr>
<tr class="even">
<td>0.013</td>
<td>72.7</td>
</tr>
<tr class="odd">
<td>0.007</td>
<td>29.45</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>7.72</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>79.12</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>8.57</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>9.95</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>96.58</td>
<td>11.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Got it? Great! Both approaches, selection and dropping, give you the same result. Expressions like these make your analysis more dynamic and efficient, so you can quickly adapt to different datasets or scenarios.</p>
</section>
<section id="video-4-selectors" class="level1">
<h1>VIDEO 4 Selectors</h1>
<p>Selecting columns is such a common task that Polars has a dedicated module for it. It is called <code>polars.selectors</code>. This module provides a collection of methods specifically designed to simplify picking columns from a data frame. <code>polars.selectors</code> is often aliased as <code>cs</code> for convenience.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Have a look at the <a href="https://docs.pola.rs/api/python/stable/reference/selectors.html">documentation for selectors</a>.</p>
</div>
</div>
<p>Let’s make sure we import the selectors module:</p>
<p>&lt; PAUSE &gt;</p>
<div id="bd4a4037" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Among the most useful selectors are, of course, selectors by name and by column index. Although, for this we might not really need selectors, because those can be picked out with <code>pl.col()</code> and <code>pl.nth()</code>.</p>
<p>&lt; PAUSE &gt;</p>
<div id="595a71ae" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    .select(cs.by_name(<span class="st">"region"</span>, <span class="st">"country"</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># note python is 0-based</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    .select(cs.by_index(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">5</span>))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>"South Sudan"</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"Niue"</td>
<td>98.5</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"Tokelau"</td>
<td>28.3</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"Cook Islands"</td>
<td>72.7</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"Palau"</td>
<td>29.45</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"Austria"</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"Germany"</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"Sweden"</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"Portugal"</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"South-East Asia"</td>
<td>"India"</td>
<td>11.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Selecting first and last columns are so common, there are useful shorthands <code>cs.first()</code> and <code>cs.last()</code>. To select all columns <em>other</em> than the one you specified, you can use the tilde ~ operator. Tilde operator works with all methods in the <code>cs.</code> module and negates the selection. For example <code>~cs.last()</code> refers to all columns other than the last one.</p>
<p>Selectors can target columns based on their data types! For example, <code>cs.numeric()</code> picks all numeric columns. And if you want non-numeric columns, you can just negate it with ~.</p>
<p>And now it is your turn! Practice selecting first, everyhing other than the first, as well as all non-numeric columns. Use selector class for this. Pause the video and give it a try!</p>
<p>&lt; PAUSE &gt;</p>
<div class="callout callout-style-default callout-challenge callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>polars.selectors</code> aliased as <code>cs.</code> to select - first column - everyhing other than the first column - all non-numeric columns</p>
</div>
</div>
<div id="b9370b1b" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    .select(cs.first())</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># not first</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    .select(<span class="op">~</span>cs.first())</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># not numeric</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    .select(<span class="op">~</span>cs.numeric())</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"NIU"</td>
<td>"Niue"</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"TKL"</td>
<td>"Tokelau"</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"COK"</td>
<td>"Cook Islands"</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"PLW"</td>
<td>"Palau"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"AUT"</td>
<td>"Austria"</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"DEU"</td>
<td>"Germany"</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"SWE"</td>
<td>"Sweden"</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"PRT"</td>
<td>"Portugal"</td>
</tr>
<tr class="odd">
<td>"South-East Asia"</td>
<td>"IND"</td>
<td>"India"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Fantastic work! With a wide menu of <code>polars.selectors</code>, plus the column and index-based expressions like <code>pl.col()</code> and <code>pl.nth()</code>, Polars gives you incredible flexibility in working with your data. These tools will become invaluable as we move into crafting more complex expressions.</p>
<p>Stay tuned - there’s a lot more to explore!</p>
</section>
<section id="video-5-filter" class="level1">
<h1>VIDEO 5 Filter</h1>
<p>Now let’s talk about filtering - an essential part of data analysis. In Polars, you can use filtering to subset your data based on logical conditions, using the magic of expressions. Logical operations are one of the simplest and most common use cases for expressions. For example, you can compare every value in the <code>region</code> column to the string “Europe”. If there’s a match, Polars returns True; otherwise, it returns False.</p>
<p>Let’s see how this works in code:</p>
<p>&lt; PAUSE &gt;</p>
<div id="38af0fa3" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"region"</span>)<span class="op">==</span><span class="st">"Europe"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1_749, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"SMR"</td>
<td>"San Marino"</td>
<td>2022</td>
<td>0.034</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"MCO"</td>
<td>"Monaco"</td>
<td>2022</td>
<td>0.04</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"FRO"</td>
<td>"Faroe Islands"</td>
<td>2022</td>
<td>0.05</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"AND"</td>
<td>"Andorra"</td>
<td>2022</td>
<td>0.077</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"ISL"</td>
<td>"Iceland"</td>
<td>2022</td>
<td>0.35</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BLR"</td>
<td>"Belarus"</td>
<td>1990</td>
<td>7.48</td>
<td>73.2</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"AUT"</td>
<td>"Austria"</td>
<td>1990</td>
<td>7.72</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"DEU"</td>
<td>"Germany"</td>
<td>1990</td>
<td>79.12</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"SWE"</td>
<td>"Sweden"</td>
<td>1990</td>
<td>8.57</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"PRT"</td>
<td>"Portugal"</td>
<td>1990</td>
<td>9.95</td>
<td>100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here, the <code>filter()</code> method applies the logical condition, and only rows where the region is “Europe” are included in the result. Notice that for exact comparisons, we use the double equals sign <code>==</code>. Similarly, for inequalities, we can use operators like <code>&lt;=</code>, <code>&gt;=</code>, <code>&lt;</code>, or <code>&gt;</code>. Not equal is spelled out as <code>!=</code>.</p>
<p>But filtering doesn’t stop there - you can combine multiple conditions to create more complex filters. Just write multiple expressions into the <code>.filter()</code> method, separating them with a comma!</p>
<p>Here’s a challenge for you. Can you find all the European countries where the majority of the population lacked access to clean fuels the end of 2022? Take a moment to write this expression. Pause the video if you need to.</p>
<p>&lt; PAUSE &gt;</p>
<div class="callout callout-style-default callout-challenge callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Were there any countries in Europe in 2022 where the majority of people lacked access to clean fuel for cooking?</p>
</div>
</div>
<div id="a73a5953" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"region"</span>)<span class="op">==</span><span class="st">"Europe"</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"year"</span>)<span class="op">==</span><span class="dv">2022</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"prop_clean_fuels_cooking_pct"</span>)<span class="op">&lt;</span><span class="dv">50</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2022</td>
<td>1.43</td>
<td>41.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>What did you get? Oh, wow! Over half the population of Bosnia still lacks access to clean fuels for cooking. That’s a striking insight!</p>
<p>Let’s zoom in on Bosnia to better understand the data. Bosnia’s country code is “BIH”, but you can also use country name to filter, if you prefer.</p>
<p>&lt; PAUSE &gt;</p>
<div id="090934ee" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>clean_fuels</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"country_code"</span>)<span class="op">==</span><span class="st">"BIH"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (33, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2022</td>
<td>1.43</td>
<td>41.1</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2021</td>
<td>1.43</td>
<td>40.9</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2020</td>
<td>1.43</td>
<td>40.85</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2019</td>
<td>1.47</td>
<td>42.05</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2018</td>
<td>1.43</td>
<td>40.8</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1994</td>
<td>2.29</td>
<td>58.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1993</td>
<td>2.41</td>
<td>58.9</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1992</td>
<td>2.47</td>
<td>58.25</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1991</td>
<td>2.6</td>
<td>59.5</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1990</td>
<td>2.64</td>
<td>59.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We are interested in tracking how the proportion of the population with access to clean fuels for cooking has changed over the years. Let’s create a plot, with the year on the x-axis and the proportion of population on the y-axis. If you remember from the Plotnine module, the dataset goes into the first argument of the ggplot function.</p>
<p>Here’s one way to do this:</p>
<p>&lt; PAUSE &gt;</p>
<div id="c8cf636c" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ggplot(clean_fuels.<span class="bu">filter</span>(pl.col(<span class="st">"country_code"</span>)<span class="op">==</span><span class="st">"BIH"</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_line(mapping<span class="op">=</span>aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"prop_clean_fuels_cooking_pct"</span>))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-25-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This works, but the code feels a little cluttered. It’s not immediately clear where the dataset comes from.</p>
<p>Let’s clean this up using the <code>.pipe()</code> method. The <code>.pipe()</code> method hands the data to the <code>ggplot()</code> function, placing it as the first argument.</p>
<pre><code>(data
    .some_operation()
    .other_operation()
    .pipe(ggplot)
    + ...)

# the same as
df = data.some_operation().other_operation()
ggplot(df)
+ ...
</code></pre>
<p>Pipe keeps the code clean and modular. Everything after <code>.pipe(ggplot)</code> is Plotnine-specific code.</p>
<p>&lt; PAUSE &gt;</p>
<div id="acbce0a2" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"country_code"</span>)<span class="op">==</span><span class="st">"BIH"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_line(aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"pop_clean_fuels_cooking_mln"</span>))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-26-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nice!</p>
<p>What if you’re not sure how a country’s name is spelled in the dataset? For example, is it “Czech Republic” or just “Czechia”?</p>
<p>In this case, you can use partial string matching to find it.</p>
<p>&lt; PAUSE &gt;</p>
<div id="d54d4df7" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"country"</span>).<span class="bu">str</span>.starts_with(<span class="st">"Cz"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (33, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"CZE"</td>
<td>"Czechia"</td>
<td>2022</td>
<td>10.63</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"CZE"</td>
<td>"Czechia"</td>
<td>2021</td>
<td>10.63</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"CZE"</td>
<td>"Czechia"</td>
<td>2020</td>
<td>10.63</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"CZE"</td>
<td>"Czechia"</td>
<td>2019</td>
<td>10.63</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"CZE"</td>
<td>"Czechia"</td>
<td>2018</td>
<td>10.63</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"CZE"</td>
<td>"Czechia"</td>
<td>1994</td>
<td>10.36</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"CZE"</td>
<td>"Czechia"</td>
<td>1993</td>
<td>10.36</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"CZE"</td>
<td>"Czechia"</td>
<td>1992</td>
<td>10.35</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"CZE"</td>
<td>"Czechia"</td>
<td>1991</td>
<td>10.35</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"CZE"</td>
<td>"Czechia"</td>
<td>1990</td>
<td>10.34</td>
<td>100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here, we use the <code>str.starts_with()</code> method, checking if the strings in the <code>country</code> column start with the letters “Cz.” Ah, there it is - “Czechia”!</p>
<p>Polars offers several handy string operations. For example:</p>
<ul>
<li><code>str.starts_with()</code></li>
<li><code>str.ends_with()</code> and</li>
<li><code>str.contains()</code></li>
</ul>
<p>You’ll see more of these as we progress, but these three are powerful enough to help you tackle the following challenge.</p>
<p>Filter the data for your own country and visualize the proportion of people with access to clean fuels. Once you’re happy with the subset of your data, use ggplot and everything you’ve learned about Plotnine to create a polished visualization.</p>
<p>&lt; PAUSE &gt;</p>
<div class="callout callout-style-default callout-challenge callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Visualize the proportion of people with access to clean fuels in your own country</p>
</div>
</div>
<div id="c50f57cc" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"country"</span>).<span class="bu">str</span>.starts_with(<span class="st">"Ukr"</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_line(aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"prop_clean_fuels_cooking_pct"</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>theme_seaborn()</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>labs(title<span class="op">=</span><span class="st">"Share of population with access to clean fuels in Ukraine"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="st">"Year"</span>, y<span class="op">=</span><span class="st">"Proportion, %"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-28-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This looks fantastic! Great work visualizing your country’s data.</p>
<p>In the next section, we’ll explore adding more columns to our dataset and practice advanced subsetting and visualization techniques. Stay tuned!</p>
</section>
<section id="video-6-deaths-data" class="level1">
<h1>VIDEO 6 Deaths data</h1>
<p>Let’s apply what we’ve learned about filtering to visualize the causes of death in some European countries.</p>
<p>&lt; PAUSE &gt;</p>
<div id="dc101484" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>hhap_deaths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10_800, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">cause_of_death</th>
<th data-quarto-table-cell-role="th">deaths</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"All causes"</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Acute lower respiratory infect…</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Trachea, bronchus, lung cancer…</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Ischaemic heart disease"</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>"ATG"</td>
<td>"Antigua and Barbuda"</td>
<td>2010</td>
<td>"Stroke"</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>"BOL"</td>
<td>"Bolivia (Plurinational State o…</td>
<td>2019</td>
<td>"Trachea, bronchus, lung cancer…</td>
<td>98.72</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"GNB"</td>
<td>"Guinea-Bissau"</td>
<td>2019</td>
<td>"Chronic obstructive pulmonary …</td>
<td>98.88</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"CIV"</td>
<td>"Cote d'Ivoire"</td>
<td>2019</td>
<td>"Chronic obstructive pulmonary …</td>
<td>990.6</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"TUR"</td>
<td>"Türkiye"</td>
<td>2019</td>
<td>"Chronic obstructive pulmonary …</td>
<td>997.6</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"UZB"</td>
<td>"Uzbekistan"</td>
<td>2019</td>
<td>"All causes"</td>
<td>9982.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This dataset contains both summarized and detailed breakdowns of deaths for every country and year. Take a look at the column labeled <code>cause_of_death</code>. When this column says “All causes,” it represents the total deaths for that country and year - a sum of all the other rows.</p>
<p>Let’s zoom in on Bosnia for a single year, say 2010, to understand this better.</p>
<p>&lt; PAUSE &gt;</p>
<div id="1a13a846" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(hhap_deaths</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"country_code"</span>)<span class="op">==</span><span class="st">"BIH"</span>, </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"year"</span>)<span class="op">==</span><span class="dv">2010</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">cause_of_death</th>
<th data-quarto-table-cell-role="th">deaths</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"Acute lower respiratory infect…</td>
<td>147.2</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"Stroke"</td>
<td>1685.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"Ischaemic heart disease"</td>
<td>2067.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"Chronic obstructive pulmonary …</td>
<td>365.2</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"All causes"</td>
<td>4816.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2010</td>
<td>"Trachea, bronchus, lung cancer…</td>
<td>551.7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>One of the rows is labeled “All causes” with 4,816 deaths. This total matches the sum of the individual causes of death. While it’s useful to have the total, it can lead to double counting if we include it in our analysis.</p>
<p>Now let’s expand our view to include all European countries for which we have death data. We’ll exclude the totals and focus on trends for each specific cause of death. Faceting will help us visualize these trends country by country.</p>
<p>&lt; PAUSE &gt;</p>
<div id="f847f8c9" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(hhap_deaths</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"region"</span>)<span class="op">==</span><span class="st">"Europe"</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"deaths"</span>)<span class="op">&gt;</span><span class="dv">0</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"cause_of_death"</span>)<span class="op">!=</span><span class="st">"All causes"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"deaths"</span>, color<span class="op">=</span><span class="st">"cause_of_death"</span>, group<span class="op">=</span><span class="st">"cause_of_death"</span>))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_smooth(method<span class="op">=</span><span class="st">"lm"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>facet_wrap(<span class="st">"country"</span>, scales<span class="op">=</span><span class="st">"free_y"</span>, nrow<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>theme_seaborn()</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>theme(figure_size<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>), legend_position<span class="op">=</span><span class="st">"bottom"</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-31-output-1.png" width="1920" height="960" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Most of the trends appear to be decreasing, which is good news. However, even with free y-axis for each country, the differences in scale make it hard to compare trends across countries. Look at Moldova! There’s a dramatic improvement in death cases here. Meanwhile, heart- and stroke-related deaths in the close-by Russia are on the rise.</p>
<p>It would be good to put these numbers in perspective using population of these countries. Is this something we could calculate from our <code>clean_fuels</code> dataset?</p>
</section>
<section id="video-7-mutating-with-columns" class="level1">
<h1>VIDEO 7 Mutating with columns</h1>
<p>Remember, the <code>clean_fuels</code> data told us both the number of people with access to non-polluting fuels and the proportion of the population they represent, expressed as a percentage. With this, we can reverse-engineer the population for each country.</p>
<p>To create new variables, we use the <code>with_columns()</code> method. This method lets us add or modify columns using expressions.</p>
<p>Let’s start by converting the percentage of people with access to clean fuels into a true proportion by dividing it by 100.</p>
<p>&lt; PAUSE &gt;</p>
<div id="96780b54" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    .with_columns(prop<span class="op">=</span>pl.col(<span class="st">"prop_clean_fuels_cooking_pct"</span>)<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6_402, 7)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
<th data-quarto-table-cell-role="th">prop</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2022</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"NIU"</td>
<td>"Niue"</td>
<td>2022</td>
<td>0.002</td>
<td>98.5</td>
<td>0.985</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"TKL"</td>
<td>"Tokelau"</td>
<td>2022</td>
<td>0.0004</td>
<td>28.3</td>
<td>0.283</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"COK"</td>
<td>"Cook Islands"</td>
<td>2022</td>
<td>0.013</td>
<td>72.7</td>
<td>0.727</td>
</tr>
<tr class="odd">
<td>"Western Pacific"</td>
<td>"PLW"</td>
<td>"Palau"</td>
<td>2022</td>
<td>0.007</td>
<td>29.45</td>
<td>0.2945</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"AUT"</td>
<td>"Austria"</td>
<td>1990</td>
<td>7.72</td>
<td>100.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"DEU"</td>
<td>"Germany"</td>
<td>1990</td>
<td>79.12</td>
<td>100.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"SWE"</td>
<td>"Sweden"</td>
<td>1990</td>
<td>8.57</td>
<td>100.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"PRT"</td>
<td>"Portugal"</td>
<td>1990</td>
<td>9.95</td>
<td>100.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>"South-East Asia"</td>
<td>"IND"</td>
<td>"India"</td>
<td>1990</td>
<td>96.58</td>
<td>11.1</td>
<td>0.111</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here, we create a new column called <code>prop</code>. The expression starts with a column name, and then we specify the operation: dividing by 100. The <code>prop</code> on the left of the equal sign will become a new column name. Easy enough, right?</p>
<p>Now that we have the true proportion, we can calculate the total population. Let’s divide the population by proportion.</p>
<p>&lt; PAUSE &gt;</p>
<div id="e0a3b488" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>clean_fuels_pop_df <span class="op">=</span> (clean_fuels</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    .with_columns(prop<span class="op">=</span>pl.col(<span class="st">"prop_clean_fuels_cooking_pct"</span>)<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    .with_columns( (pl.col(<span class="st">"pop_clean_fuels_cooking_mln"</span>)<span class="op">/</span>pl.col(<span class="st">"prop"</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                    .alias(<span class="st">"population"</span>))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that I wrapped the division operation in parentheses to ensure it’s evaluated correctly. I also used the <code>alias()</code> method to specify a name for the new column: <code>population</code>. This code calculates and adds two new columns:</p>
<ul>
<li><code>prop</code>: the true proportion of the population with access to clean fuels, and</li>
<li><code>population</code>: the estimated total population for each row.</li>
</ul>
<p>This looks good. Lets assign it to a variable and inspect the updated dataset.</p>
<p>&lt; PAUSE &gt;</p>
<div id="c9b7ff57" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>clean_fuels_pop_df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 9)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">statistic</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
<th data-quarto-table-cell-role="th">prop</th>
<th data-quarto-table-cell-role="th">population</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"count"</td>
<td>"6402"</td>
<td>"6402"</td>
<td>"6402"</td>
<td>6402.0</td>
<td>6402.0</td>
<td>6402.0</td>
<td>6402.0</td>
<td>6402.0</td>
</tr>
<tr class="even">
<td>"null_count"</td>
<td>"0"</td>
<td>"0"</td>
<td>"0"</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"mean"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2006.0</td>
<td>19.29797</td>
<td>61.080069</td>
<td>0.610801</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"std"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>9.522648</td>
<td>73.100935</td>
<td>39.952764</td>
<td>0.399528</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"min"</td>
<td>"Africa"</td>
<td>"AFG"</td>
<td>"Afghanistan"</td>
<td>1990.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.001112</td>
</tr>
<tr class="even">
<td>"25%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>1998.0</td>
<td>0.23</td>
<td>16.6</td>
<td>0.166</td>
<td>1.305556</td>
</tr>
<tr class="odd">
<td>"50%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2006.0</td>
<td>2.24</td>
<td>78.0</td>
<td>0.78</td>
<td>6.833333</td>
</tr>
<tr class="even">
<td>"75%"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>2014.0</td>
<td>10.24</td>
<td>100.0</td>
<td>1.0</td>
<td>22.727273</td>
</tr>
<tr class="odd">
<td>"max"</td>
<td>"Western Pacific"</td>
<td>"ZWE"</td>
<td>"Zimbabwe"</td>
<td>2022.0</td>
<td>1257.0</td>
<td>100.0</td>
<td>1.0</td>
<td>1431.66287</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Oh, look! We’ve got some <code>NaN</code>, or “Not a Number”, in the <code>population</code> column. These appear because we divided by zero, wherever the proportion was zero. Division by zero is, understandably, illegal in most places - and in Python, it results in <code>NaN</code>.</p>
<p><code>NaN</code> is a special marker for missing or undefined values. Missing values in Polars propagate through calculations, which means any further operations on these rows will also result in missing values. This is why the mean and standard deviation of the population column are also <code>NaN</code> in the summary.</p>
<p>Let’s see how many rows in our dataset contain illegal population estimates. We can use the <code>.is_nan()</code> method, which evaluates whether a column contains a <code>NaN</code> value.</p>
<p>&lt; PAUSE &gt;</p>
<div id="3f40d2fd" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>(clean_fuels_pop_df</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"population"</span>).is_nan()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (35, 8)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pop_clean_fuels_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_clean_fuels_cooking_pct</th>
<th data-quarto-table-cell-role="th">prop</th>
<th data-quarto-table-cell-role="th">population</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2022</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2021</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2020</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2019</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"SSD"</td>
<td>"South Sudan"</td>
<td>2018</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"BEN"</td>
<td>"Benin"</td>
<td>1991</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"SLE"</td>
<td>"Sierra Leone"</td>
<td>1991</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"TGO"</td>
<td>"Togo"</td>
<td>1990</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Africa"</td>
<td>"BEN"</td>
<td>"Benin"</td>
<td>1990</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"SLE"</td>
<td>"Sierra Leone"</td>
<td>1990</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Uh-oh! 35 rows! Perhaps <code>fuel_types</code>, the third dataset, could be a better source of population data?</p>
<p>The <code>fuel_types</code> dataset contains both the proportion of people using a specific cooking fuel and the absolute number of users. Since it includes multiple estimates for each country and year - one for each fuel type - it might give us more opportunities to calculate valid population estimates.</p>
<p>Go ahead and add a population column to the <code>fuel_types</code> dataset. Save the extended data frame under a new name - we will need it later.</p>
<p>&lt; PAUSE &gt;</p>
<div class="callout callout-style-default callout-challenge callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Add a population estimate to the <code>fuel_types</code> dataset and save it under a new variable name</p>
</div>
</div>
<div id="12d57585" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fuel_types_pop_df <span class="op">=</span> (fuel_types</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    .with_columns(population<span class="op">=</span>pl.col(<span class="st">"pop_cooking_mln"</span>)<span class="op">/</span>pl.col(<span class="st">"prop_cooking_pct"</span>)<span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This looks promising! Let’s have a look at our favorite Bosnia</p>
<p>&lt; PAUSE &gt;</p>
<div id="69d8ec7a" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>(fuel_types_pop_df</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"country"</span>).<span class="bu">str</span>.starts_with(<span class="st">"Bosni"</span>))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (198, 8)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country_code</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">fuel_type</th>
<th data-quarto-table-cell-role="th">pop_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_cooking_pct</th>
<th data-quarto-table-cell-role="th">population</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2022</td>
<td>"Kerosene"</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2022</td>
<td>"Coal"</td>
<td>0.003</td>
<td>0.1</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2022</td>
<td>"Charcoal"</td>
<td>0.007</td>
<td>0.2</td>
<td>3.5</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2022</td>
<td>"Gas"</td>
<td>0.23</td>
<td>6.5</td>
<td>3.538462</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>2022</td>
<td>"Electricity"</td>
<td>1.07</td>
<td>30.7</td>
<td>3.485342</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1990</td>
<td>"Kerosene"</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1990</td>
<td>"Coal"</td>
<td>0.13</td>
<td>2.9</td>
<td>4.482759</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1990</td>
<td>"Gas"</td>
<td>0.37</td>
<td>8.2</td>
<td>4.512195</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1990</td>
<td>"Biomass"</td>
<td>1.46</td>
<td>32.7</td>
<td>4.464832</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"BIH"</td>
<td>"Bosnia and Herzegovina"</td>
<td>1990</td>
<td>"Electricity"</td>
<td>1.72</td>
<td>38.6</td>
<td>4.455959</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Interesting! We still get some <code>NaN</code> values, for example, look here: in 2022 no one was using Kerosene to cook food. Thanks goodness! But now we get several estimates of Bosnia’s population - 3.0, 3.5, 3.53, 3.48 million. These slight differences arise from rounding imprecisions in the proportions or the number of people using the specific fuel type. While these variations are minor, they make it tricky to work with the data directly.</p>
<p>Wouldn’t it be nice to level out these differences, by say, averaging? In the next section, we’ll learn how to do just that: grouping and aggregating. Stay tuned!</p>
</section>
<section id="video-8-summaries" class="level1">
<h1>VIDEO 8 Summaries</h1>
<p>One of the most important tasks for data analysts is creating summaries of the data, particularly by groups. In our newly prepared dataset, we’re interested in summarizing the total population for each country by year. In Polars, this is a two-step process. First, we define the groups using <code>.group_by()</code>. Then, we aggregate the data using <code>.agg()</code>.</p>
<p>&lt; PAUSE &gt;</p>
<div id="a7a4a4b0" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>(fuel_types_pop_df</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>, <span class="st">"country"</span>, <span class="st">"year"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"population"</span>).mean())</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5_313, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">population</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Europe"</td>
<td>"Türkiye"</td>
<td>1997</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"South-East Asia"</td>
<td>"Maldives"</td>
<td>2004</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"South-East Asia"</td>
<td>"Myanmar"</td>
<td>2006</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"Türkiye"</td>
<td>1994</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>"El Salvador"</td>
<td>2013</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Eastern Mediterranean"</td>
<td>"Afghanistan"</td>
<td>2005</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Europe"</td>
<td>"North Macedonia"</td>
<td>2000</td>
<td>2.012035</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"Gambia"</td>
<td>1996</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>"Uruguay"</td>
<td>2001</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"Cameroon"</td>
<td>1990</td>
<td>NaN</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This gives us a mean population estimate for each country and year. But you might notice something suspicious - some countries and years still show <code>NaN</code> values for the population. These missing values are a result of the division by zero we encountered earlier. To address this, we have a couple of options:</p>
<p>We could drop the missing values directly before averaging, using <code>.drop_nans()</code>; OR We could filter out zero-valued records in the “proportion of population” column, which was used in the denominator of the population estimate.</p>
<p>&lt; PAUSE &gt;</p>
<div id="9d6a096f" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pop_years_df <span class="op">=</span> (fuel_types_pop_df</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>, <span class="st">"country"</span>, <span class="st">"year"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"population"</span>).drop_nans().mean().alias(<span class="st">"mean_pop"</span>))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>pop_years_df.write_csv(<span class="st">"hhap/pop_years_df.csv"</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># method 2</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>(fuel_types</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"prop_cooking_pct"</span>)<span class="op">&gt;</span><span class="dv">0</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    .with_columns(population<span class="op">=</span>pl.col(<span class="st">"pop_cooking_mln"</span>)<span class="op">/</span>pl.col(<span class="st">"prop_cooking_pct"</span>)<span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>, <span class="st">"country"</span>, <span class="st">"year"</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"population"</span>).mean())</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5_313, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">population</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Americas"</td>
<td>"Uruguay"</td>
<td>1998</td>
<td>3.280678</td>
</tr>
<tr class="even">
<td>"Eastern Mediterranean"</td>
<td>"Saudi Arabia"</td>
<td>2007</td>
<td>25.176955</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"Azerbaijan"</td>
<td>2022</td>
<td>10.083857</td>
</tr>
<tr class="even">
<td>"Eastern Mediterranean"</td>
<td>"United Arab Emirates"</td>
<td>2014</td>
<td>9.039692</td>
</tr>
<tr class="odd">
<td>"Americas"</td>
<td>"Venezuela (Bolivarian Republic…</td>
<td>1995</td>
<td>22.125122</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Africa"</td>
<td>"Eswatini"</td>
<td>2002</td>
<td>1.083508</td>
</tr>
<tr class="even">
<td>"Americas"</td>
<td>"Ecuador"</td>
<td>1998</td>
<td>12.13581</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"Albania"</td>
<td>2006</td>
<td>3.051991</td>
</tr>
<tr class="even">
<td>"Western Pacific"</td>
<td>"Viet Nam"</td>
<td>1996</td>
<td>76.387312</td>
</tr>
<tr class="odd">
<td>"Europe"</td>
<td>"Ukraine"</td>
<td>2006</td>
<td>46.604298</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now, let’s build on this idea. What if we wanted to summarize populations at a higher level - say, by region - and visualize how total population changes over time?</p>
<p>Give it a try! I suggest you start by by calculating the average population for each country and year. Then, you can group this data by region and year, summing the populations for all countries in each region. Finally, plot the results.</p>
<p>Take your time and think through what type of aggregation you would need to do.</p>
<p>&lt; PAUSE &gt;</p>
<div class="callout callout-style-default callout-challenge callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Plot the total population per region over time.</p>
</div>
</div>
<div id="deffc244" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>(fuel_types_pop_df</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>, <span class="st">"country"</span>, <span class="st">"year"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"population"</span>).drop_nans().mean())</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>, <span class="st">"year"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"population"</span>).<span class="bu">sum</span>())</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_line(aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"population"</span>, color<span class="op">=</span><span class="st">"region"</span>))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>scale_color_cmap_d()</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>theme_seaborn()</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-40-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>When we visualize the results, the trends are striking. Populations in Africa and Southeast Asia are growing at a much faster pace compared to other regions. For Africa, this growth rate might even be accelerating. On the other hand, regions like Asia and the Western Pacific show signs of population growth slowing down. These insights help us understand global population dynamics and can inform policies in areas like health, infrastructure, and environmental planning.</p>
<p>Now that we’ve explored population estimates and regional dynamics, let’s take on another challenge: examining the changes in the popularity of different cooking fuels worldwide.</p>
<p>Here’s your new task: Visualize the total number of people using each type of fuel for cooking, for every year, worldwide.</p>
<p>&lt; PAUSE &gt;</p>
<div class="callout callout-style-default callout-challenge callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Visualize the total number of people using each type of fuel for cooking, for every year, worldwide.</p>
</div>
</div>
<div id="70f6fd17" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>(fuel_types_pop_df</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"fuel_type"</span>, <span class="st">"year"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"pop_cooking_mln"</span>).drop_nans().<span class="bu">sum</span>())</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_line(aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"pop_cooking_mln"</span>, color<span class="op">=</span><span class="st">"fuel_type"</span>, group<span class="op">=</span><span class="st">"fuel_type"</span>))</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>scale_color_cmap_d()</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme_seaborn()</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-41-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This plot looks fantastic! By aggregating by fuel type and year, we can clearly see trends in fuel usage globally. But we can take this further. What if we wanted to break this data down by region? Faceting would allow us to examine the trends within each region more closely.</p>
<p>&lt; PAUSE &gt;</p>
<div id="e3f4b11c" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    fuel_types</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"fuel_type"</span>, <span class="st">"year"</span>, <span class="st">"region"</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"pop_cooking_mln"</span>).drop_nans().<span class="bu">sum</span>())</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_line(aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"pop_cooking_mln"</span>, color<span class="op">=</span><span class="st">"fuel_type"</span>, group<span class="op">=</span><span class="st">"fuel_type"</span>))</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>facet_wrap(<span class="st">"region"</span>, ncol<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>theme_seaborn()</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-42-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>With this plot, we can see unique trends for every region. Across the globe, electricity and gas are becoming more prevalent. Yet, biomass remains crucial in regions like Africa and Southeast Asia. However, there’s still a challenge here. Because the number of people using each fuel type varies so widely across regions, it’s difficult to compare the energy mix within each region.</p>
<p>To make the energy mix clearer, we can represent the share of the population relying on each fuel type within a region. This requires dividing the number of people using each fuel by the annual total population for the region. We’ll use Polars’ <code>.over()</code> method to calculate these totals for subgroups without collapsing the data.</p>
<p>&lt; PAUSE &gt;</p>
<div id="56bc5891" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    fuel_types</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"fuel_type"</span>, <span class="st">"year"</span>, <span class="st">"region"</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"pop_cooking_mln"</span>).<span class="bu">sum</span>())</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    .with_columns(prop_pop<span class="op">=</span>(pl.col(<span class="st">"pop_cooking_mln"</span>)<span class="op">/</span>pl.col(<span class="st">"pop_cooking_mln"</span>).<span class="bu">sum</span>())</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                            .over(<span class="st">"year"</span>, <span class="st">"region"</span>))</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1_188, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">fuel_type</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">pop_cooking_mln</th>
<th data-quarto-table-cell-role="th">prop_pop</th>
</tr>
<tr class="even">
<th>str</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Charcoal"</td>
<td>2011</td>
<td>"Americas"</td>
<td>8.2926</td>
<td>0.013999</td>
</tr>
<tr class="even">
<td>"Gas"</td>
<td>2013</td>
<td>"South-East Asia"</td>
<td>761.675</td>
<td>0.408313</td>
</tr>
<tr class="odd">
<td>"Charcoal"</td>
<td>2003</td>
<td>"Americas"</td>
<td>6.5788</td>
<td>0.012287</td>
</tr>
<tr class="even">
<td>"Gas"</td>
<td>2007</td>
<td>"South-East Asia"</td>
<td>473.82</td>
<td>0.273947</td>
</tr>
<tr class="odd">
<td>"Charcoal"</td>
<td>2013</td>
<td>"Europe"</td>
<td>0.071</td>
<td>0.000151</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Coal"</td>
<td>2017</td>
<td>"Eastern Mediterranean"</td>
<td>0.531</td>
<td>0.000821</td>
</tr>
<tr class="even">
<td>"Coal"</td>
<td>1990</td>
<td>"Africa"</td>
<td>4.024</td>
<td>0.008204</td>
</tr>
<tr class="odd">
<td>"Coal"</td>
<td>1998</td>
<td>"Europe"</td>
<td>7.233</td>
<td>0.016028</td>
</tr>
<tr class="even">
<td>"Kerosene"</td>
<td>2020</td>
<td>"Americas"</td>
<td>0.9021</td>
<td>0.001398</td>
</tr>
<tr class="odd">
<td>"Electricity"</td>
<td>2014</td>
<td>"Eastern Mediterranean"</td>
<td>5.455</td>
<td>0.008894</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>I wrap the expression into parenthesis and pass it to the <code>.over()</code> method which defines the scope for the <code>.sum()</code> operation. Note that this is different from aggregation, because the number of rows actually does not change. Lets visualize it!</p>
<p>&lt; PAUSE &gt;</p>
<div id="ddf39081" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    fuel_types</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"fuel_type"</span>, <span class="st">"year"</span>, <span class="st">"region"</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"pop_cooking_mln"</span>).<span class="bu">sum</span>())</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    .with_columns(prop_pop<span class="op">=</span>(pl.col(<span class="st">"pop_cooking_mln"</span>)<span class="op">/</span>pl.col(<span class="st">"pop_cooking_mln"</span>).<span class="bu">sum</span>())</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                            .over(<span class="st">"year"</span>, <span class="st">"region"</span>))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_area(aes(x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"prop_pop"</span>, fill<span class="op">=</span><span class="st">"fuel_type"</span>))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>facet_wrap(<span class="st">"region"</span>, ncol<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>scale_fill_cmap_d()</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>theme_linedraw()</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>labs(title<span class="op">=</span><span class="st">"Energy mix per world region"</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>        subtitle<span class="op">=</span><span class="st">"From biomass to natural gas"</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"Share of population"</span>, x<span class="op">=</span><span class="st">"Year"</span>, fill<span class="op">=</span><span class="st">"Fuel Type"</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-44-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>What a graph! What a story! In Africa, biomass remains dominant, though natural gas is beginning to make inroads. The Americas, Europe, and Eastern Mediterranean rely heavily on gas, with electricity emerging as a significant player in Europe and the Western Pacific. Southeast Asia, meanwhile, is undergoing a rapid transition from biomass to gas - a remarkable shift in just a few decades. This visualization gives us a profound understanding of how the popularity of cooking fuels has evolved globally and regionally over time.</p>
</section>
<section id="video-9-final-plot-greenscreen-3-min" class="level1">
<h1>VIDEO 9 Final plot {greenscreen} ~ 3 min</h1>
<p>It’s time for you to take on another challenge - one that highlights the global reliance on coal and charcoal for cooking. Those are environmentally sensitive fuels and understanding thier use across the world is crucial. Create a column chart showing the top 10 countries by the number of people using coal and charcoal for cooking in 2022. Color the columns by continent. How many of these top-10 countries are in Africa?</p>
<p>&lt; PAUSE &gt;</p>
<div class="callout callout-style-default callout-challenge callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a column chart showing the top 10 countries by the number of people using coal and charcoal for cooking in 2022. Color the columns by continent. How many of these top-10 countries are in Africa?</p>
</div>
</div>
<div id="8f16462a" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(fuel_types</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"fuel_type"</span>).<span class="bu">str</span>.ends_with(<span class="st">"oal"</span>),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"year"</span>)<span class="op">==</span><span class="dv">2022</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"pop_cooking_mln"</span>)<span class="op">&gt;</span><span class="dv">0</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"region"</span>, <span class="st">"country"</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"pop_cooking_mln"</span>).<span class="bu">sum</span>())</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"pop_cooking_mln"</span>, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">10</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(x<span class="op">=</span><span class="st">"reorder(country, pop_cooking_mln)"</span>, y<span class="op">=</span><span class="st">"pop_cooking_mln"</span>, fill<span class="op">=</span><span class="st">"region"</span>))</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>geom_col()</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>coord_flip()</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>theme_seaborn()</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>theme(legend_position<span class="op">=</span><span class="st">"bottom"</span>,</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        axis_title_y<span class="op">=</span>element_blank(),</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>        figure_size<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>))</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="wrangling_files/figure-html/cell-45-output-1.png" width="960" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Seven - possibly eight, if you include Somalia - of the top-10 countries using coal for cooking are in Africa! Many African nations rely heavily on these highly polluting and dangerous carbon-based fuels. Ensuring access to cleaner, safer energy sources is essential to improving health outcomes and accelerating the transition to sustainable energy.</p>
<p>In the next section, we’ll learn how to combine datasets through joins and reshape them using pivots - powerful tools for transforming and enriching our analyses. See you soon, as we dive deeper into the art and science of data manipulation!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Lund University</p>
</div>   
    <div class="nav-footer-center">
<p>Data Literacy with Python</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Follow us on  
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/lunduniversity">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/lunduniversity/">
      <i class="bi bi-instagram" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/school/lunduniversity/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/user/LundUniversity">
      <i class="bi bi-youtube" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/lunduniversity">
      <i class="bi bi-facebook" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>