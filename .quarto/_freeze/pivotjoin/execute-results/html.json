{
  "hash": "a5b7a0beab10e8e64ba120b81457678d",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Pivots and joins\"\nengine: python3\n---\n\n\n\n\n\n# VIDEO 1 BFFP data\n\nHello and welcome back to Data Literacy with Python!\n\nWe’re continuing our exciting journey into data wrangling — a cornerstone of analysis and storytelling. If you’ve been following along, congratulations! You’ve covered a lot of ground and gained some serious data skills.\n\nLet’s quickly recap:\n\n- We learned how to subset data, selecting specific columns using `.select()`, `.drop()`, and the powerful suite of `polars.selectors`. We used `.head()`, `.tail()` and `.filter()` to pick out key observations.\n- We mastered creating new columns with expressions inside `.with_columns().`\n- Finally, we explored summarizing data using `.group_by()` and `.agg()`, generating meaningful insights from our datasets.\n\nThese are all essential skills, and you’re doing great!\n\nBut now, it’s time to level up. Today, we’re tackling data reshaping and joins, two powerful techniques for reorganizing and enriching datasets. I also promised you some nice-looking tables, and I intend to deliver! We’ll be using the amazing `great_tables` library for our table designs. Let’s load up the libraries and dive right in.\n\n< PAUSE >\n\n::: {#ec8297dc .cell execution_count=1}\n``` {.python .cell-code}\nimport polars as pl\nimport polars.selectors as cs\nfrom plotnine import *\nfrom great_tables import GT\n```\n:::\n\n\nToday’s dataset comes from the *Break from Plastics* environmental campaign — a sample with a powerful story. Here's a quck overview:\n\n< PAUSE >\n\n::: {.callout-tip}\nIn 2020, thanks to our members and allies, Break Free From Plastic engaged 14,734 volunteers in 55 countries to conduct 575 brand audits. These volunteers collected 346,494 pieces of plastic waste, 63% of which was marked with a clear consumer brand. Despite the challenges of organizing during a global pandemic, our volunteers safely coordinated more brand audit events in more countries this year than in the previous two years. As a special activity during the pandemic, we also worked with over 300 waste pickers to highlight their roles as essential workers. Participants catalogued over 5,000 brands in this year’s global audit. Our analysis reveals the following as the 2020 Top 10 Global Polluters: The Coca-Cola Company; PepsiCo; Nestlé; Unilever; Mondelez International; Mars, Inc.; Procter & Gamble; Philip Morris International; Colgate-Palmolive; and Perfetti Van Melle. \n:::\n\nHave a look at the code that brings this data into our workspace:\n\n< PAUSE >\n\n::: {#99bbc916 .cell execution_count=2}\n``` {.python .cell-code}\nplastics_df = pl.read_csv('https://bit.ly/data24-bffplastics')\n\nplastics_docs = pl.DataFrame({\n    'Variable': ['region', 'country_code' , 'country', 'year', 'parent_company', 'empty', 'hdpe', 'ldpe', 'o', 'pet', 'pp', 'ps', 'pvc', 'grand_total', 'num_events', 'volunteers'],\n\n    'Class': ['character','character','character', 'double', 'character', 'double', 'double', 'double', 'double', 'double', 'double', 'double', 'double', 'double', 'double', 'double'],\n    \n    'Description': ['Region', 'Alpha 3 ISO 3166 code','Country of cleanup', 'Year (2019 or 2020)', 'Source of plastic (company name)', 'Category left empty count', 'High density polyethylene count (Plastic milk containers, plastic bags, bottle caps, trash cans, oil cans, plastic lumber, toolboxes, supplement containers)', 'Low density polyethylene count (Plastic bags, Ziploc bags, buckets, squeeze bottles, plastic tubes, chopping boards)', 'Category marked other count', 'Polyester plastic count (Polyester fibers, soft drink bottles, food containers (also see plastic bottles)', 'Polypropylene count (Flower pots, bumpers, car interior trim, industrial fibers, carry-out beverage cups, microwavable food containers, DVD keep cases)', 'Polystyrene count (Toys, video cassettes, ashtrays, trunks, beverage/food coolers, beer cups, wine and champagne cups, carry-out food containers, Styrofoam)', 'PVC plastic count (Window frames, bottles for chemicals, flooring, plumbing pipes)', 'Grand total count (all types of plastic)', 'Number of counting events', 'Number of volunteers']\n})\n```\n:::\n\n\nIn your notebook you can see the code for importing the data, as well as a DataFrame containing a data dictionary — a detailed description of the variables in this dataset.\n\nSo far, we’ve always imported data from CSV files or pre-built datasets. But now, it's time to talk about creating data frames by hand. This is super handy when working with small examples, prototypes, or mock data. To do that, we need to talk about two foundational Python data structures: dictionaries and lists.\n\nThink of a dictionary as a way to describe an object. It’s a collection of \"key-value\" pairs—like writing down standard characteristics of something along with their values. Dictionaries are specified with curly brackets `{}`. Let’s say I want to describe my bike: \n\n< PAUSE >\n\n::: {#d106be5a .cell execution_count=3}\n``` {.python .cell-code}\nBicycle = {\n    'Type': 'Hybrid',\n    'Size': 28,\n    'Make': 'Merida',\n    'Color': 'Grey',\n    'Price': 250\n}\n```\n:::\n\n\nHere, each characteristic—like Type or Size—has one value. Easy, right? But what if I also wanted to describe the bikes of my twins? I’d need three records, not one. \n\nThis is where lists come in. A list is a collection of items—typically of the same type—and it’s denoted with square brackets `[]`. Let’s use lists to describe all the bikes in my garage:\n\n< PAUSE >\n\n::: {#84f7fac9 .cell execution_count=4}\n``` {.python .cell-code}\nBikes = {\n    'Type': ['Hybrid', 'MTX', 'BMX'],\n    'Size': [28, 24, 26], \n    'Make': ['Merida', 'Giant', 'Specialized'],\n    'Color': ['Grey', 'White', 'Orange'],\n    'Price': [250, 180, 220]\n}\n```\n:::\n\n\nNow, we have a dictionary of lists, representing three bikes. To turn this into a Polars DataFrame, all we need to do is pass it to the `pl.DataFrame()` function:\n\n< PAUSE >\n\n::: {#48132782 .cell execution_count=5}\n``` {.python .cell-code}\nbikes_df = pl.DataFrame(Bikes)\n```\n:::\n\n\nAnd just like that, we’ve created a data frame by hand! This is a simple yet powerful way to structure and manipulate small datasets.\n\nOur `plastics_docs` specifies three characteristics: the variable names (`Variable`), their data types (`Class`), and their descriptions (`Description`).\n\nThis table essentially acts as documentation for the `plastics_df`. But let’s face it — raw data frames, while functional, don’t always look polished or presentation-ready. That’s where the Great Tables package comes in.\n\nGreat Tables is like a graphic design toolkit for your tables! It introduces a \"grammar of tables,\" similar to how `plotnine` provides a \"grammar of graphics.\" This makes it super easy to transform plain data frames into beautifully styled tables with minimal effort.\n\nThe core function in Great Tables is `GT()`, and it works similarly to how we use `ggplot` for creating plots. Let’s take a sneak peek at its capabilities by styling our `plastics_docs` data frame. Here’s how we do it:\n\n< PAUSE >\n\n::: {#9c643ddf .cell execution_count=6}\n``` {.python .cell-code}\n(\nGT(plastics_docs)\n    .opt_stylize(style=3, color='cyan')\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div id=\"adedlqyhnr\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#adedlqyhnr table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#adedlqyhnr thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#adedlqyhnr p { margin: 0; padding: 0; }\n #adedlqyhnr .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #929292; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #adedlqyhnr .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #adedlqyhnr .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #adedlqyhnr .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #adedlqyhnr .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #adedlqyhnr .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; }\n #adedlqyhnr .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #929292; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #adedlqyhnr .gt_col_heading { color: #FFFFFF; background-color: #016763; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #adedlqyhnr .gt_column_spanner_outer { color: #FFFFFF; background-color: #016763; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #adedlqyhnr .gt_column_spanner_outer:first-child { padding-left: 0; }\n #adedlqyhnr .gt_column_spanner_outer:last-child { padding-right: 0; }\n #adedlqyhnr .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #adedlqyhnr .gt_spanner_row { border-bottom-style: hidden; }\n #adedlqyhnr .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #929292; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #adedlqyhnr .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #929292; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; vertical-align: middle; }\n #adedlqyhnr .gt_from_md> :first-child { margin-top: 0; }\n #adedlqyhnr .gt_from_md> :last-child { margin-bottom: 0; }\n #adedlqyhnr .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: dashed; border-top-width: 1px; border-top-color: #929292; border-left-style: none; border-left-width: 1px; border-left-color: #929292; border-right-style: none; border-right-width: 1px; border-right-color: #929292; vertical-align: middle; overflow-x: hidden; }\n #adedlqyhnr .gt_stub { color: #333333; background-color: #D5D5D5; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: none; border-right-width: 2px; border-right-color: #FFFFFF; padding-left: 5px; padding-right: 5px; }\n #adedlqyhnr .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #adedlqyhnr .gt_row_group_first td { border-top-width: 2px; }\n #adedlqyhnr .gt_row_group_first th { border-top-width: 2px; }\n #adedlqyhnr .gt_striped { background-color: #F4F4F4; }\n #adedlqyhnr .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #929292; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; }\n #adedlqyhnr .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #adedlqyhnr .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #adedlqyhnr .gt_left { text-align: left; }\n #adedlqyhnr .gt_center { text-align: center; }\n #adedlqyhnr .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #adedlqyhnr .gt_font_normal { font-weight: normal; }\n #adedlqyhnr .gt_font_bold { font-weight: bold; }\n #adedlqyhnr .gt_font_italic { font-style: italic; }\n #adedlqyhnr .gt_super { font-size: 65%; }\n #adedlqyhnr .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #adedlqyhnr .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Variable\">Variable</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Class\">Class</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Description\">Description</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_left\">region</td>\n    <td class=\"gt_row gt_left\">character</td>\n    <td class=\"gt_row gt_left\">Region</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">country_code</td>\n    <td class=\"gt_row gt_left gt_striped\">character</td>\n    <td class=\"gt_row gt_left gt_striped\">Alpha 3 ISO 3166 code</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">country</td>\n    <td class=\"gt_row gt_left\">character</td>\n    <td class=\"gt_row gt_left\">Country of cleanup</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">year</td>\n    <td class=\"gt_row gt_left gt_striped\">double</td>\n    <td class=\"gt_row gt_left gt_striped\">Year (2019 or 2020)</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">parent_company</td>\n    <td class=\"gt_row gt_left\">character</td>\n    <td class=\"gt_row gt_left\">Source of plastic (company name)</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">empty</td>\n    <td class=\"gt_row gt_left gt_striped\">double</td>\n    <td class=\"gt_row gt_left gt_striped\">Category left empty count</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">hdpe</td>\n    <td class=\"gt_row gt_left\">double</td>\n    <td class=\"gt_row gt_left\">High density polyethylene count (Plastic milk containers, plastic bags, bottle caps, trash cans, oil cans, plastic lumber, toolboxes, supplement containers)</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">ldpe</td>\n    <td class=\"gt_row gt_left gt_striped\">double</td>\n    <td class=\"gt_row gt_left gt_striped\">Low density polyethylene count (Plastic bags, Ziploc bags, buckets, squeeze bottles, plastic tubes, chopping boards)</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">o</td>\n    <td class=\"gt_row gt_left\">double</td>\n    <td class=\"gt_row gt_left\">Category marked other count</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">pet</td>\n    <td class=\"gt_row gt_left gt_striped\">double</td>\n    <td class=\"gt_row gt_left gt_striped\">Polyester plastic count (Polyester fibers, soft drink bottles, food containers (also see plastic bottles)</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">pp</td>\n    <td class=\"gt_row gt_left\">double</td>\n    <td class=\"gt_row gt_left\">Polypropylene count (Flower pots, bumpers, car interior trim, industrial fibers, carry-out beverage cups, microwavable food containers, DVD keep cases)</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">ps</td>\n    <td class=\"gt_row gt_left gt_striped\">double</td>\n    <td class=\"gt_row gt_left gt_striped\">Polystyrene count (Toys, video cassettes, ashtrays, trunks, beverage/food coolers, beer cups, wine and champagne cups, carry-out food containers, Styrofoam)</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">pvc</td>\n    <td class=\"gt_row gt_left\">double</td>\n    <td class=\"gt_row gt_left\">PVC plastic count (Window frames, bottles for chemicals, flooring, plumbing pipes)</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">grand_total</td>\n    <td class=\"gt_row gt_left gt_striped\">double</td>\n    <td class=\"gt_row gt_left gt_striped\">Grand total count (all types of plastic)</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">num_events</td>\n    <td class=\"gt_row gt_left\">double</td>\n    <td class=\"gt_row gt_left\">Number of counting events</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">volunteers</td>\n    <td class=\"gt_row gt_left gt_striped\">double</td>\n    <td class=\"gt_row gt_left gt_striped\">Number of volunteers</td>\n  </tr>\n</tbody>\n\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\nVoilà! `.opt_stylize()` method has some pre-built styles, which we used to convert a boring data frame into a polished and professional-looking table, ready to be shared or included in reports. Don’t worry about memorizing the details just yet — we’ll explore `GT()` more thoroughly in the upcoming sections.\n\nBefore we move on, let’s take a quick look at the data itself. Here’s a snippet of the first five rows of the `plastics_df`:\n\n< PAUSE >\n\n::: {#76c43f56 .cell execution_count=7}\n``` {.python .cell-code}\n(\nplastics_df\n    .head(5)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (5, 16)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>region</th><th>country_code</th><th>country</th><th>year</th><th>parent_company</th><th>empty</th><th>hdpe</th><th>ldpe</th><th>o</th><th>pet</th><th>pp</th><th>ps</th><th>pvc</th><th>grand_total</th><th>num_events</th><th>volunteers</th></tr><tr><td>str</td><td>str</td><td>str</td><td>i64</td><td>str</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td></tr></thead><tbody><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2019</td><td>&quot;Grand Total&quot;</td><td>0</td><td>215</td><td>55</td><td>607</td><td>1376</td><td>281</td><td>116</td><td>18</td><td>2668</td><td>4</td><td>243</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2019</td><td>&quot;Unbranded&quot;</td><td>0</td><td>155</td><td>50</td><td>532</td><td>848</td><td>122</td><td>114</td><td>17</td><td>1838</td><td>4</td><td>243</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2019</td><td>&quot;The Coca-Cola Company&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>222</td><td>35</td><td>0</td><td>0</td><td>257</td><td>4</td><td>243</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2019</td><td>&quot;Secco&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>39</td><td>4</td><td>0</td><td>0</td><td>43</td><td>4</td><td>243</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2019</td><td>&quot;Doble Cola&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>38</td><td>0</td><td>0</td><td>0</td><td>38</td><td>4</td><td>243</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nAs you can see, the first few variables look familiar. They describe general metadata, like the region, country, and year. But let’s focus on the variables starting from `empty` and going down to `pvc`. These columns count the number of plastic pieces of different types collected during the cleanup. \n\nThe `grand_total` column sums up all these individual plastic counts. Finally, the last two columns—`num_events` and `volunteers`—capture operational details:\n\n- How many trash counting events took place in each country during a given year?\n- How many volunteers participated in these campaigns?\n\nThis dataset offers a wealth of insights into plastic pollution patterns across the globe. By organizing, reshaping, and visualizing this data, we’ll uncover powerful stories about the environmental challenges we face—and the steps we can take to address them.\n\nLet’s take a closer look at the data. Check out this very first row for Argentina. Notice the `parent_company` column contains the value: \"Grand Total.\" This suggests that this first row contains the totals for all Argentinian records in 2019.\n\nLet's look at the next year:\n\n< PAUSE >\n\n::: {#7c99bfdb .cell execution_count=8}\n``` {.python .cell-code}\n(plastics_df\n    .filter(pl.col(\"year\")==2020,\n        pl.col(\"country\")==\"Argentina\")\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (226, 16)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>region</th><th>country_code</th><th>country</th><th>year</th><th>parent_company</th><th>empty</th><th>hdpe</th><th>ldpe</th><th>o</th><th>pet</th><th>pp</th><th>ps</th><th>pvc</th><th>grand_total</th><th>num_events</th><th>volunteers</th></tr><tr><td>str</td><td>str</td><td>str</td><td>i64</td><td>str</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td></tr></thead><tbody><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>null</td><td>0</td><td>12</td><td>9</td><td>70</td><td>9</td><td>7</td><td>2</td><td>0</td><td>109</td><td>24</td><td>9</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>&quot;Aceitera Martinez S.A&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>24</td><td>9</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>&quot;AGD&quot;</td><td>0</td><td>0</td><td>0</td><td>3</td><td>1</td><td>0</td><td>0</td><td>0</td><td>4</td><td>24</td><td>9</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>&quot;Alfredo Willliner S.A&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>2</td><td>0</td><td>2</td><td>24</td><td>9</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>&quot;Alicorp Argentina&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>24</td><td>9</td></tr><tr><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>&quot;Vidagro S.A.&quot;</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>24</td><td>9</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>&quot;Williner&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>2</td><td>0</td><td>2</td><td>24</td><td>9</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>&quot;Wrigley Company&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>24</td><td>9</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>&quot;Yin Yang&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>24</td><td>9</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>&quot;Zaplast&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>24</td><td>9</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nHere’s something curious: for the year 2020, the rows with country totals aren’t marked with \"Grand Total.\" Instead, the `parent_company` field is left blank, or in technical terms, it’s marked as missing - `Null`. Hmm! What do we do with those?\n\n`Null` values aren’t just limited to `parent_company`. Let’s take a look at records collected in 2019 from unidentified locations.\n\n< PAUSE >\n\n::: {#0196bf58 .cell execution_count=9}\n``` {.python .cell-code}\n(plastics_df\n    .filter(pl.col(\"country\").is_null())\n    )\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (1_346, 16)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>region</th><th>country_code</th><th>country</th><th>year</th><th>parent_company</th><th>empty</th><th>hdpe</th><th>ldpe</th><th>o</th><th>pet</th><th>pp</th><th>ps</th><th>pvc</th><th>grand_total</th><th>num_events</th><th>volunteers</th></tr><tr><td>str</td><td>str</td><td>str</td><td>i64</td><td>str</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td></tr></thead><tbody><tr><td>null</td><td>null</td><td>null</td><td>2019</td><td>&quot;Grand Total&quot;</td><td>null</td><td>1535</td><td>6443</td><td>30181</td><td>11087</td><td>5420</td><td>2101</td><td>188</td><td>56955</td><td>145</td><td>1416</td></tr><tr><td>null</td><td>null</td><td>null</td><td>2019</td><td>&quot;Unbranded&quot;</td><td>null</td><td>631</td><td>3176</td><td>17432</td><td>4265</td><td>2417</td><td>1545</td><td>20</td><td>29486</td><td>145</td><td>1416</td></tr><tr><td>null</td><td>null</td><td>null</td><td>2019</td><td>&quot;The Coca-Cola Company&quot;</td><td>null</td><td>130</td><td>4</td><td>157</td><td>1154</td><td>210</td><td>1</td><td>51</td><td>1707</td><td>145</td><td>1416</td></tr><tr><td>null</td><td>null</td><td>null</td><td>2019</td><td>&quot;Philip Morris&quot;</td><td>null</td><td>13</td><td>37</td><td>1579</td><td>1</td><td>0</td><td>4</td><td>0</td><td>1634</td><td>145</td><td>1416</td></tr><tr><td>null</td><td>null</td><td>null</td><td>2019</td><td>&quot;Sahakari Jal&quot;</td><td>null</td><td>0</td><td>0</td><td>0</td><td>563</td><td>975</td><td>0</td><td>0</td><td>1538</td><td>145</td><td>1416</td></tr><tr><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td></tr><tr><td>null</td><td>null</td><td>null</td><td>2019</td><td>&quot;Schulte&quot;</td><td>null</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>145</td><td>1416</td></tr><tr><td>null</td><td>null</td><td>null</td><td>2019</td><td>&quot;Schwartau&quot;</td><td>null</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>145</td><td>1416</td></tr><tr><td>null</td><td>null</td><td>null</td><td>2019</td><td>&quot;SchÃ¶fferhofer&quot;</td><td>null</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>145</td><td>1416</td></tr><tr><td>null</td><td>null</td><td>null</td><td>2019</td><td>&quot;Scotts Black Mulch&quot;</td><td>null</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>145</td><td>1416</td></tr><tr><td>null</td><td>null</td><td>null</td><td>2019</td><td>&quot;Cherry Valley marketplace&quot;</td><td>null</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>145</td><td>1416</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nBefore we dive deeper into analyzing top contributors to plastic waste, let’s calculate the totals per country and year ourselves. Why? \n\nWell, the dataset has pre-computed totals marked with \"Grand Total\" or `Null` in the `parent_company`, but the logic seems inconsistent. Recomputing the totals ensures transparency and accuracy in our analysis.\n\nHere’s how we start:\n\n< PAUSE >\n\n::: {#d0fe3f12 .cell execution_count=10}\n``` {.python .cell-code}\n(plastics_df\n    .drop(\"grand_total\")\n    .filter(pl.col(\"parent_company\")!=\"Grand Total\",\n            pl.col(\"parent_company\").is_not_null())\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (13_278, 15)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>region</th><th>country_code</th><th>country</th><th>year</th><th>parent_company</th><th>empty</th><th>hdpe</th><th>ldpe</th><th>o</th><th>pet</th><th>pp</th><th>ps</th><th>pvc</th><th>num_events</th><th>volunteers</th></tr><tr><td>str</td><td>str</td><td>str</td><td>i64</td><td>str</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td></tr></thead><tbody><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2019</td><td>&quot;Unbranded&quot;</td><td>0</td><td>155</td><td>50</td><td>532</td><td>848</td><td>122</td><td>114</td><td>17</td><td>4</td><td>243</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2019</td><td>&quot;The Coca-Cola Company&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>222</td><td>35</td><td>0</td><td>0</td><td>4</td><td>243</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2019</td><td>&quot;Secco&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>39</td><td>4</td><td>0</td><td>0</td><td>4</td><td>243</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2019</td><td>&quot;Doble Cola&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>38</td><td>0</td><td>0</td><td>0</td><td>4</td><td>243</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2019</td><td>&quot;Pritty&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>22</td><td>7</td><td>0</td><td>0</td><td>4</td><td>243</td></tr><tr><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;VNM&quot;</td><td>&quot;Viet Nam&quot;</td><td>2020</td><td>&quot;Vinamilk&quot;</td><td>0</td><td>0</td><td>0</td><td>91</td><td>1</td><td>0</td><td>0</td><td>0</td><td>6</td><td>27</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;VNM&quot;</td><td>&quot;Viet Nam&quot;</td><td>2020</td><td>&quot;VINH HAO CO.&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>4</td><td>0</td><td>0</td><td>0</td><td>6</td><td>27</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;VNM&quot;</td><td>&quot;Viet Nam&quot;</td><td>2020</td><td>&quot;Vital&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>4</td><td>0</td><td>0</td><td>0</td><td>6</td><td>27</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;VNM&quot;</td><td>&quot;Viet Nam&quot;</td><td>2020</td><td>&quot;VM Group&quot;</td><td>0</td><td>2</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>6</td><td>27</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;VNM&quot;</td><td>&quot;Viet Nam&quot;</td><td>2020</td><td>&quot;Yakult&quot;</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>2</td><td>0</td><td>0</td><td>6</td><td>27</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nLet’s break this down:\n\n- `drop(\"grand_total\")`: The `grand_total` column is a pre-computed sum of all plastic types, which we can recalculate if needed.\n- Exclude \"Grand Total\" rows: We filter out rows where the `parent_company` column is populated with the phrase \"Grand Total.\"\n- Exclude `Null` values in `parent_company` column: These rows lack a meaningful company label and often represent aggregated data.\n\nBy cleaning the data in this way, we ensure that our analysis is based on individual contributions, not pre-summarized totals.\n\n# VIDEO 2 Aggregation\n\nNow, let’s talk about the two special columns in our dataset: `num_events` and `volunteers`. These capture the number of counting events and the number of volunteers who participated in the cleanup campaigns.\n\nBut here’s the catch. These columns don’t vary within groups of rows for the same year and country. Instead, they represent aggregate metrics that make sense at the country-year level, but are less meaningful at the company level.\n\nFor now, let’s set aside the rankings of companies responsible for the most plastic waste. Instead, we'll focus on the campaign itself — the Break from Plastics community engagement on a country level.\n\nIt’s time to roll up our sleeves and aggregate the data at the country-year level. First, let’s think about the groups we’re interested in. Our primary group identifiers would be `region`, `country_code `, `country`, and `year`. These columns define the unique groups for aggregation since each country belongs to one region and has a unique country code.\n\nNow, let’s decide what to aggregate. We are interested in aggregating the eight columns from `empty` to `pvc`. These need to be summed for each group. However, columns like `num_events` and `volunteers` shouldn’t be summed because their values remain constant within each group. Instead, we’ll take the first non-null value in each group.\n\nWith the powerful multi-column expressions in polars, we don’t need to write repetitive code for each plastic type. Using selectors, we can quickly choose and process groups of columns. I encourage you to try it out now.\n\n:::{.challenge}\nAggregate the plastic counts at the country-year level, ensuring that the `num_events` and `volunteers` columns remain intact. When you’re done, store the result into a new variable called `plastics_countries_df`.\n:::\n\nTake a moment to pause the video and give it a try.\n\n< PAUSE >\n\n::: {#caa367aa .cell execution_count=11}\n``` {.python .cell-code}\nplastics_countries_df = (plastics_df\n    .drop(\"grand_total\")\n    .filter((pl.col(\"parent_company\")!=\"Grand Total\"),\n            (pl.col(\"parent_company\").is_not_null()))\n    .group_by(\"region\", \"country_code\", \"country\", \"year\")\n    .agg(\n        cs.numeric().exclude(\"num_events\", \"volunteers\").sum(),\n        cs.by_index(-2, -1).drop_nulls().first())\n    )\n```\n:::\n\n\nFantastic! Now that we have our cleaned and aggregated dataset, let’s talk about total plastic counts.\n\nTo calculate the total number of plastic items inspected, you’d typically list all relevant columns and sum them up: `total_count=pl.col(\"empty\")+pl.col(\"hdpe\")+pl.col(\"ldpe\")+` and so on. But imagine if you had hundreds of columns instead of eight! This approach would quickly become overwhelming.\n\nLuckily, there’s a clever trick to make this task more manageable: pivoting. By reorganizing the data into a different format, we can simplify calculations and enable more flexible analysis.\n\nIn the next section, we’ll dive into pivoting and explore how to reshape `plastics_countries_df` for deeper insights.\n\nLet’s keep going!\n\n# VIDEO 4 Wide and long data\n\nLet’s take a moment to reflect on two common ways of organizing the same data: wide and long formats.\n\nOn the left, we see a wide format dataframe. Here, each row represents a single observation, and the variables are spread across multiple columns.\n\nOn the right, we have the same data in a long format. In this version:\n\n- The first two columns, known as ID or index variables, are repeated for each observation.\n- A new column, `plastic_type`, gathers the names of the measured variables.\n- The final column, `quantity`, contains the values corresponding to those variables.\n\n\n< PAUSE >\n\n:::::{.columns .column-screen-inset}\n:::{.column width=\"60%\"}\n\n#### \"Wide\" data\n\n::: {#dddc602f .cell execution_count=12}\n\n::: {.cell-output .cell-output-display execution_count=12}\n```{=html}\n<div id=\"uxneixxlzw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#uxneixxlzw table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#uxneixxlzw thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#uxneixxlzw p { margin: 0; padding: 0; }\n #uxneixxlzw .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 3px; border-top-color: #D5D5D5; border-right-style: solid; border-right-width: 3px; border-right-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 3px; border-bottom-color: #D5D5D5; border-left-style: solid; border-left-width: 3px; border-left-color: #D5D5D5; }\n #uxneixxlzw .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #uxneixxlzw .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #uxneixxlzw .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #uxneixxlzw .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #uxneixxlzw .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }\n #uxneixxlzw .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #uxneixxlzw .gt_col_heading { color: #FFFFFF; background-color: #004D80; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #uxneixxlzw .gt_column_spanner_outer { color: #FFFFFF; background-color: #004D80; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #uxneixxlzw .gt_column_spanner_outer:first-child { padding-left: 0; }\n #uxneixxlzw .gt_column_spanner_outer:last-child { padding-right: 0; }\n #uxneixxlzw .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #uxneixxlzw .gt_spanner_row { border-bottom-style: hidden; }\n #uxneixxlzw .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #uxneixxlzw .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: middle; }\n #uxneixxlzw .gt_from_md> :first-child { margin-top: 0; }\n #uxneixxlzw .gt_from_md> :last-child { margin-bottom: 0; }\n #uxneixxlzw .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #89D3FE; border-left-style: solid; border-left-width: 1px; border-left-color: #89D3FE; border-right-style: solid; border-right-width: 1px; border-right-color: #89D3FE; vertical-align: middle; overflow-x: hidden; }\n #uxneixxlzw .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #5F5F5F; padding-left: 5px; padding-right: 5px; }\n #uxneixxlzw .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #uxneixxlzw .gt_row_group_first td { border-top-width: 2px; }\n #uxneixxlzw .gt_row_group_first th { border-top-width: 2px; }\n #uxneixxlzw .gt_striped { background-color: #F4F4F4; }\n #uxneixxlzw .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }\n #uxneixxlzw .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #uxneixxlzw .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #uxneixxlzw .gt_left { text-align: left; }\n #uxneixxlzw .gt_center { text-align: center; }\n #uxneixxlzw .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #uxneixxlzw .gt_font_normal { font-weight: normal; }\n #uxneixxlzw .gt_font_bold { font-weight: bold; }\n #uxneixxlzw .gt_font_italic { font-style: italic; }\n #uxneixxlzw .gt_super { font-size: 65%; }\n #uxneixxlzw .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #uxneixxlzw .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"country\">country</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"year\">year</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"empty\">empty</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"hdpe\">hdpe</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ldpe\">ldpe</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"o\">o</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pet\">pet</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pp\">pp</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ps\">ps</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pvc\">pvc</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_left\">Brazil</td>\n    <td class=\"gt_row gt_right\">2020</td>\n    <td class=\"gt_row gt_right\">0</td>\n    <td class=\"gt_row gt_right\">45</td>\n    <td class=\"gt_row gt_right\">78</td>\n    <td class=\"gt_row gt_right\">78</td>\n    <td class=\"gt_row gt_right\">135</td>\n    <td class=\"gt_row gt_right\">137</td>\n    <td class=\"gt_row gt_right\">92</td>\n    <td class=\"gt_row gt_right\">18</td>\n  </tr>\n</tbody>\n\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\n:::\n:::{.column width=\"40%\"}\n\n#### \"Long\" data\n\n::: {#353d247d .cell execution_count=13}\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<div id=\"kwtezrdwgy\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#kwtezrdwgy table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#kwtezrdwgy thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#kwtezrdwgy p { margin: 0; padding: 0; }\n #kwtezrdwgy .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 3px; border-top-color: #D5D5D5; border-right-style: solid; border-right-width: 3px; border-right-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 3px; border-bottom-color: #D5D5D5; border-left-style: solid; border-left-width: 3px; border-left-color: #D5D5D5; }\n #kwtezrdwgy .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #kwtezrdwgy .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #kwtezrdwgy .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #kwtezrdwgy .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #kwtezrdwgy .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }\n #kwtezrdwgy .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #kwtezrdwgy .gt_col_heading { color: #FFFFFF; background-color: #004D80; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #kwtezrdwgy .gt_column_spanner_outer { color: #FFFFFF; background-color: #004D80; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #kwtezrdwgy .gt_column_spanner_outer:first-child { padding-left: 0; }\n #kwtezrdwgy .gt_column_spanner_outer:last-child { padding-right: 0; }\n #kwtezrdwgy .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #kwtezrdwgy .gt_spanner_row { border-bottom-style: hidden; }\n #kwtezrdwgy .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #kwtezrdwgy .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: middle; }\n #kwtezrdwgy .gt_from_md> :first-child { margin-top: 0; }\n #kwtezrdwgy .gt_from_md> :last-child { margin-bottom: 0; }\n #kwtezrdwgy .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #89D3FE; border-left-style: solid; border-left-width: 1px; border-left-color: #89D3FE; border-right-style: solid; border-right-width: 1px; border-right-color: #89D3FE; vertical-align: middle; overflow-x: hidden; }\n #kwtezrdwgy .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #5F5F5F; padding-left: 5px; padding-right: 5px; }\n #kwtezrdwgy .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #kwtezrdwgy .gt_row_group_first td { border-top-width: 2px; }\n #kwtezrdwgy .gt_row_group_first th { border-top-width: 2px; }\n #kwtezrdwgy .gt_striped { background-color: #F4F4F4; }\n #kwtezrdwgy .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }\n #kwtezrdwgy .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #kwtezrdwgy .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #kwtezrdwgy .gt_left { text-align: left; }\n #kwtezrdwgy .gt_center { text-align: center; }\n #kwtezrdwgy .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #kwtezrdwgy .gt_font_normal { font-weight: normal; }\n #kwtezrdwgy .gt_font_bold { font-weight: bold; }\n #kwtezrdwgy .gt_font_italic { font-style: italic; }\n #kwtezrdwgy .gt_super { font-size: 65%; }\n #kwtezrdwgy .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #kwtezrdwgy .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"country\">country</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"year\">year</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"plastic_type\">plastic_type</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"quantity\">quantity</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_left\">Brazil</td>\n    <td class=\"gt_row gt_right\">2020</td>\n    <td class=\"gt_row gt_left\">empty</td>\n    <td class=\"gt_row gt_right\">0</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">Brazil</td>\n    <td class=\"gt_row gt_right gt_striped\">2020</td>\n    <td class=\"gt_row gt_left gt_striped\">hdpe</td>\n    <td class=\"gt_row gt_right gt_striped\">45</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">Brazil</td>\n    <td class=\"gt_row gt_right\">2020</td>\n    <td class=\"gt_row gt_left\">ldpe</td>\n    <td class=\"gt_row gt_right\">78</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">Brazil</td>\n    <td class=\"gt_row gt_right gt_striped\">2020</td>\n    <td class=\"gt_row gt_left gt_striped\">o</td>\n    <td class=\"gt_row gt_right gt_striped\">78</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">Brazil</td>\n    <td class=\"gt_row gt_right\">2020</td>\n    <td class=\"gt_row gt_left\">pet</td>\n    <td class=\"gt_row gt_right\">135</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">Brazil</td>\n    <td class=\"gt_row gt_right gt_striped\">2020</td>\n    <td class=\"gt_row gt_left gt_striped\">pp</td>\n    <td class=\"gt_row gt_right gt_striped\">137</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">Brazil</td>\n    <td class=\"gt_row gt_right\">2020</td>\n    <td class=\"gt_row gt_left\">ps</td>\n    <td class=\"gt_row gt_right\">92</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\">Brazil</td>\n    <td class=\"gt_row gt_right gt_striped\">2020</td>\n    <td class=\"gt_row gt_left gt_striped\">pvc</td>\n    <td class=\"gt_row gt_right gt_striped\">18</td>\n  </tr>\n</tbody>\n\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\n:::\n:::::\n\nThese two formats represent the exact same data, but the way they’re structured can have a big impact on how we work with them.\n\n:::{.callout-tip}\n- Wide Format:\n    - Easier for humans to read, especially in spreadsheets.\n    - Good for summarizing data at a glance.\n\n- Long Format:\n    - Preferred for computations, visualizations, and many data analysis tools.\n    - Simplifies aggregations and calculations.\n:::\n\nWhen working with data, being able to switch between these formats is essential. Many analysis tasks, like creating summaries or visualizations, become much easier when the data is in long format.\n\nThe process of transforming data from wide to long is called unpivoting or melting. This makes sense because the data seems to “melt” down into fewer columns while increasing the number of rows.\n\nWhen we unpivot data, we typically end up with three columns:\n\n- ID (or Index): These are the identifying variables that stay constant across the observations.\n- Key (or Variable Name): This gathers the names of the measured variables into a single column.\n- Value: This records the corresponding values for each of the variables.\n\nIn our case the *ID* variables are `region`, `country_code`, `country`, and `year`. We will name the *key* column `plastic_type`. The column containing *values* will be called `quantity`.\n\nOur first task is to unpivot the plastic count columns, transforming `plastics_countries_df` into a long format. This will simplify how we analyze and summarize the data.\n\nAs we’ve seen, the long-format data typically consists of three primary columns:\n\n- ID columns that uniquely identify each group or observation.\n- Key column that gathers variable names.\n- Value column that stores the corresponding values for each variable.\n\nLet’s begin by checking out the documentation for the `.unpivot()` method. This function gives us precise control over how to reshape the data.\n\n< SMALL PAUSE >\n\n![](img/unpivot_docs.png)\n\n`.unpivot()` takes four arguments:\n\n- `on`: Specifies the columns to be unpivoted.\n- `index`: Indicates which columns to keep as ID columns. You can use `polars.selectors` to specify these.\n- `variable_name`: Sets the name for the Key column.\n- `value_name`: Sets the name for the Value column.\n\nNote that the `on` argument is optional. If you don’t specify it, any column not listed as an `index` will be unpivoted automatically.\n\nHere’s how we can transform the dataset into a long format. We can select the index columns either by name or by position. We can also, optionally, specify the `on` argument to make it extra clear which columns should be melted.\n\n< PAUSE >\n\n::: {#7f6f8729 .cell execution_count=14}\n``` {.python .cell-code}\n(plastics_countries_df\n    .unpivot(index=cs.by_name(\"region\", \"country_code\", \"country\", \"year\", \"num_events\", \"volunteers\"), \n            variable_name=\"plastic_type\", value_name=\"quantity\")\n    )\n\n# which is the same as\n(plastics_countries_df\n    .unpivot(index=cs.by_index(0, 1, 2, 3, -2, -1), \n            on=cs.by_index(range(4,12)),\n            variable_name=\"plastic_type\", value_name=\"quantity\")\n    )\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (848, 8)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>region</th><th>country_code</th><th>country</th><th>year</th><th>num_events</th><th>volunteers</th><th>plastic_type</th><th>quantity</th></tr><tr><td>str</td><td>str</td><td>str</td><td>i64</td><td>i64</td><td>i64</td><td>str</td><td>i64</td></tr></thead><tbody><tr><td>&quot;Europe&quot;</td><td>&quot;NLD&quot;</td><td>&quot;Netherlands (Kingdom of the)&quot;</td><td>2020</td><td>1</td><td>5</td><td>&quot;empty&quot;</td><td>0</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;CHE&quot;</td><td>&quot;Switzerland&quot;</td><td>2019</td><td>6</td><td>327</td><td>&quot;empty&quot;</td><td>0</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;BRA&quot;</td><td>&quot;Brazil&quot;</td><td>2020</td><td>4</td><td>78</td><td>&quot;empty&quot;</td><td>0</td></tr><tr><td>&quot;South-East Asia&quot;</td><td>&quot;BGD&quot;</td><td>&quot;Bangladesh&quot;</td><td>2020</td><td>1</td><td>127</td><td>&quot;empty&quot;</td><td>0</td></tr><tr><td>&quot;South-East Asia&quot;</td><td>&quot;IDN&quot;</td><td>&quot;Indonesia&quot;</td><td>2020</td><td>50</td><td>392</td><td>&quot;empty&quot;</td><td>4</td></tr><tr><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;FRA&quot;</td><td>&quot;France&quot;</td><td>2019</td><td>1</td><td>13</td><td>&quot;pvc&quot;</td><td>0</td></tr><tr><td>&quot;South-East Asia&quot;</td><td>&quot;IND&quot;</td><td>&quot;India&quot;</td><td>2019</td><td>4</td><td>88</td><td>&quot;pvc&quot;</td><td>4</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;VNM&quot;</td><td>&quot;Viet Nam&quot;</td><td>2019</td><td>4</td><td>400</td><td>&quot;pvc&quot;</td><td>43</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ARG&quot;</td><td>&quot;Argentina&quot;</td><td>2020</td><td>24</td><td>9</td><td>&quot;pvc&quot;</td><td>4</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;MNE&quot;</td><td>&quot;Montenegro&quot;</td><td>2020</td><td>1</td><td>416</td><td>&quot;pvc&quot;</td><td>5</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nBoth approaches produce the same result:\n\n- The columns `region`, `country_code`, `country`, `year`, `num_events`, and `volunteers` are preserved as ID columns.\n- The plastic types (e.g., empty, hdpe, etc.) become the values in the `plastic_type` column.\n- The corresponding counts are stored in the `quantity` column.\n\nOnce the data is in long format, it becomes much easier to perform calculations. For instance, let’s group the data by `region`, `country_code`, `country`, `year`, `num_events`, and `volunteers`, and calculate the total quantity of plastic collected:\n\n< PAUSE >\n\n::: {#c3c4d9a3 .cell execution_count=15}\n``` {.python .cell-code}\n(plastics_countries_df\n    .unpivot(index=cs.by_name(\"region\", \"country_code\", \"country\", \"year\", \"num_events\", \"volunteers\"), \n            variable_name=\"plastic_type\", value_name=\"quantity\")\n    .group_by(\"region\", \"country_code\", \"country\", \"year\", \"num_events\", \"volunteers\")\n    .agg(pl.col(\"quantity\").sum())\n    )\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (106, 7)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>region</th><th>country_code</th><th>country</th><th>year</th><th>num_events</th><th>volunteers</th><th>quantity</th></tr><tr><td>str</td><td>str</td><td>str</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td></tr></thead><tbody><tr><td>&quot;Europe&quot;</td><td>&quot;BGR&quot;</td><td>&quot;Bulgaria&quot;</td><td>2019</td><td>1</td><td>15</td><td>8</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;CAN&quot;</td><td>&quot;Canada&quot;</td><td>2019</td><td>1</td><td>9</td><td>1</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;LVA&quot;</td><td>&quot;Latvia&quot;</td><td>2019</td><td>1</td><td>13</td><td>2623</td></tr><tr><td>&quot;South-East Asia&quot;</td><td>&quot;THA&quot;</td><td>&quot;Thailand&quot;</td><td>2020</td><td>9</td><td>337</td><td>2160</td></tr><tr><td>&quot;Africa&quot;</td><td>&quot;TGO&quot;</td><td>&quot;Togo&quot;</td><td>2020</td><td>1</td><td>92</td><td>7536</td></tr><tr><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;VNM&quot;</td><td>&quot;Viet Nam&quot;</td><td>2019</td><td>4</td><td>400</td><td>10887</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;ITA&quot;</td><td>&quot;Italy&quot;</td><td>2020</td><td>3</td><td>154</td><td>201</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;CHE&quot;</td><td>&quot;Switzerland&quot;</td><td>2019</td><td>6</td><td>327</td><td>7501</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;HND&quot;</td><td>&quot;Honduras&quot;</td><td>2020</td><td>1</td><td>12</td><td>1</td></tr><tr><td>&quot;Africa&quot;</td><td>&quot;KEN&quot;</td><td>&quot;Kenya&quot;</td><td>2020</td><td>3</td><td>608</td><td>7657</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nAnd there we have it — a simple aggregation of total plastic quantities by country and year! This process highlights the power of unpivoting: it organizes our data in a way that makes calcultions across multiple columns more straightforward.\n\nWe now have 106 records of Break From Plastics campaign activity in every country in 2019 and 2020. We have total number of events every year, number of volunteers who participated every year and the quantity of plastics collected and sorted through.\n\nHow would you answer this question: What are the top 5 countries in terms of the growth in productivity, defined is the number of plastic processed per event? So we are not just interested in productivity every year, but also how it has grown from 2019 to 2020. I am looking at Taiwan, for example that engaged the mind-blowing 31 thousand volunteers and sorted through 120 thousand pieces of plastic in just 2 huge events held in 2019. Now that's an achievement! Especially if they managed to keep the level of engagement up the following year. \n\n\nWe can certainly calculate productivity per event as `quantity` divided by `num_events`, but how would you calculate the growth in productivity for every country? We need to pivot the productivity column across years and calculate the growth from the pivoted data.\n\n< PAUSE >\n\n![](img/pivot_docs.png)\n\nPivot method has these main arguments:\n\n- `on` specifies which column(s) should be pivoted\n- `index` optional selector for which columns will NOT be pivoted - i.e. those that will stay unchanged\n- `values` where should the values for the pivoted columns come from.  \n\nThe `index` column is optional. It can be inferred from the other arguments, meaning that everything which is not in `on` or `values` will be treated as an `index` set of columns.\n\nYou can pivot multiple columns at once. Just indicate several columns in the `values` argument and the pivoted table will have one column for combination of the factor in `on` and each or the `values` columns. So here in our example I have a categorical variable `year` with 2 levels (2019/2020). I am interested in seeing `productivity` split by year into `productivity_2019` and `productivity_2020` columns. But I can at the same time pivot `quantity`, so I also have `quantity_2019` and `quantity_2020`.\n\nBefore I do the pivot, I want to drop the `num_events` and `volunteers` since I am not doing anything with them (even though you could argue it makes sense to pivot them by year as well). But at this time, we are not interested in these columns so we can just drop them. The reason I do it, is so that I dont have to specify the `index` argument in the `pivot` function, relying on `polars` to figure it out for me. \n\n\n< PAUSE >\n\n::: {#72bb3d98 .cell execution_count=16}\n``` {.python .cell-code}\n(plastics_countries_df\n    .unpivot(index=cs.by_name(\"region\", \"country_code\", \"country\", \"year\", \"num_events\", \"volunteers\"), \n            variable_name=\"plastic_type\", value_name=\"quantity\")\n    .group_by(\"region\", \"country_code\", \"country\", \"year\", \"num_events\", \"volunteers\")\n    .agg(pl.col(\"quantity\").sum())\n    .with_columns(productivity=pl.col(\"quantity\")/pl.col(\"num_events\"))\n    .drop(\"num_events\", \"volunteers\")\n    .pivot(on=cs.by_name(\"year\"), values=cs.by_name(\"productivity\", \"quantity\"))\n    .with_columns(prod_growth=pl.col(\"productivity_2020\")/pl.col(\"productivity_2019\")-1)\n    .filter(pl.col(\"prod_growth\").is_not_null())\n    .sort(\"prod_growth\", descending=True)\n    .head(10)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (10, 8)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>region</th><th>country_code</th><th>country</th><th>productivity_2020</th><th>productivity_2019</th><th>quantity_2020</th><th>quantity_2019</th><th>prod_growth</th></tr><tr><td>str</td><td>str</td><td>str</td><td>f64</td><td>f64</td><td>i64</td><td>i64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;Americas&quot;</td><td>&quot;CAN&quot;</td><td>&quot;Canada&quot;</td><td>204.333333</td><td>1.0</td><td>613</td><td>1</td><td>203.333333</td></tr><tr><td>&quot;South-East Asia&quot;</td><td>&quot;BGD&quot;</td><td>&quot;Bangladesh&quot;</td><td>2383.0</td><td>16.0</td><td>2383</td><td>16</td><td>147.9375</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;GBR&quot;</td><td>&quot;United Kingdom of Great Britai…</td><td>433.5</td><td>3.0</td><td>3468</td><td>3</td><td>143.5</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;JPN&quot;</td><td>&quot;Japan&quot;</td><td>240.0</td><td>2.4</td><td>240</td><td>84</td><td>99.0</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;FRA&quot;</td><td>&quot;France&quot;</td><td>910.333333</td><td>15.0</td><td>2731</td><td>15</td><td>59.688889</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;DEU&quot;</td><td>&quot;Germany&quot;</td><td>5008.0</td><td>140.5</td><td>5008</td><td>281</td><td>34.644128</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;IRL&quot;</td><td>&quot;Ireland&quot;</td><td>34.75</td><td>1.0</td><td>139</td><td>1</td><td>33.75</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;CHN&quot;</td><td>&quot;China&quot;</td><td>2332.0</td><td>72.0625</td><td>2332</td><td>3459</td><td>31.360798</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;AUS&quot;</td><td>&quot;Australia&quot;</td><td>75.777778</td><td>3.0</td><td>682</td><td>3</td><td>24.259259</td></tr><tr><td>&quot;Eastern Mediterranean&quot;</td><td>&quot;TUN&quot;</td><td>&quot;Tunisia&quot;</td><td>905.0</td><td>40.0</td><td>1810</td><td>40</td><td>21.625</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {#69e2b8a3 .cell execution_count=17}\n``` {.python .cell-code}\n(plastics_countries_df\n    .filter(pl.col(\"country\")==\"Germany\"))\n```\n\n::: {.cell-output .cell-output-display execution_count=17}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (2, 14)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>region</th><th>country_code</th><th>country</th><th>year</th><th>empty</th><th>hdpe</th><th>ldpe</th><th>o</th><th>pet</th><th>pp</th><th>ps</th><th>pvc</th><th>num_events</th><th>volunteers</th></tr><tr><td>str</td><td>str</td><td>str</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td></tr></thead><tbody><tr><td>&quot;Europe&quot;</td><td>&quot;DEU&quot;</td><td>&quot;Germany&quot;</td><td>2020</td><td>10</td><td>0</td><td>196</td><td>4604</td><td>97</td><td>94</td><td>7</td><td>0</td><td>1</td><td>24</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;DEU&quot;</td><td>&quot;Germany&quot;</td><td>2019</td><td>0</td><td>0</td><td>0</td><td>280</td><td>1</td><td>0</td><td>0</td><td>0</td><td>2</td><td>15</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n# VIDEO 5 great tables\n\nBefore we go any further, I want to quickly introduce you to the power of `great_tables` for producing engaing and informative tables. We will create a nice-looking table showing top-10 countries with the most impressive productivity growth. As we discussed earlier, the core function is `GT()` you also know that the default styling can be done with `.opt_stylize()` method. This is enough to produce decent looking table, but I want to show you a few more tricks.\n\nFirst of all, we have two groups of columns which are somehow related. A group of columns about *quantity* of plastic processed and a group of columns about *productivity*. We can introduce spanners - a grouping of columns in the table, where we can place a meaningful label. In `GT` this can accomplished with `.tab_spanner()`. As almost all methods in `great_tables()`, `.tab_spanner()` relies on `polars` selectors. So we can scoop all columns starting with `prod` under the Productivity spanner, and all columns starting with `quantity` under the other spanner.\n\nThe second group of functions in `great_tables` is related to columns. These methods will start with `.cols_` You can move and hide columns using `.cols_move()` and `.cols_hide()` without modifying the underlying data. Sometimes, it might be useful because the data is also used for something else, other than the table visualization and you don't want to shuffle the columns around just because you need to show them in the table in a particular order. In our case, we want to move the quantity group closer to the beginning of the table. There's also a convenient column labeler `.cols_label()`, which allows you to create arbitrary visual lables for columns without modifying the data. Again, in our table, because we introduced table spanners, we want some column names to be duplicates of each other, for example year numbers. But in `polars` all column names should be unique.\n\nFinally, the third block of functions I want to talk to you about is formatting. You can specify special formatting rules for one or more columns using `.fmt_` method. There are many pre-defined methods for formatting numbers, integers, percentages etc, including exoting column contents like flags and icons. The 3-letter country codes can serve as indentifiers for country flags and we will use this column format in our table. As with many other function in `GT` we are relying on polars.selectors to fetch the columns and then specify decimals, forced `+/-` sign, etc.\n\nWe will use the default styling in `.opt_stylize()` but later in this module we will have a look at custom styling function for creating more effective communication.\n\nAs with plots, it is good to annotate the table. You can add table header with title and subtitle, as well as the caption, called source note where you cite the souce of your data.\n\n< PAUSE >\n\n::: {#6619d826 .cell execution_count=18}\n``` {.python .cell-code}\ntop10_productivity_tbl = (plastics_countries_df\n    .unpivot(index=cs.by_name(\"region\", \"country_code\", \"country\", \"year\", \"num_events\", \"volunteers\"), \n            variable_name=\"plastic_type\", value_name=\"quantity\")\n    .group_by(\"region\", \"country_code\", \"country\", \"year\", \"num_events\", \"volunteers\")\n    .agg(pl.col(\"quantity\").sum())\n    .with_columns(productivity=pl.col(\"quantity\")/pl.col(\"num_events\"))\n    .drop(\"num_events\", \"volunteers\")\n    .pivot(on=cs.by_name(\"year\"), values=cs.by_name(\"productivity\", \"quantity\"))\n    .with_columns(prod_growth=pl.col(\"productivity_2020\")/pl.col(\"productivity_2019\")-1)\n    .filter(pl.col(\"prod_growth\").is_not_null())\n    .sort(\"prod_growth\", descending=True)\n    .head(10)\n)\n\n(top10_productivity_tbl\n    .pipe(GT)\n    .tab_spanner(label=\"Productivity\", columns=cs.starts_with(\"prod\"))\n    .tab_spanner(label=\"Quantity\", columns=cs.starts_with(\"quantity\"))\n    .cols_move(columns=cs.starts_with(\"quantity\"), after=\"country\")\n    .cols_hide(\"region\")\n    .cols_label(productivity_2019=\"2019\",\n                productivity_2020=\"2020\",\n                quantity_2019=\"2019\",\n                quantity_2020=\"2020\")\n    .cols_label(country=\"\",\n                prod_growth=\"Growth\",\n                country_code=\"\")\n    .fmt_number(columns=cs.starts_with(\"productivity\"), decimals=1)\n    .fmt_number(columns=cs.starts_with(\"quantity\"), decimals=0)\n    .fmt_percent(columns=cs.matches(\"prod_growth\"), decimals=0, force_sign=True)\n    .fmt_flag(columns=cs.matches(\"country_code\"))\n    .tab_header(title=\"Top 10 countries by the increase in plastic sorting productivity in 2019-2020\",\n            subtitle=\"Productivity is number of plastic samples processed per event\")\n    .tab_source_note(\"Source: Break Free From Plastic campaigns 2019, 2020\")\n    .opt_stylize(style=1)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```{=html}\n<div id=\"blrcifnhnh\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#blrcifnhnh table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#blrcifnhnh thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#blrcifnhnh p { margin: 0; padding: 0; }\n #blrcifnhnh .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #004D80; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #004D80; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #blrcifnhnh .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #blrcifnhnh .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #blrcifnhnh .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #blrcifnhnh .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #blrcifnhnh .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }\n #blrcifnhnh .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #blrcifnhnh .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #blrcifnhnh .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #blrcifnhnh .gt_column_spanner_outer:first-child { padding-left: 0; }\n #blrcifnhnh .gt_column_spanner_outer:last-child { padding-right: 0; }\n #blrcifnhnh .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #blrcifnhnh .gt_spanner_row { border-bottom-style: hidden; }\n #blrcifnhnh .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #blrcifnhnh .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: middle; }\n #blrcifnhnh .gt_from_md> :first-child { margin-top: 0; }\n #blrcifnhnh .gt_from_md> :last-child { margin-bottom: 0; }\n #blrcifnhnh .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #89D3FE; border-left-style: none; border-left-width: 1px; border-left-color: #89D3FE; border-right-style: none; border-right-width: 1px; border-right-color: #89D3FE; vertical-align: middle; overflow-x: hidden; }\n #blrcifnhnh .gt_stub { color: #FFFFFF; background-color: #0076BA; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #0076BA; padding-left: 5px; padding-right: 5px; }\n #blrcifnhnh .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #blrcifnhnh .gt_row_group_first td { border-top-width: 2px; }\n #blrcifnhnh .gt_row_group_first th { border-top-width: 2px; }\n #blrcifnhnh .gt_striped { background-color: #F4F4F4; }\n #blrcifnhnh .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }\n #blrcifnhnh .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #blrcifnhnh .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #blrcifnhnh .gt_left { text-align: left; }\n #blrcifnhnh .gt_center { text-align: center; }\n #blrcifnhnh .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #blrcifnhnh .gt_font_normal { font-weight: normal; }\n #blrcifnhnh .gt_font_bold { font-weight: bold; }\n #blrcifnhnh .gt_font_italic { font-style: italic; }\n #blrcifnhnh .gt_super { font-size: 65%; }\n #blrcifnhnh .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #blrcifnhnh .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n  <tr class=\"gt_heading\">\n    <td colspan=\"7\" class=\"gt_heading gt_title gt_font_normal\">Top 10 countries by the increase in plastic sorting productivity in 2019-2020</td>\n  </tr>\n  <tr class=\"gt_heading\">\n    <td colspan=\"7\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\">Productivity is number of plastic samples processed per event</td>\n  </tr>\n<tr class=\"gt_col_headings gt_spanner_row\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"Quantity\">\n    <span class=\"gt_column_spanner\">Quantity</span>\n  </th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" scope=\"colgroup\" id=\"Productivity\">\n    <span class=\"gt_column_spanner\">Productivity</span>\n  </th>\n</tr>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"2020\">2020</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"2019\">2019</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"2020\">2020</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"2019\">2019</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Growth\">Growth</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_left\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Canada</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#d80027\" d=\"M0 0v512h144l112-64 112 64h144V0H368L256 64 144 0Z\"/><path fill=\"#eee\" d=\"M144 0h224v512H144Z\"/><path fill=\"#d80027\" d=\"m301 289 44-22-22-11v-22l-45 22 23-44h-23l-22-34-22 33h-23l23 45-45-22v22l-22 11 45 22-12 23h45v33h22v-33h45z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left\">Canada</td>\n    <td class=\"gt_row gt_right\">613</td>\n    <td class=\"gt_row gt_right\">1</td>\n    <td class=\"gt_row gt_right\">204.3</td>\n    <td class=\"gt_row gt_right\">1.0</td>\n    <td class=\"gt_row gt_right\">+20,333%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Bangladesh</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#496e2d\" d=\"M0 0h512v512H0z\"/><circle cx=\"200.3\" cy=\"256\" r=\"111.3\" fill=\"#d80027\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left gt_striped\">Bangladesh</td>\n    <td class=\"gt_row gt_right gt_striped\">2,383</td>\n    <td class=\"gt_row gt_right gt_striped\">16</td>\n    <td class=\"gt_row gt_right gt_striped\">2,383.0</td>\n    <td class=\"gt_row gt_right gt_striped\">16.0</td>\n    <td class=\"gt_row gt_right gt_striped\">+14,794%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>United Kingdom</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#eee\" d=\"m0 0 8 22-8 23v23l32 54-32 54v32l32 48-32 48v32l32 54-32 54v68l22-8 23 8h23l54-32 54 32h32l48-32 48 32h32l54-32 54 32h68l-8-22 8-23v-23l-32-54 32-54v-32l-32-48 32-48v-32l-32-54 32-54V0l-22 8-23-8h-23l-54 32-54-32h-32l-48 32-48-32h-32l-54 32L68 0H0z\"/><path fill=\"#0052b4\" d=\"M336 0v108L444 0Zm176 68L404 176h108zM0 176h108L0 68ZM68 0l108 108V0Zm108 512V404L68 512ZM0 444l108-108H0Zm512-108H404l108 108Zm-68 176L336 404v108z\"/><path fill=\"#d80027\" d=\"M0 0v45l131 131h45L0 0zm208 0v208H0v96h208v208h96V304h208v-96H304V0h-96zm259 0L336 131v45L512 0h-45zM176 336 0 512h45l131-131v-45zm160 0 176 176v-45L381 336h-45z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left\">United Kingdom of Great Britain and Northern Ireland</td>\n    <td class=\"gt_row gt_right\">3,468</td>\n    <td class=\"gt_row gt_right\">3</td>\n    <td class=\"gt_row gt_right\">433.5</td>\n    <td class=\"gt_row gt_right\">3.0</td>\n    <td class=\"gt_row gt_right\">+14,350%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Japan</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#eee\" d=\"M0 0h512v512H0z\"/><circle cx=\"256\" cy=\"256\" r=\"111.3\" fill=\"#d80027\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left gt_striped\">Japan</td>\n    <td class=\"gt_row gt_right gt_striped\">240</td>\n    <td class=\"gt_row gt_right gt_striped\">84</td>\n    <td class=\"gt_row gt_right gt_striped\">240.0</td>\n    <td class=\"gt_row gt_right gt_striped\">2.4</td>\n    <td class=\"gt_row gt_right gt_striped\">+9,900%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>France</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#eee\" d=\"M167 0h178l25.9 252.3L345 512H167l-29.8-253.4z\"/><path fill=\"#0052b4\" d=\"M0 0h167v512H0z\"/><path fill=\"#d80027\" d=\"M345 0h167v512H345z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left\">France</td>\n    <td class=\"gt_row gt_right\">2,731</td>\n    <td class=\"gt_row gt_right\">15</td>\n    <td class=\"gt_row gt_right\">910.3</td>\n    <td class=\"gt_row gt_right\">15.0</td>\n    <td class=\"gt_row gt_right\">+5,969%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Germany</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#ffda44\" d=\"m0 345 256.7-25.5L512 345v167H0z\"/><path fill=\"#d80027\" d=\"m0 167 255-23 257 23v178H0z\"/><path fill=\"#333\" d=\"M0 0h512v167H0z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left gt_striped\">Germany</td>\n    <td class=\"gt_row gt_right gt_striped\">5,008</td>\n    <td class=\"gt_row gt_right gt_striped\">281</td>\n    <td class=\"gt_row gt_right gt_striped\">5,008.0</td>\n    <td class=\"gt_row gt_right gt_striped\">140.5</td>\n    <td class=\"gt_row gt_right gt_striped\">+3,464%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Ireland</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#eee\" d=\"M167 0h178l25.9 252.3L345 512H167l-29.8-253.4z\"/><path fill=\"#6da544\" d=\"M0 0h167v512H0z\"/><path fill=\"#ff9811\" d=\"M345 0h167v512H345z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left\">Ireland</td>\n    <td class=\"gt_row gt_right\">139</td>\n    <td class=\"gt_row gt_right\">1</td>\n    <td class=\"gt_row gt_right\">34.8</td>\n    <td class=\"gt_row gt_right\">1.0</td>\n    <td class=\"gt_row gt_right\">+3,375%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>China</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#d80027\" d=\"M0 0h512v512H0z\"/><path fill=\"#ffda44\" d=\"m140.1 155.8 22.1 68h71.5l-57.8 42.1 22.1 68-57.9-42-57.9 42 22.2-68-57.9-42.1H118zm163.4 240.7-16.9-20.8-25 9.7 14.5-22.5-16.9-20.9 25.9 6.9 14.6-22.5 1.4 26.8 26 6.9-25.1 9.6zm33.6-61 8-25.6-21.9-15.5 26.8-.4 7.9-25.6 8.7 25.4 26.8-.3-21.5 16 8.6 25.4-21.9-15.5zm45.3-147.6L370.6 212l19.2 18.7-26.5-3.8-11.8 24-4.6-26.4-26.6-3.8 23.8-12.5-4.6-26.5 19.2 18.7zm-78.2-73-2 26.7 24.9 10.1-26.1 6.4-1.9 26.8-14.1-22.8-26.1 6.4 17.3-20.5-14.2-22.7 24.9 10.1z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left gt_striped\">China</td>\n    <td class=\"gt_row gt_right gt_striped\">2,332</td>\n    <td class=\"gt_row gt_right gt_striped\">3,459</td>\n    <td class=\"gt_row gt_right gt_striped\">2,332.0</td>\n    <td class=\"gt_row gt_right gt_striped\">72.1</td>\n    <td class=\"gt_row gt_right gt_striped\">+3,136%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Australia</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#0052b4\" d=\"M0 0h512v512H0z\"/><path fill=\"#eee\" d=\"m154 300 14 30 32-8-14 30 25 20-32 7 1 33-26-21-26 21 1-33-33-7 26-20-14-30 32 8zm222-27h47l-38 27 15-44 14 44zm7-162 7 15 16-4-7 15 12 10-15 3v17l-13-11-13 11v-17l-15-3 12-10-7-15 16 4zm57 67 7 15 16-4-7 15 12 10-15 3v16l-13-10-13 11v-17l-15-3 12-10-7-15 16 4zm-122 22 7 15 16-4-7 15 12 10-15 3v16l-13-10-13 11v-17l-15-3 12-10-7-15 16 4zm65 156 7 15 16-4-7 15 12 10-15 3v17l-13-11-13 11v-17l-15-3 12-10-7-15 16 4zM0 0v32l32 32L0 96v160h32l32-32 32 32h32v-83l83 83h45l-8-16 8-15v-14l-83-83h83V96l-32-32 32-32V0H96L64 32 32 0Z\"/><path fill=\"#d80027\" d=\"M32 0v32H0v64h32v160h64V96h160V32H96V0Zm96 128 128 128v-31l-97-97z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left\">Australia</td>\n    <td class=\"gt_row gt_right\">682</td>\n    <td class=\"gt_row gt_right\">3</td>\n    <td class=\"gt_row gt_right\">75.8</td>\n    <td class=\"gt_row gt_right\">3.0</td>\n    <td class=\"gt_row gt_right\">+2,426%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Tunisia</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#d80027\" d=\"M0 0h512v512H0z\"/><circle cx=\"256\" cy=\"256\" r=\"122.4\" fill=\"#eee\"/><g fill=\"#d80027\"><path d=\"m271 209.2 21 29 34.1-11.1-21 29 21 28.9-34-11.1-21 29V267L237 256l34-11z\"/><path d=\"M283.8 328.3a72.3 72.3 0 1 1 34.4-136 89 89 0 1 0 0 127.3 72 72 0 0 1-34.4 8.7z\"/></g></g></svg></span></td>\n    <td class=\"gt_row gt_left gt_striped\">Tunisia</td>\n    <td class=\"gt_row gt_right gt_striped\">1,810</td>\n    <td class=\"gt_row gt_right gt_striped\">40</td>\n    <td class=\"gt_row gt_right gt_striped\">905.0</td>\n    <td class=\"gt_row gt_right gt_striped\">40.0</td>\n    <td class=\"gt_row gt_right gt_striped\">+2,162%</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"7\">Source: Break Free From Plastic campaigns 2019, 2020</td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\nYou may argue whether this table is informative, but it sure looks nice. And in the process of preparing it we have learned quite a lot about pivoting and great tables.\n\nI think it is your time to practice. Identifying the different types of plastic requires good knowledge of the different types of materials. Some materials were identified as belonging to predefined classes, while other samples were left unclassified (and ended up in the `o` (\"other\") or `empty` categories). Identification rate (measured in %) is the proportion of total pieces of plastic that were assigned to the predefined categories (and not to \"other\" or \"empty\"). We wonder if the increase in the engagement (number of volunteers signed up for BFFP events) leads to improvement of identification rate?\n\n< PAUSE >\n\n:::{.challenge}\nPut together a table of top 10 countries where identification rate improved the most between 2019 and 2020. Insrease in the rate should be measured as a simple difference between the two rates. Also, please calculate the percent increase/decrease in volunteer engagement for these countries. \n:::\n\nThere could be several ways to solve this task. In my table the top country is South Africa and the bottom country in Bangladesh. Pause a video and give this task a try! When you come back we will walk through a solution together and discuss the learning from the pivoting lesson.\n\n< PAUSE >\n\n::: {#4894fb22 .cell execution_count=19}\n``` {.python .cell-code}\ntop_10_id_rate_increase = (plastics_countries_df\n    .drop(\"num_events\")\n    .unpivot(index=cs.by_name(\"region\", \"country_code\", \"country\", \"year\", \"volunteers\"), \n            variable_name=\"plastic_type\", value_name=\"quantity\")\n    .with_columns(pl.col(\"plastic_type\").is_in([\"empty\", \"o\"]).alias(\"plastic_unidentified\"))\n    .group_by(\"region\", \"country_code\", \"country\", \"year\", \"volunteers\", \"plastic_unidentified\")\n    .agg(pl.col(\"quantity\").sum())\n    .with_columns( (pl.col(\"quantity\")/pl.col(\"quantity\").sum())\n                    .over(\"region\", \"country_code\", \"country\", \"year\", \"volunteers\")\n                    .alias(\"id_rate\"))\n    .filter(~pl.col(\"plastic_unidentified\"))\n    .drop(\"quantity\", \"plastic_unidentified\")\n    .pivot(on=cs.by_name(\"year\"), values=cs.by_name(\"volunteers\", \"id_rate\"))\n    .with_columns(volunteer_growth=pl.col(\"volunteers_2020\")/pl.col(\"volunteers_2019\")-1,\n                id_rate_increase=pl.col(\"id_rate_2020\")-pl.col(\"id_rate_2019\"))\n    .filter(pl.col(\"volunteer_growth\").is_not_null(),\n            pl.col(\"id_rate_increase\").is_not_null())\n    .sort(\"id_rate_increase\", descending=True)\n    .head(10)\n)\ntop_10_id_rate_increase\n```\n\n::: {.cell-output .cell-output-display execution_count=19}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (10, 9)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>region</th><th>country_code</th><th>country</th><th>volunteers_2020</th><th>volunteers_2019</th><th>id_rate_2020</th><th>id_rate_2019</th><th>volunteer_growth</th><th>id_rate_increase</th></tr><tr><td>str</td><td>str</td><td>str</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;Africa&quot;</td><td>&quot;ZAF&quot;</td><td>&quot;South Africa&quot;</td><td>20</td><td>511</td><td>0.989937</td><td>0.005525</td><td>-0.960861</td><td>0.984412</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ECU&quot;</td><td>&quot;Ecuador&quot;</td><td>22</td><td>455</td><td>0.990291</td><td>0.120252</td><td>-0.951648</td><td>0.87004</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;CAN&quot;</td><td>&quot;Canada&quot;</td><td>13</td><td>9</td><td>0.794454</td><td>0.0</td><td>0.444444</td><td>0.794454</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;COL&quot;</td><td>&quot;Colombia&quot;</td><td>274</td><td>5253</td><td>0.659292</td><td>0.0</td><td>-0.947839</td><td>0.659292</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;ESP&quot;</td><td>&quot;Spain&quot;</td><td>284</td><td>330</td><td>0.686088</td><td>0.051733</td><td>-0.139394</td><td>0.634355</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;BRA&quot;</td><td>&quot;Brazil&quot;</td><td>78</td><td>419</td><td>0.866209</td><td>0.243346</td><td>-0.813842</td><td>0.622863</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;PRT&quot;</td><td>&quot;Portugal&quot;</td><td>65</td><td>43</td><td>0.47173</td><td>0.003984</td><td>0.511628</td><td>0.467746</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;PHL&quot;</td><td>&quot;Philippines&quot;</td><td>915</td><td>3751</td><td>0.931515</td><td>0.463989</td><td>-0.756065</td><td>0.467527</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;MEX&quot;</td><td>&quot;Mexico&quot;</td><td>83</td><td>48</td><td>0.90846</td><td>0.50627</td><td>0.729167</td><td>0.402191</td></tr><tr><td>&quot;South-East Asia&quot;</td><td>&quot;BGD&quot;</td><td>&quot;Bangladesh&quot;</td><td>127</td><td>100</td><td>0.345783</td><td>0.0</td><td>0.27</td><td>0.345783</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nYou are done already? If not, then here are some tips:\n\n- You can create a boolean variable of whether a piece of plastic is identified or not. Include it into the list of grouping variables and calculate totals by it. Then pivot on this variable. This will allow you to calculate the identification rate.\n\n- Alternatively, you can calculate the identification rate using the `.over()` method as we did in the previous module and then just filter out the rows you dont need.\n\n- Pivot both `volunteers` and `id_rate` on `year`. Make sure you drop all other columns which are not part of your index valriables.\n\n- Its a good idea to filter out records containing null in either one of the growth metrics. This will eliminate countries which did not participate in BFFP campaigns one of the years.\n\nIf you find these tips helpful pause again and try solving the task. Otherwise, hang on, we will discuss the solution to this challenge together momentarily.\n\n< PAUSE >\n\n::: {#544a9e9e .cell execution_count=20}\n``` {.python .cell-code}\n(top_10_id_rate_increase\n    .pipe(GT)\n    .tab_spanner(label=\"Indentification\", columns=cs.starts_with(\"id_rate\"))\n    .tab_spanner(label=\"Volunteers\", columns=cs.starts_with(\"volunteer\"))\n    #.cols_move(columns=cs.starts_with(\"quantity\"), after=\"country\")\n    .cols_hide(\"region\")\n    .cols_label(cases={\n                \"volunteers_2019\": \"2019\",\n                \"volunteers_2020\": \"2020\",\n                \"id_rate_2019\": \"2019\",\n                \"id_rate_2020\": \"2020\"\n                })\n    .cols_label(country=\"\",\n                volunteer_growth=\"Growth\",\n                id_rate_increase=\"Increase %\",\n                country_code=\"\")\n    .fmt_percent(columns=cs.starts_with(\"id_rate\"), decimals=1)\n    .fmt_number(columns=cs.starts_with(\"volunteers\"), decimals=0)\n    .fmt_percent(columns=cs.matches(\"volunteer_growth\"), decimals=0, force_sign=True)\n    .fmt_percent(columns=cs.matches(\"id_rate_increase\"), decimals=1, force_sign=True)\n    .fmt_flag(columns=cs.matches(\"country_code\"))\n    .tab_header(title=\"Top 10 countried by the increase in plastic indentification in 2019-2020\",\n            subtitle=\"Indentification rate is proportion of plastic samples assigned to one of BFFP categories\")\n    .tab_source_note(\"Source: Break Free From Plastic campaigns 2019, 2020\")\n    .opt_stylize(style=1)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=20}\n```{=html}\n<div id=\"mjfnwtejlf\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#mjfnwtejlf table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#mjfnwtejlf thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#mjfnwtejlf p { margin: 0; padding: 0; }\n #mjfnwtejlf .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #004D80; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #004D80; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #mjfnwtejlf .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #mjfnwtejlf .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #mjfnwtejlf .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #mjfnwtejlf .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #mjfnwtejlf .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }\n #mjfnwtejlf .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #mjfnwtejlf .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #mjfnwtejlf .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #mjfnwtejlf .gt_column_spanner_outer:first-child { padding-left: 0; }\n #mjfnwtejlf .gt_column_spanner_outer:last-child { padding-right: 0; }\n #mjfnwtejlf .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #mjfnwtejlf .gt_spanner_row { border-bottom-style: hidden; }\n #mjfnwtejlf .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #mjfnwtejlf .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: middle; }\n #mjfnwtejlf .gt_from_md> :first-child { margin-top: 0; }\n #mjfnwtejlf .gt_from_md> :last-child { margin-bottom: 0; }\n #mjfnwtejlf .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #89D3FE; border-left-style: none; border-left-width: 1px; border-left-color: #89D3FE; border-right-style: none; border-right-width: 1px; border-right-color: #89D3FE; vertical-align: middle; overflow-x: hidden; }\n #mjfnwtejlf .gt_stub { color: #FFFFFF; background-color: #0076BA; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #0076BA; padding-left: 5px; padding-right: 5px; }\n #mjfnwtejlf .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #mjfnwtejlf .gt_row_group_first td { border-top-width: 2px; }\n #mjfnwtejlf .gt_row_group_first th { border-top-width: 2px; }\n #mjfnwtejlf .gt_striped { background-color: #F4F4F4; }\n #mjfnwtejlf .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }\n #mjfnwtejlf .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #mjfnwtejlf .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #mjfnwtejlf .gt_left { text-align: left; }\n #mjfnwtejlf .gt_center { text-align: center; }\n #mjfnwtejlf .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #mjfnwtejlf .gt_font_normal { font-weight: normal; }\n #mjfnwtejlf .gt_font_bold { font-weight: bold; }\n #mjfnwtejlf .gt_font_italic { font-style: italic; }\n #mjfnwtejlf .gt_super { font-size: 65%; }\n #mjfnwtejlf .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #mjfnwtejlf .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n  <tr class=\"gt_heading\">\n    <td colspan=\"8\" class=\"gt_heading gt_title gt_font_normal\">Top 10 countried by the increase in plastic indentification in 2019-2020</td>\n  </tr>\n  <tr class=\"gt_heading\">\n    <td colspan=\"8\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\">Indentification rate is proportion of plastic samples assigned to one of BFFP categories</td>\n  </tr>\n<tr class=\"gt_col_headings gt_spanner_row\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" scope=\"colgroup\" id=\"Volunteers\">\n    <span class=\"gt_column_spanner\">Volunteers</span>\n  </th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" scope=\"colgroup\" id=\"Indentification\">\n    <span class=\"gt_column_spanner\">Indentification</span>\n  </th>\n</tr>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"2020\">2020</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"2019\">2019</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Growth\">Growth</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"2020\">2020</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"2019\">2019</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Increase %\">Increase %</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_left\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>South Africa</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#eee\" d=\"m0 0 192 256L0 512h47l465-189v-34l-32-33 32-33v-34L47 0Z\"/><path fill=\"#333\" d=\"M0 142v228l140-114z\"/><path fill=\"#ffda44\" d=\"M192 256 0 95v47l114 114L0 370v47z\"/><path fill=\"#6da544\" d=\"M512 223H223L0 0v94l161 162L0 418v94l223-223h289z\"/><path fill=\"#d80027\" d=\"M512 0H47l189 189h276z\"/><path fill=\"#0052b4\" d=\"M512 512H47l189-189h276z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left\">South Africa</td>\n    <td class=\"gt_row gt_right\">20</td>\n    <td class=\"gt_row gt_right\">511</td>\n    <td class=\"gt_row gt_right\">−96%</td>\n    <td class=\"gt_row gt_right\">99.0%</td>\n    <td class=\"gt_row gt_right\">0.6%</td>\n    <td class=\"gt_row gt_right\">+98.4%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Ecuador</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#d80027\" d=\"m0 384 254.7-32.7L512 383.9V512H0z\"/><path fill=\"#0052b4\" d=\"m0 256 255-27 257 27v128H0z\"/><path fill=\"#ffda44\" d=\"M0 0h512v256H0z\"/><circle cx=\"256\" cy=\"256\" r=\"89\" fill=\"#ffda44\"/><path fill=\"#338af3\" d=\"M256 311.6c-30.7 0-55.7-25-55.7-55.6v-33.4a55.7 55.7 0 0 1 111.4 0V256c0 30.6-25 55.6-55.7 55.6z\"/><path fill=\"#333\" d=\"M345 122.4h-66.7a22.3 22.3 0 0 0-44.6 0H167a23 23 0 0 0 23 22.3h-.8c0 12.3 10 22.3 22.3 22.3 0 12.3 10 22.2 22.2 22.2h44.6c12.3 0 22.2-10 22.2-22.2 12.3 0 22.3-10 22.3-22.3h-.8a23 23 0 0 0 23-22.3z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left gt_striped\">Ecuador</td>\n    <td class=\"gt_row gt_right gt_striped\">22</td>\n    <td class=\"gt_row gt_right gt_striped\">455</td>\n    <td class=\"gt_row gt_right gt_striped\">−95%</td>\n    <td class=\"gt_row gt_right gt_striped\">99.0%</td>\n    <td class=\"gt_row gt_right gt_striped\">12.0%</td>\n    <td class=\"gt_row gt_right gt_striped\">+87.0%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Canada</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#d80027\" d=\"M0 0v512h144l112-64 112 64h144V0H368L256 64 144 0Z\"/><path fill=\"#eee\" d=\"M144 0h224v512H144Z\"/><path fill=\"#d80027\" d=\"m301 289 44-22-22-11v-22l-45 22 23-44h-23l-22-34-22 33h-23l23 45-45-22v22l-22 11 45 22-12 23h45v33h22v-33h45z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left\">Canada</td>\n    <td class=\"gt_row gt_right\">13</td>\n    <td class=\"gt_row gt_right\">9</td>\n    <td class=\"gt_row gt_right\">+44%</td>\n    <td class=\"gt_row gt_right\">79.4%</td>\n    <td class=\"gt_row gt_right\">0.0%</td>\n    <td class=\"gt_row gt_right\">+79.4%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Colombia</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#d80027\" d=\"m0 384 255.8-29.7L512 384v128H0z\"/><path fill=\"#0052b4\" d=\"m0 256 259.5-31L512 256v128H0z\"/><path fill=\"#ffda44\" d=\"M0 0h512v256H0z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left gt_striped\">Colombia</td>\n    <td class=\"gt_row gt_right gt_striped\">274</td>\n    <td class=\"gt_row gt_right gt_striped\">5,253</td>\n    <td class=\"gt_row gt_right gt_striped\">−95%</td>\n    <td class=\"gt_row gt_right gt_striped\">65.9%</td>\n    <td class=\"gt_row gt_right gt_striped\">0.0%</td>\n    <td class=\"gt_row gt_right gt_striped\">+65.9%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Spain</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#ffda44\" d=\"m0 128 256-32 256 32v256l-256 32L0 384Z\"/><path fill=\"#d80027\" d=\"M0 0h512v128H0zm0 384h512v128H0z\"/><g fill=\"#eee\"><path d=\"M144 304h-16v-80h16zm128 0h16v-80h-16z\"/><ellipse cx=\"208\" cy=\"296\" rx=\"48\" ry=\"32\"/></g><g fill=\"#d80027\"><rect width=\"16\" height=\"24\" x=\"128\" y=\"192\" rx=\"8\"/><rect width=\"16\" height=\"24\" x=\"272\" y=\"192\" rx=\"8\"/><path d=\"M208 272v24a24 24 0 0 0 24 24 24 24 0 0 0 24-24v-24h-24z\"/></g><rect width=\"32\" height=\"16\" x=\"120\" y=\"208\" fill=\"#ff9811\" ry=\"8\"/><rect width=\"32\" height=\"16\" x=\"264\" y=\"208\" fill=\"#ff9811\" ry=\"8\"/><rect width=\"32\" height=\"16\" x=\"120\" y=\"304\" fill=\"#ff9811\" rx=\"8\"/><rect width=\"32\" height=\"16\" x=\"264\" y=\"304\" fill=\"#ff9811\" rx=\"8\"/><path fill=\"#ff9811\" d=\"M160 272v24c0 8 4 14 9 19l5-6 5 10a21 21 0 0 0 10 0l5-10 5 6c6-5 9-11 9-19v-24h-9l-5 8-5-8h-10l-5 8-5-8z\"/><path d=\"M122 252h172m-172 24h28m116 0h28\"/><path fill=\"#d80027\" d=\"M122 248a4 4 0 0 0-4 4 4 4 0 0 0 4 4h172a4 4 0 0 0 4-4 4 4 0 0 0-4-4zm0 24a4 4 0 0 0-4 4 4 4 0 0 0 4 4h28a4 4 0 0 0 4-4 4 4 0 0 0-4-4zm144 0a4 4 0 0 0-4 4 4 4 0 0 0 4 4h28a4 4 0 0 0 4-4 4 4 0 0 0-4-4z\"/><path fill=\"#eee\" d=\"M196 168c-7 0-13 5-15 11l-5-1c-9 0-16 7-16 16s7 16 16 16c7 0 13-4 15-11a16 16 0 0 0 17-4 16 16 0 0 0 17 4 16 16 0 1 0 10-20 16 16 0 0 0-27-5c-3-4-7-6-12-6zm0 8c5 0 8 4 8 8 0 5-3 8-8 8-4 0-8-3-8-8 0-4 4-8 8-8zm24 0c5 0 8 4 8 8 0 5-3 8-8 8-4 0-8-3-8-8 0-4 4-8 8-8zm-44 10 4 1 4 8c0 4-4 7-8 7s-8-3-8-8c0-4 4-8 8-8zm64 0c5 0 8 4 8 8 0 5-3 8-8 8-4 0-8-3-8-7l4-8z\"/><path fill=\"none\" d=\"M220 284v12c0 7 5 12 12 12s12-5 12-12v-12z\"/><path fill=\"#ff9811\" d=\"M200 160h16v32h-16z\"/><path fill=\"#eee\" d=\"M208 224h48v48h-48z\"/><path fill=\"#d80027\" d=\"m248 208-8 8h-64l-8-8c0-13 18-24 40-24s40 11 40 24zm-88 16h48v48h-48z\"/><rect width=\"20\" height=\"32\" x=\"222\" y=\"232\" fill=\"#d80027\" rx=\"10\" ry=\"10\"/><path fill=\"#ff9811\" d=\"M168 232v8h8v16h-8v8h32v-8h-8v-16h8v-8zm8-16h64v8h-64z\"/><g fill=\"#ffda44\"><circle cx=\"186\" cy=\"202\" r=\"6\"/><circle cx=\"208\" cy=\"202\" r=\"6\"/><circle cx=\"230\" cy=\"202\" r=\"6\"/></g><path fill=\"#d80027\" d=\"M169 272v43a24 24 0 0 0 10 4v-47h-10zm20 0v47a24 24 0 0 0 10-4v-43h-10z\"/><g fill=\"#338af3\"><circle cx=\"208\" cy=\"272\" r=\"16\"/><rect width=\"32\" height=\"16\" x=\"264\" y=\"320\" ry=\"8\"/><rect width=\"32\" height=\"16\" x=\"120\" y=\"320\" ry=\"8\"/></g></g></svg></span></td>\n    <td class=\"gt_row gt_left\">Spain</td>\n    <td class=\"gt_row gt_right\">284</td>\n    <td class=\"gt_row gt_right\">330</td>\n    <td class=\"gt_row gt_right\">−14%</td>\n    <td class=\"gt_row gt_right\">68.6%</td>\n    <td class=\"gt_row gt_right\">5.2%</td>\n    <td class=\"gt_row gt_right\">+63.4%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Brazil</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#6da544\" d=\"M0 0h512v512H0z\"/><path fill=\"#ffda44\" d=\"M256 100.2 467.5 256 256 411.8 44.5 256z\"/><path fill=\"#eee\" d=\"M174.2 221a87 87 0 0 0-7.2 36.3l162 49.8a88.5 88.5 0 0 0 14.4-34c-40.6-65.3-119.7-80.3-169.1-52z\"/><path fill=\"#0052b4\" d=\"M255.7 167a89 89 0 0 0-41.9 10.6 89 89 0 0 0-39.6 43.4 181.7 181.7 0 0 1 169.1 52.2 89 89 0 0 0-9-59.4 89 89 0 0 0-78.6-46.8zM212 250.5a149 149 0 0 0-45 6.8 89 89 0 0 0 10.5 40.9 89 89 0 0 0 120.6 36.2 89 89 0 0 0 30.7-27.3A151 151 0 0 0 212 250.5z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left gt_striped\">Brazil</td>\n    <td class=\"gt_row gt_right gt_striped\">78</td>\n    <td class=\"gt_row gt_right gt_striped\">419</td>\n    <td class=\"gt_row gt_right gt_striped\">−81%</td>\n    <td class=\"gt_row gt_right gt_striped\">86.6%</td>\n    <td class=\"gt_row gt_right gt_striped\">24.3%</td>\n    <td class=\"gt_row gt_right gt_striped\">+62.3%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Portugal</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#6da544\" d=\"M0 512h167l37.9-260.3L167 0H0z\"/><path fill=\"#d80027\" d=\"M512 0H167v512h345z\"/><circle cx=\"167\" cy=\"256\" r=\"89\" fill=\"#ffda44\"/><path fill=\"#d80027\" d=\"M116.9 211.5V267a50 50 0 1 0 100.1 0v-55.6H117z\"/><path fill=\"#eee\" d=\"M167 283.8c-9.2 0-16.7-7.5-16.7-16.7V245h33.4v22c0 9.2-7.5 16.7-16.7 16.7z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left\">Portugal</td>\n    <td class=\"gt_row gt_right\">65</td>\n    <td class=\"gt_row gt_right\">43</td>\n    <td class=\"gt_row gt_right\">+51%</td>\n    <td class=\"gt_row gt_right\">47.2%</td>\n    <td class=\"gt_row gt_right\">0.4%</td>\n    <td class=\"gt_row gt_right\">+46.8%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Philippines</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#0052b4\" d=\"M0 0h512v256l-265 45.2z\"/><path fill=\"#d80027\" d=\"M210 256h302v256H0z\"/><path fill=\"#eee\" d=\"M0 0v512l256-256z\"/><path fill=\"#ffda44\" d=\"M175.3 256 144 241.3l16.7-30.3-34 6.5-4.3-34.3-23.6 25.2L75 183.2l-4.3 34.3-34-6.5 16.7 30.3L22.3 256l31.2 14.7L37 301l34-6.5 4.2 34.3 23.7-25.2 23.6 25.2 4.3-34.3 34 6.5-16.7-30.3zm-107-155.8 10.4 14.5 17-5.4-10.6 14.4 10.4 14.5-17-5.6L68 147l.2-17.9-17-5.6 17-5.4zm0 264.8 10.4 14.6 17-5.4-10.6 14.3 10.4 14.6-17-5.7L68 411.8l.2-17.9-17-5.6 17-5.4zm148.4-132.4L206.3 247l-17-5.4 10.5 14.4-10.4 14.6 17-5.7 10.6 14.4-.1-17.9 17-5.6-17.1-5.4z\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left gt_striped\">Philippines</td>\n    <td class=\"gt_row gt_right gt_striped\">915</td>\n    <td class=\"gt_row gt_right gt_striped\">3,751</td>\n    <td class=\"gt_row gt_right gt_striped\">−76%</td>\n    <td class=\"gt_row gt_right gt_striped\">93.2%</td>\n    <td class=\"gt_row gt_right gt_striped\">46.4%</td>\n    <td class=\"gt_row gt_right gt_striped\">+46.8%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Mexico</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#eee\" d=\"M144 0h223l33 256-33 256H144l-32-256z\"/><path fill=\"#496e2d\" d=\"M0 0h144v512H0z\"/><path fill=\"#d80027\" d=\"M368 0h144v512H368z\"/><path fill=\"#ffda44\" d=\"M256 277v10h12l10-22z\"/><path fill=\"#496e2d\" d=\"M160 242a96 96 0 0 0 192 0h-11a85 85 0 0 1-170 0zm39 17-4 2c-2 2-2 6 1 8 15 14 34 22 54 24v17h12v-17c20-2 39-10 54-24 3-2 3-6 1-8s-6-2-8 0a78 78 0 0 1-53 21c-19 0-38-8-53-21z\"/><path fill=\"#338af3\" d=\"M256 316c-14 0-28-5-40-13l6-9c20 13 48 13 68 0l7 9c-12 8-26 13-41 13z\"/><path fill=\"#751a46\" d=\"M256 174c22 11 12 33 11 34l-2-4c-5-11-18-18-31-18v11c6 0 11 5 11 11-7 7-9 17-4 26l4 8-13 23 29-7 18 18v-11l11 11 23-11-35-21-5-21 28 16c4 11 12 21 23 26 9-83-42-91-61-91z\"/><path fill=\"#6da544\" d=\"M222 271c-15 0-33-12-38-40l11-2c4 23 18 31 27 31 3 0 5-1 6-3 0-2 0-3-6-5-3-1-7-2-10-5-10-12 4-24 11-30 1-1 2-2 1-3 0 0-2-2-5-2-7 0-12-4-14-11-2-6 2-13 8-17l5 11c-2 0-2 2-2 4 0 0 1 2 3 2 7 0 14 4 16 9 1 3 2 9-5 15-7 7-11 12-9 15l5 1c5 2 14 5 13 17-1 8-8 13-17 13h-1z\"/><path fill=\"#ffda44\" d=\"m234 186-12 11v11l18-9c3-1 3-5 1-7z\"/><circle cx=\"172\" cy=\"275\" r=\"8\" fill=\"#ffda44\"/><circle cx=\"189\" cy=\"302\" r=\"8\" fill=\"#ffda44\"/><circle cx=\"216\" cy=\"323\" r=\"8\" fill=\"#ffda44\"/><circle cx=\"297\" cy=\"323\" r=\"8\" fill=\"#ffda44\"/><circle cx=\"324\" cy=\"302\" r=\"8\" fill=\"#ffda44\"/><circle cx=\"341\" cy=\"275\" r=\"8\" fill=\"#ffda44\"/><rect width=\"34\" height=\"22\" x=\"239\" y=\"299\" fill=\"#ff9811\" rx=\"11\" ry=\"11\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left\">Mexico</td>\n    <td class=\"gt_row gt_right\">83</td>\n    <td class=\"gt_row gt_right\">48</td>\n    <td class=\"gt_row gt_right\">+73%</td>\n    <td class=\"gt_row gt_right\">90.8%</td>\n    <td class=\"gt_row gt_right\">50.6%</td>\n    <td class=\"gt_row gt_right\">+40.2%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left gt_striped\"><span style=\"white-space:nowrap;\"><svg xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" role=\"img\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" style=\"vertical-align:-0.125em;image-rendering:optimizeQuality;height:1em;width:1em;\"><title>Bangladesh</title><mask id=\"a\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill=\"#fff\"/></mask><g mask=\"url(#a)\"><path fill=\"#496e2d\" d=\"M0 0h512v512H0z\"/><circle cx=\"200.3\" cy=\"256\" r=\"111.3\" fill=\"#d80027\"/></g></svg></span></td>\n    <td class=\"gt_row gt_left gt_striped\">Bangladesh</td>\n    <td class=\"gt_row gt_right gt_striped\">127</td>\n    <td class=\"gt_row gt_right gt_striped\">100</td>\n    <td class=\"gt_row gt_right gt_striped\">+27%</td>\n    <td class=\"gt_row gt_right gt_striped\">34.6%</td>\n    <td class=\"gt_row gt_right gt_striped\">0.0%</td>\n    <td class=\"gt_row gt_right gt_striped\">+34.6%</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"8\">Source: Break Free From Plastic campaigns 2019, 2020</td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\nWhew! You did it! Was it hard? Well, I am sure you have learned a lot and should be proud of yourself! One thing you can be sure of is that although this task is a little contrived and the data is a little dirty, the process of solving it not untypical for the daily job of a data analyst. The data analysis tasks in real life do not come nicely packaged and most of the data requires substantial amount of care before it can be usable.\n\nSo, let us talk through this solution together.\n\n- The first unpivoting should be quite straightforward. We list all ID columns in the `index` argument and provide new names for the key and value columns, just as we discussed earlier.\n- Then we create an \"plastic_unidentified\" variable in our data frame, which indicates whether a plastic waste is indentified by type or not. If the `plastic_type` takes \"empty\" or \"o\" value, our `plastic_unidentified` variable will contain the boolean value of `True`. You know how to write `pl.col(\"plastic_type\")==\"empty\" | pl.col(\"plastic_type\")==\"o\"` with explicit logical OR, but here I show you how to use `.is_in()` method with a list argument. Same result!\n- Then we group by everything *including* this new column and summarize. This should be familiar.\n- We dont need `num_events` column. Let's drop it so it does not interfere in our pivoting.\n- We are interested in calculating the proportion of identified plastic. At this moment you have two choices:\n\n    - Calculate the proportion using `.over` using expression `(pl.col(\"quantity\")/pl.col(\"quantity\").sum())` and then only keep the records where `plastic_unidentified` is False (using `~` for negation). The relevant lines would look something like this:\n\n< PAUSE >\n\n::: {#a287e90a .cell execution_count=21}\n``` {.python .cell-code}\n    .with_columns( (pl.col(\"quantity\")/pl.col(\"quantity\").sum())\n                    .over(\"region\", \"country_code\", \"country\", \"year\", \"volunteers\")\n                    .alias(\"id_rate\"))\n    .filter(~pl.col(\"plastic_unidentified\"))\n```\n:::\n\n\n    - Alternatively, we can pivot the `plastic_unidentified` and compute the proportion across the two new columns (named True and False). This option would look something like this:\n\n< PAUSE >\n\n::: {#515009e4 .cell execution_count=22}\n``` {.python .cell-code}\n    .pivot(on=cs.by_name(\"plastic_unidentified\"), values=cs.by_name(\"quantity\"))\n    .with_columns(id_rate=pl.col(\"false\")/(pl.col(\"true\")+pl.col(\"false\")))\n    .drop(\"true\", \"false\")\n```\n:::\n\n\n- Finally we need to pivot on year. Here we pivot both `volunteers` and newly created `id_rate` because our task was to show change in both. As we discussed earlier, this will create total of 4 columns because there are 2 levels in `year` column and we are pivoting 2 variables.\n- Our last step is to calculate the volunteer growth and the identification rate increase. One is percent growth and the other is a simple difference in percent values. Drop the records where either one of them is Null and sort by `id_rate_increase`. Then take top 10 records only.\n\n\n# VIDEO 6 intro to joins {greenscreen} ~ 10 min\n\nIn a typical data analysis project, data often comes in multiple files or tables, each describing a different aspect of a problem or phenomenon. These separate tables might exist because the data comes from different sources, or simply because it’s easier to manage that way. As an analyst, you’ll often need to combine related datasets based on shared characteristics—such as countries, time periods, or other common identifiers. This is the case with the original gapminder data, collected by Hans Rosling, which consists of multiple tables linked by country and year.\n\nOne of the most common ways to merge datasets is through a join. A join allows you to bring data from one table into another based on matching values in one or more columns. In Polars, this is done using the .join() method.\n\nLet’s look at an example. We have two small datasets: one lists the countries in the Nordic Council, including their area and population; the other contains information on members of the European Free Trade Association (EFTA), with data on exports, imports, and GDP (in billion USD). Our goal is to combine these datasets in a meaningful way.\n\n< PAUSE >\n\n::: {#9a4b88b5 .cell execution_count=23}\n``` {.python .cell-code}\nnordic_council = pl.DataFrame({\n    \"country_name\": [\"Denmark\", \"Finland\", \"Iceland\", \"Sweden\", \"Norway\"],\n    \"population_mln\": [5.973136, 5.626414, 0.364036, 10.589835, 5.509733],\n    \"area_sqkm\": [43094, 338145, 103000, 450295, 323802]\n})\n\nefta_countries = pl.DataFrame({\n    \"country_name\": [\"Norway\", \"Switzerland\", \"Iceland\", \"Liechtenstein\"],\n    \"exports_bln\": [228.625, 661.628, 13.49, 3.217],\n    \"imports_bln\": [157.032, 554.358, 13.484, 2.23],\n    \"gdp_bln\": [499.528, 733.779, 26.155, 4.978]\n})\n```\n:::\n\n\n::: {#27798a85 .cell execution_count=24}\n``` {.python .cell-code}\nnordic_council\n```\n\n::: {.cell-output .cell-output-display execution_count=22}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (5, 3)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>country_name</th><th>population_mln</th><th>area_sqkm</th></tr><tr><td>str</td><td>f64</td><td>i64</td></tr></thead><tbody><tr><td>&quot;Denmark&quot;</td><td>5.973136</td><td>43094</td></tr><tr><td>&quot;Finland&quot;</td><td>5.626414</td><td>338145</td></tr><tr><td>&quot;Iceland&quot;</td><td>0.364036</td><td>103000</td></tr><tr><td>&quot;Sweden&quot;</td><td>10.589835</td><td>450295</td></tr><tr><td>&quot;Norway&quot;</td><td>5.509733</td><td>323802</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {#4a6c52ad .cell execution_count=25}\n``` {.python .cell-code}\nefta_countries\n```\n\n::: {.cell-output .cell-output-display execution_count=23}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (4, 4)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>country_name</th><th>exports_bln</th><th>imports_bln</th><th>gdp_bln</th></tr><tr><td>str</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;Norway&quot;</td><td>228.625</td><td>157.032</td><td>499.528</td></tr><tr><td>&quot;Switzerland&quot;</td><td>661.628</td><td>554.358</td><td>733.779</td></tr><tr><td>&quot;Iceland&quot;</td><td>13.49</td><td>13.484</td><td>26.155</td></tr><tr><td>&quot;Liechtenstein&quot;</td><td>3.217</td><td>2.23</td><td>4.978</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nIceland and Norway are members of both the Nordic Council and EFTA. Let’s say we want to calculate GDP per capita for these countries. The challenge? GDP is stored in one table, while population is in another.\n\nHow do we solve this? That’s right—we need to join the tables! By merging them based on the shared \"country_name\" column, we can bring all the necessary information together. Once combined, we can simply use the .with_columns() method to compute GDP per capita. \n\nThis approach lets us seamlessly integrate data from different sources and perform new calculations with ease.\n\n< PAUSE >\n\n::: {#aa6f62c6 .cell execution_count=26}\n``` {.python .cell-code}\n(nordic_council\n    .join(efta_countries, on=\"country_name\")\n    .with_columns(gdp_per_cap=pl.col(\"gdp_bln\")/pl.col(\"population_mln\"))\n    )\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (2, 7)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>country_name</th><th>population_mln</th><th>area_sqkm</th><th>exports_bln</th><th>imports_bln</th><th>gdp_bln</th><th>gdp_per_cap</th></tr><tr><td>str</td><td>f64</td><td>i64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;Iceland&quot;</td><td>0.364036</td><td>103000</td><td>13.49</td><td>13.484</td><td>26.155</td><td>71.84729</td></tr><tr><td>&quot;Norway&quot;</td><td>5.509733</td><td>323802</td><td>228.625</td><td>157.032</td><td>499.528</td><td>90.662832</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nNotice that after our join, only Iceland and Norway remain in the result. The other Nordic countries were dropped because they had no match in the efta_countries table. This type of join is called an inner join, and it’s the default behavior in Polars.\n\nBut what if we don’t want to lose the unmatched records? That’s where a left join comes in.\n\nA left join keeps all records from the table on the “left” and adds matching information from the table on the “right.” If no match is found, the missing values are filled with null. Since we’re starting with nordic_council, it serves as our “left” table.\n\nLet’s see it in action:\n\n< PAUSE >\n\n::: {#80519b4c .cell execution_count=27}\n``` {.python .cell-code}\n(nordic_council\n    .join(efta_countries, on=\"country_name\", how=\"left\")\n    )\n```\n\n::: {.cell-output .cell-output-display execution_count=25}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (5, 6)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>country_name</th><th>population_mln</th><th>area_sqkm</th><th>exports_bln</th><th>imports_bln</th><th>gdp_bln</th></tr><tr><td>str</td><td>f64</td><td>i64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;Denmark&quot;</td><td>5.973136</td><td>43094</td><td>null</td><td>null</td><td>null</td></tr><tr><td>&quot;Finland&quot;</td><td>5.626414</td><td>338145</td><td>null</td><td>null</td><td>null</td></tr><tr><td>&quot;Iceland&quot;</td><td>0.364036</td><td>103000</td><td>13.49</td><td>13.484</td><td>26.155</td></tr><tr><td>&quot;Sweden&quot;</td><td>10.589835</td><td>450295</td><td>null</td><td>null</td><td>null</td></tr><tr><td>&quot;Norway&quot;</td><td>5.509733</td><td>323802</td><td>228.625</td><td>157.032</td><td>499.528</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nNow, the result includes all five Nordic countries. The export, import, and gdp_bln columns contain values for Iceland and Norway but show null for the others, since they’re not part of EFTA.\n\nThis approach ensures that we retain all countries from our original dataset while still incorporating relevant details from the second table.\n\nJust as a left join keeps all records from the left table, a right join does the opposite—it preserves all records from the right table and only includes matching data from the left.\n\n< PAUSE >\n\n::: {#ead9e33e .cell execution_count=28}\n``` {.python .cell-code}\n(nordic_council\n    .join(efta_countries, on=\"country_name\", how=\"right\")\n    )\n```\n\n::: {.cell-output .cell-output-display execution_count=26}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (4, 6)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>population_mln</th><th>area_sqkm</th><th>country_name</th><th>exports_bln</th><th>imports_bln</th><th>gdp_bln</th></tr><tr><td>f64</td><td>i64</td><td>str</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>5.509733</td><td>323802</td><td>&quot;Norway&quot;</td><td>228.625</td><td>157.032</td><td>499.528</td></tr><tr><td>null</td><td>null</td><td>&quot;Switzerland&quot;</td><td>661.628</td><td>554.358</td><td>733.779</td></tr><tr><td>0.364036</td><td>103000</td><td>&quot;Iceland&quot;</td><td>13.49</td><td>13.484</td><td>26.155</td></tr><tr><td>null</td><td>null</td><td>&quot;Liechtenstein&quot;</td><td>3.217</td><td>2.23</td><td>4.978</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nIn this case, the result contains four records - one for each country in the `efta_countries` table. Notice that the `country_name` column has shifted in the output, appearing after population and area. Also, since Switzerland and Liechtenstein weren’t in the `nordic_council` table, their population and area values are `null`.\n\nA full join combines all records from both tables, keeping everything from the left and right datasets. If there’s no match, the missing values are filled with `null`\n\n< PAUSE >\n\n::: {#1906bfa9 .cell execution_count=29}\n``` {.python .cell-code}\n(nordic_council\n    .join(efta_countries, on=\"country_name\", how=\"full\")\n    )\n```\n\n::: {.cell-output .cell-output-display execution_count=27}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (7, 7)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>country_name</th><th>population_mln</th><th>area_sqkm</th><th>country_name_right</th><th>exports_bln</th><th>imports_bln</th><th>gdp_bln</th></tr><tr><td>str</td><td>f64</td><td>i64</td><td>str</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;Denmark&quot;</td><td>5.973136</td><td>43094</td><td>null</td><td>null</td><td>null</td><td>null</td></tr><tr><td>&quot;Finland&quot;</td><td>5.626414</td><td>338145</td><td>null</td><td>null</td><td>null</td><td>null</td></tr><tr><td>&quot;Iceland&quot;</td><td>0.364036</td><td>103000</td><td>&quot;Iceland&quot;</td><td>13.49</td><td>13.484</td><td>26.155</td></tr><tr><td>&quot;Sweden&quot;</td><td>10.589835</td><td>450295</td><td>null</td><td>null</td><td>null</td><td>null</td></tr><tr><td>&quot;Norway&quot;</td><td>5.509733</td><td>323802</td><td>&quot;Norway&quot;</td><td>228.625</td><td>157.032</td><td>499.528</td></tr><tr><td>null</td><td>null</td><td>null</td><td>&quot;Switzerland&quot;</td><td>661.628</td><td>554.358</td><td>733.779</td></tr><tr><td>null</td><td>null</td><td>null</td><td>&quot;Liechtenstein&quot;</td><td>3.217</td><td>2.23</td><td>4.978</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nThis results in seven records—one for each unique country appearing in either dataset. However, you’ll notice that the country_name column is now duplicated, explicitly showing which table contributed each row.\n\nTo merge these into a single country_name column, we can use the `coalesce=True` argument. \n\n< PAUSE >\n\n::: {#99681acf .cell execution_count=30}\n``` {.python .cell-code}\n(nordic_council\n    .join(efta_countries, on=\"country_name\", how=\"full\", coalesce=True)\n    )\n```\n\n::: {.cell-output .cell-output-display execution_count=28}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (7, 6)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>country_name</th><th>population_mln</th><th>area_sqkm</th><th>exports_bln</th><th>imports_bln</th><th>gdp_bln</th></tr><tr><td>str</td><td>f64</td><td>i64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;Denmark&quot;</td><td>5.973136</td><td>43094</td><td>null</td><td>null</td><td>null</td></tr><tr><td>&quot;Finland&quot;</td><td>5.626414</td><td>338145</td><td>null</td><td>null</td><td>null</td></tr><tr><td>&quot;Iceland&quot;</td><td>0.364036</td><td>103000</td><td>13.49</td><td>13.484</td><td>26.155</td></tr><tr><td>&quot;Sweden&quot;</td><td>10.589835</td><td>450295</td><td>null</td><td>null</td><td>null</td></tr><tr><td>&quot;Norway&quot;</td><td>5.509733</td><td>323802</td><td>228.625</td><td>157.032</td><td>499.528</td></tr><tr><td>&quot;Switzerland&quot;</td><td>null</td><td>null</td><td>661.628</td><td>554.358</td><td>733.779</td></tr><tr><td>&quot;Liechtenstein&quot;</td><td>null</td><td>null</td><td>3.217</td><td>2.23</td><td>4.978</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nNow, we have a clean table that combines all available data while keeping a single country_name column.\n\nHowever, notice that five out of seven records contain missing values in at least some columns. For two of them, population and area are missing, while for the other three, economic data (gdp, export, and import) is absent.\n\nOne particularly useful - but less commonly discussed - join type is the anti-join. Unlike a left join, which retains all records from the left table, an anti-join returns only the rows that would have gone missing in a left join.\n\n< PAUSE >\n\n::: {#e8f0e26a .cell execution_count=31}\n``` {.python .cell-code}\n(nordic_council\n    .join(efta_countries, on=\"country_name\", how=\"anti\")\n    )\n```\n\n::: {.cell-output .cell-output-display execution_count=29}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 3)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>country_name</th><th>population_mln</th><th>area_sqkm</th></tr><tr><td>str</td><td>f64</td><td>i64</td></tr></thead><tbody><tr><td>&quot;Denmark&quot;</td><td>5.973136</td><td>43094</td></tr><tr><td>&quot;Finland&quot;</td><td>5.626414</td><td>338145</td></tr><tr><td>&quot;Sweden&quot;</td><td>10.589835</td><td>450295</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nHere, the result includes only the unmatched records from the nordic_council table - countries that do not appear in the efta_countries dataset. Also, note that only columns from the left table (nordic_council) are shown, as no matching data exists in the right table.\n\nThe anti-join is particularly useful for diagnosing and troubleshooting joins. Before performing a left join, it helps identify which records will be left without a match, allowing analysts to spot inconsistencies or missing data early.\n\nTo wrap up, here’s a visual summary of the five join types we’ve covered:\n\n- Inner join: Keeps only matching records from both tables.\n- Left join: Keeps all records from the left table and matches from the right.\n- Right join: Keeps all records from the right table and matches from the left.\n- Full join: Combines all records from both tables, filling in missing values.\n- Anti-join: Returns only unmatched records from the left table.\n\n![](https://i.sstatic.net/vb1V6.png)\n\nVenn diagrams can sometimes be misleading, but in this case, they’re incredibly useful. I find myself referring back to this image whenever I need to decide which type of join to use in a given situation.\n\nJoins can be performed on one or multiple columns. If you need to join on more than one column, you can provide a list of column names to the on argument: `on=[\"country\", \"region\"]`. \n\nHowever, there are a few things to watch out for:\n\n- Duplicates: If either table contains duplicate values in the join column(s), Polars will match every instance on the left with every instance on the right -  leading to data duplication.\n- Missing values: If a column used for joining contains null values, it may cause unexpected behavior or missing records in your result.\n\nBefore performing a join, always check for duplicates and missing values in your key columns. Polars stores updated information about missing values in a DataFrame. This information can be quickly retreived by the `.null_count()`.\n\nFor more details, I recommend checking out the official Polars documentation on the .join() method — it covers syntax, additional arguments, and advanced use cases.\n\n# VIDEO 7 joining household pollution data {greenscreen} ~ 3 min\n\nIn the previous module, we explored WHO data on household pollution, which was spread across three CSV files:\n\n- hhap_deaths – Causes of death linked to household pollution.\n- fuel_types – Types of fuel used for cooking in various countries.\n- clean_fuels – Proportion of the population with access to clean cooking fuels.\n\n::: {#3cde92bb .cell execution_count=32}\n``` {.python .cell-code}\nhhap_deaths = pl.read_csv(\"https://bit.ly/data24-hhap-deaths\")\nfuel_types = pl.read_csv(\"https://bit.ly/data24-cooking-by-fuel-type\")\nclean_fuels = pl.read_csv(\"https://bit.ly/data24-clean-fuels-cooking\")\n```\n:::\n\n\nWe wanted to put the deaths attributable to household pollution into context by comparing them to the total population of each country in the respective years. However, the hhap_deaths dataset lacked population estimates. To work around this, we inferred population estimates by aggregating the fuel_types dataset and saved it as pop_years_df. Now, our goal is to merge these population estimates into hhap_deaths so that we can analyze deaths per million people.\n\n:::{.challenge}\n\nVisualize European household pollution-related deaths per million population, broken down by cause of death:\n\n- Perform a left join between hhap_deaths and pop_years_df using region, country, and year.\n- Calculate deaths per million by dividing the deaths column by the inferred mean population.\n- Filter the data to include only European countries and exclude summary rows (to avoid double-counting).\n- Plot the results using ggplot.\n:::\n\n< PAUSE >\n\nHere's the code which allows us to observe trends in household pollution-related deaths over time, broken down by cause of death and country.\n\n::: {#24f64cd2 .cell execution_count=33}\n``` {.python .cell-code}\npop_years_df = pl.read_csv(\"hhap/pop_years_df.csv\")\n\n(hhap_deaths\n    .join(pop_years_df, on=[\"region\", \"country\", \"year\"], how=\"left\")\n    .with_columns(deaths_per_mln=pl.col(\"deaths\")/pl.col(\"mean_pop\"))\n    .filter(pl.col(\"region\")==\"Europe\",\n            pl.col(\"deaths\")>0,\n            pl.col(\"cause_of_death\")!=\"All causes\")\n    .pipe(ggplot, aes(x=\"year\", y=\"deaths_per_mln\", \n                    color=\"cause_of_death\", group=\"cause_of_death\"))\n    +geom_smooth(method=\"lm\")\n    +facet_wrap(\"country\", nrow=3)\n    +theme_seaborn()\n    +theme(figure_size=(15,8), legend_position=\"bottom\")\n    )\n```\n\n::: {.cell-output .cell-output-display}\n![](pivotjoin_files/figure-html/cell-34-output-1.png){width=1440 height=768}\n:::\n:::\n\n\nJoins allow us to break free from the constraints of a single dataset and uncover deeper insights by integrating data from multiple sources. Mastering the skill of merging datasets is a powerful addition to your data analysis toolkit, enabling you to answer more complex questions and build richer analyses.\n\nIn the next section, we’ll explore even more techniques for combining data from different sources. Stay tuned!\n\n# VIDEO 8 stacking\n\nAnother common operation in data analysis is stacking datasets vertically—essentially appending one dataset to another. This works when the datasets have the same column structure and represent different parts of the same kind of data. By stacking them together, we can create a larger dataset that consolidates information from multiple sources.\n\nGoing back to our household air pollution case study, we worked with three datasets:\n\n- hhap_deaths: Records of deaths linked to household air pollution.\n- fuel_types: Information on fuel types used for cooking in different countries.\n- clean_fuels: The proportion of the population with access to clean cooking fuels.\n\nEach dataset includes three key columns that describe the country of observation: region, country_code, and country. While these datasets share many of the same countries, they don’t completely overlap. Our goal is to create a master list of all countries, along with their codes and regions.\n\nSince each dataset spans multiple years, they contain duplicate entries for the same country. This issue will grow when we stack the datasets together, so we need to ensure our final dataset contains only unique records.\n\n< PAUSE >\n\n::: {#8a522e92 .cell execution_count=34}\n``` {.python .cell-code}\nidcols=cs.by_name(\"region\", \"country_code\", \"country\")\n\ncountry_regions = (hhap_deaths.select(idcols)\n    .vstack(fuel_types.select(idcols))\n    .vstack(clean_fuels.select(idcols))\n    .unique()\n)\n```\n:::\n\n\nHere, we create a temporary object, idcols, to store the column selector for the three country-related columns. This makes our code more readable and reusable, as Polars selectors can be stored separately and used in different querying contexts.\n\nNext, we want to verify that our country codes match the official ISO country codes. We have a reference file containing all Alpha-2 and Alpha-3 country codes. Before performing a left join, we first check for any records that don’t have a corresponding ISO code.\n\nSince the column names in our dataset and the ISO file don’t match, we explicitly specify the columns to join on using left_on and right_on. The anti-join returns an empty table. It means all our country codes successfully matched an entry in the ISO dataset - an important step in ensuring data integrity before further analysis.\n\n< PAUSE >\n\n::: {#492e9099 .cell execution_count=35}\n``` {.python .cell-code}\niso_df = pl.read_csv(\"https://bit.ly/data24-countrycodes\")\n\n(country_regions\n    .join(iso_df, left_on=\"country_code\", right_on=\"alpha3\", how=\"anti\"))\n\n(country_regions\n    .join(iso_df, left_on=\"country_code\", right_on=\"alpha3\", how=\"left\"))\n```\n\n::: {.cell-output .cell-output-display execution_count=33}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (195, 6)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>region</th><th>country_code</th><th>country</th><th>country_right</th><th>alpha2</th><th>numeric</th></tr><tr><td>str</td><td>str</td><td>str</td><td>str</td><td>str</td><td>i64</td></tr></thead><tbody><tr><td>&quot;Western Pacific&quot;</td><td>&quot;KIR&quot;</td><td>&quot;Kiribati&quot;</td><td>&quot;Kiribati&quot;</td><td>&quot;KI&quot;</td><td>296</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;ATG&quot;</td><td>&quot;Antigua and Barbuda&quot;</td><td>&quot;Antigua and Barbuda&quot;</td><td>&quot;AG&quot;</td><td>28</td></tr><tr><td>&quot;Eastern Mediterranean&quot;</td><td>&quot;SYR&quot;</td><td>&quot;Syrian Arab Republic&quot;</td><td>&quot;Syrian Arab Republic&quot;</td><td>&quot;SY&quot;</td><td>760</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;AND&quot;</td><td>&quot;Andorra&quot;</td><td>&quot;Andorra&quot;</td><td>&quot;AD&quot;</td><td>20</td></tr><tr><td>&quot;Europe&quot;</td><td>&quot;TUR&quot;</td><td>&quot;Türkiye&quot;</td><td>&quot;Turkey&quot;</td><td>&quot;TR&quot;</td><td>792</td></tr><tr><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;BRB&quot;</td><td>&quot;Barbados&quot;</td><td>&quot;Barbados&quot;</td><td>&quot;BB&quot;</td><td>52</td></tr><tr><td>&quot;Africa&quot;</td><td>&quot;GHA&quot;</td><td>&quot;Ghana&quot;</td><td>&quot;Ghana&quot;</td><td>&quot;GH&quot;</td><td>288</td></tr><tr><td>&quot;Americas&quot;</td><td>&quot;PER&quot;</td><td>&quot;Peru&quot;</td><td>&quot;Peru&quot;</td><td>&quot;PE&quot;</td><td>604</td></tr><tr><td>&quot;South-East Asia&quot;</td><td>&quot;IDN&quot;</td><td>&quot;Indonesia&quot;</td><td>&quot;Indonesia&quot;</td><td>&quot;ID&quot;</td><td>360</td></tr><tr><td>&quot;Western Pacific&quot;</td><td>&quot;SLB&quot;</td><td>&quot;Solomon Islands&quot;</td><td>&quot;Solomon Islands&quot;</td><td>&quot;SB&quot;</td><td>90</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nNow that we’ve combined our data from multiple sources, let’s dig a little deeper into the completeness of our dataset. Specifically, we want to find out how many countries are missing from our combined household air pollution dataset.\n\n< PAUSE >\n\n::: {#bf8cd233 .cell execution_count=36}\n``` {.python .cell-code}\n(iso_df\n    .join(country_regions, left_on=\"alpha3\", right_on=\"country_code\", how=\"anti\"))\n```\n\n::: {.cell-output .cell-output-display execution_count=34}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (54, 4)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>country</th><th>alpha2</th><th>alpha3</th><th>numeric</th></tr><tr><td>str</td><td>str</td><td>str</td><td>i64</td></tr></thead><tbody><tr><td>&quot;American Samoa&quot;</td><td>&quot;AS&quot;</td><td>&quot;ASM&quot;</td><td>16</td></tr><tr><td>&quot;Anguilla&quot;</td><td>&quot;AI&quot;</td><td>&quot;AIA&quot;</td><td>660</td></tr><tr><td>&quot;Antarctica&quot;</td><td>&quot;AQ&quot;</td><td>&quot;ATA&quot;</td><td>10</td></tr><tr><td>&quot;Aruba&quot;</td><td>&quot;AW&quot;</td><td>&quot;ABW&quot;</td><td>533</td></tr><tr><td>&quot;Bermuda&quot;</td><td>&quot;BM&quot;</td><td>&quot;BMU&quot;</td><td>60</td></tr><tr><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td></tr><tr><td>&quot;Virgin Islands (British)&quot;</td><td>&quot;VG&quot;</td><td>&quot;VGB&quot;</td><td>92</td></tr><tr><td>&quot;Virgin Islands (U.S.)&quot;</td><td>&quot;VI&quot;</td><td>&quot;VIR&quot;</td><td>850</td></tr><tr><td>&quot;Wallis and Futuna&quot;</td><td>&quot;WF&quot;</td><td>&quot;WLF&quot;</td><td>876</td></tr><tr><td>&quot;Western Sahara&quot;</td><td>&quot;EH&quot;</td><td>&quot;ESH&quot;</td><td>732</td></tr><tr><td>&quot;Åland Islands&quot;</td><td>&quot;AX&quot;</td><td>&quot;ALA&quot;</td><td>248</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nThis looks like another classic case for an anti-join. In this query, we start with the full list of ISO codes and perform an anti-join with our combined country_regions dataset. This will return only those countries that are in the ISO list but not in our merged dataset.\n\nThe result? We discover that 54 countries are missing from our combined dataset. Many of these are smaller island nations, where data collection might be too limited due to their size or population. Interestingly, the list also includes Antarctica, which, while not a country, has temporary settlements of scientists from around the world. We can only hope that these researchers use clean cooking fuels during their stay!\n\nIn this section, we focused on vertical stacking, a powerful technique for combining datasets with the same structure. By stacking datasets, we’re able to consolidate data from multiple sources into a single, larger dataset.\n\nWhile vertical stacking is often useful, there could be situations where horizontal stacking might seem appealing. Horizontal stacking requires that the row order is identical in both datasets, which can be risky. It is often much safer to perform a join, using a unique identifier like country code, year or other ID columns. Joins ensure that the data aligns correctly without depending on row order, providing a much more reliable way to combine data coming from different sources.\n\nBy mastering joins and stacking techniques, you’ll be able to take full advantage of multiple datasets, transforming them into a cohesive, insightful resource for analysis. \n\n",
    "supporting": [
      "pivotjoin_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}